<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#FF6B6B">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>KidsTube - No Scroll Test</title>
    <link rel="stylesheet" href="kids-styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Fredoka:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        .video-channel {
            display: block;
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }
        
        /* Video player tonedown effects */
        .video-player {
            transition: filter 0.5s ease;
        }
        
        .video-player iframe {
            transition: filter 0.5s ease;
        }
        
        /* Fullscreen support for tonedown */
        .video-player:-webkit-full-screen {
            transition: filter 0.5s ease;
        }
        
        .video-player:-moz-full-screen {
            transition: filter 0.5s ease;
        }
        
        .video-player:fullscreen {
            transition: filter 0.5s ease;
        }
        
        /* Ensure tonedown works in fullscreen */
        .video-player:-webkit-full-screen iframe {
            transition: filter 0.5s ease;
        }
        
        .video-player:-moz-full-screen iframe {
            transition: filter 0.5s ease;
        }
        
        .video-player:fullscreen iframe {
            transition: filter 0.5s ease;
        }
        
        /* Header Actions */
        .header-actions {
            display: flex;
            align-items: center;
            margin-left: 15px;
        }
        
        .menu-toggle {
            background: #FF6B6B;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .menu-toggle:hover {
            background: #e55a5a;
            transform: scale(1.1);
        }
        
        /* Sidebar Styles */
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9998;
            display: none;
        }
        
        .sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100%;
            background: white;
            z-index: 9999;
            transition: right 0.3s ease;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
        }
        
        .sidebar.open {
            right: 0;
        }
        
        .sidebar-overlay.show {
            display: block;
        }
        
        .sidebar-header {
            background: linear-gradient(135deg, #FF6B6B, #4ECDC4);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .sidebar-header h3 {
            margin: 0;
            font-family: 'Fredoka One', cursive;
            font-size: 1.3rem;
        }
        
        .close-sidebar {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: background 0.3s ease;
        }
        
        .close-sidebar:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .sidebar-content {
            padding: 20px;
        }
        
        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            cursor: pointer;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .filter-header:hover {
            border-bottom-color: #4ECDC4;
        }
        
        .filter-header h4 {
            color: #333;
            margin: 0;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .dropdown-arrow {
            color: #666;
            font-size: 14px;
            transition: transform 0.3s ease;
        }
        
        .filter-dropdown {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .filter-dropdown.open {
            max-height: 600px;
        }
        
        .dropdown-arrow.rotated {
            transform: rotate(180deg);
        }
        
        /* Control Sections */
        .control-section {
            margin-top: 20px;
        }
        
        .control-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            cursor: pointer;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .control-header:hover {
            border-bottom-color: #4ECDC4;
        }
        
        .control-header h4 {
            color: #333;
            margin: 0;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .control-dropdown {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .control-dropdown.open {
            max-height: 400px;
        }
        
        .control-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .control-option {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        
        .control-option:hover {
            border-color: #4ECDC4;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .control-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FF6B6B, #4ECDC4);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
            font-size: 16px;
        }
        
        .control-info h5 {
            margin: 0 0 4px 0;
            font-size: 1rem;
            color: #333;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
        }
        
        .control-info p {
            margin: 0;
            font-size: 0.85rem;
            color: #666;
        }
        
        .filter-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .filter-option {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        
        .filter-option:hover {
            border-color: #4ECDC4;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .filter-option.active {
            border-color: #FF6B6B;
            background: #fff5f5;
        }
        
        .filter-preview {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            margin-right: 15px;
            flex-shrink: 0;
            border: 2px solid #e0e0e0;
        }
        
        .filter-info h5 {
            margin: 0;
            font-size: 1rem;
            color: #333;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
        }
        
        .sidebar-footer {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }
        
        .parental-access-btn {
            width: 100%;
            background: #4ECDC4;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 1rem;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .parental-access-btn:hover {
            background: #3bb5b0;
            transform: translateY(-2px);
        }
        
        /* Safe Search Indicator */
        .safe-search-indicator {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #4ECDC4, #44A08D);
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(78, 205, 196, 0.3);
        }
        
        .safe-search-indicator i {
            font-size: 18px;
        }
        
        .safe-search-indicator span {
            font-size: 14px;
        }
        
        /* Video Overlay Styles */
        .video-player {
            position: relative;
            overflow: hidden;
        }
        
        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            z-index: 10;
            opacity: 1;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        .overlay-controls {
            pointer-events: all;
        }
        
        .overlay-info {
            pointer-events: all;
        }
        
        .video-player:hover .video-overlay {
            opacity: 1;
            background: rgba(0, 0, 0, 0.8);
        }
        
        .overlay-controls {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            background: linear-gradient(to bottom, rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.3));
            gap: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .overlay-play-btn {
            background: #FF6B6B;
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.4);
            position: relative;
            z-index: 15;
        }
        
        .overlay-play-btn::after {
            content: '';
            position: absolute;
            top: -20px;
            left: -20px;
            right: -20px;
            bottom: -20px;
            background: transparent;
            z-index: 10;
        }
        
        .overlay-play-btn:hover {
            background: #e55a5a;
            transform: scale(1.1);
        }
        
        .overlay-progress {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            cursor: pointer;
            position: relative;
        }
        
        .overlay-progress-bar {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        .overlay-progress-fill {
            height: 100%;
            background: #FF6B6B;
            border-radius: 3px;
            width: 0%;
            transition: width 0.1s ease;
        }
        
        .overlay-time {
            color: white;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            font-size: 14px;
            display: flex;
            gap: 5px;
        }
        
        .overlay-volume {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .overlay-volume-btn {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
            border-radius: 3px;
            transition: background 0.3s ease;
        }
        
        .overlay-volume-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .overlay-volume-slider {
            width: 80px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            cursor: pointer;
            position: relative;
        }
        
        .overlay-volume-fill {
            height: 100%;
            background: #4ECDC4;
            border-radius: 2px;
            width: 100%;
            transition: width 0.1s ease;
        }
        
        .overlay-fullscreen-btn {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 8px;
            border-radius: 3px;
            transition: background 0.3s ease;
        }
        
        .overlay-fullscreen-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .overlay-toggle-btn {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 8px;
            border-radius: 3px;
            transition: background 0.3s ease;
        }
        
        .overlay-toggle-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .overlay-info {
            padding: 20px;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.3));
            color: white;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .overlay-info h3 {
            margin: 0 0 8px 0;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            font-size: 1.2rem;
        }
        
        .overlay-info p {
            margin: 0;
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .overlay-click-area {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            background: transparent;
            cursor: pointer;
            z-index: 5;
        }
        
        /* Completely block YouTube controls and interactions */
        .video-player iframe {
            pointer-events: none;
        }
        
        .video-player.playing iframe {
            pointer-events: none;
        }
        
        /* Block any YouTube overlays or controls */
        .video-player iframe::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: transparent;
            z-index: 1000;
            pointer-events: all;
        }
        
        /* Make overlay click-through for play button area */
        .overlay-play-btn {
            z-index: 20;
        }
        
        .video-player.playing .video-overlay {
            opacity: 1;
            background: rgba(0, 0, 0, 0.7);
        }
        
        .video-player.playing:hover .video-overlay {
            opacity: 1;
            background: rgba(0, 0, 0, 0.9);
        }
        
        /* When no video is loaded, show overlay prominently */
        .video-player:not(.playing) .video-overlay {
            opacity: 1;
            background: rgba(0, 0, 0, 0.8);
        }
        
        /* When overlay is hidden */
        .video-player.overlay-hidden .video-overlay {
            opacity: 0;
            pointer-events: none;
        }
        
        .video-player.overlay-hidden:hover .video-overlay {
            opacity: 1;
            pointer-events: all;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                right: -100%;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-play-circle"></i>
                <span>KidsTube</span>
            </div>
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="Search for fun videos! ðŸ”" class="search-input">
                <button class="search-btn" onclick="searchVideos()">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            <div class="header-actions">
                <button class="menu-toggle" id="menuToggle" onclick="toggleSidebar()">
                    <i class="fas fa-ellipsis-v"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Sidebar Menu -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h3><i class="fas fa-cog"></i> Video Filters</h3>
            <button class="close-sidebar" onclick="closeSidebar()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="sidebar-content">
            <!-- Video Filters Section -->
            <div class="filter-section">
                <div class="filter-header" onclick="toggleFilterDropdown()">
                    <h4><i class="fas fa-palette"></i> Video Filters</h4>
                    <i class="fas fa-chevron-down dropdown-arrow" id="dropdownArrow"></i>
                </div>
                
                <div class="filter-dropdown" id="filterDropdown">
                    <div class="filter-options">
                        <div class="filter-option" onclick="selectFilter('none')">
                            <div class="filter-preview" style="background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #ffe66d);"></div>
                            <div class="filter-info">
                                <h5>Off / No Filter</h5>
                    </div>
                </div>
                        
                        <div class="filter-option" onclick="selectFilter('reduce_addiction')">
                            <div class="filter-preview" style="background: linear-gradient(45deg, #8a8a8a, #a0a0a0, #b8b8b8); filter: saturate(0.6) contrast(0.95);"></div>
                            <div class="filter-info">
                                <h5>ðŸš« Reduce Screen Addiction</h5>
                </div>
            </div>
                        
                        <div class="filter-option" onclick="selectFilter('sleep_warm')">
                            <div class="filter-preview" style="background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #ffe66d); filter: sepia(0.6) hue-rotate(10deg) saturate(0.9) brightness(0.98);"></div>
                            <div class="filter-info">
                                <h5>ðŸŒ™ Help with Sleep</h5>
            </div>
                        </div>
                        
                        <div class="filter-option" onclick="selectFilter('calm_cool')">
                            <div class="filter-preview" style="background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #ffe66d); filter: hue-rotate(190deg) saturate(0.85) brightness(0.96);"></div>
                            <div class="filter-info">
                                <h5>ðŸ§˜ Calm Overstimulation</h5>
                    </div>
                </div>
                
                        <div class="filter-option" onclick="selectFilter('focus_monotone')">
                            <div class="filter-preview" style="background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #ffe66d); filter: grayscale(0.6) contrast(0.9) brightness(0.98);"></div>
                            <div class="filter-info">
                                <h5>ðŸŽ¯ Improve Focus</h5>
                    </div>
                        </div>
                        
                        <div class="filter-option" onclick="selectFilter('memory_balanced')">
                            <div class="filter-preview" style="background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #ffe66d); filter: saturate(0.9) contrast(0.98) brightness(1.0);"></div>
                            <div class="filter-info">
                                <h5>ðŸ§© Enhance Memory</h5>
                    </div>
                </div>
                
                        <div class="filter-option" onclick="selectFilter('creativity_soft')">
                            <div class="filter-preview" style="background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #ffe66d); filter: saturate(0.85) contrast(0.94) brightness(1.02);"></div>
                            <div class="filter-info">
                                <h5>ðŸŽ¨ Stimulate Creativity</h5>
                            </div>
                    </div>
                    
                        <div class="filter-option" onclick="selectFilter('anxiety_green')">
                            <div class="filter-preview" style="background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #ffe66d); filter: hue-rotate(150deg) saturate(0.85) brightness(0.97);"></div>
                            <div class="filter-info">
                                <h5>ðŸ«‚ Reduce Anxiety</h5>
                            </div>
                        </div>
                    </div>
                </div>
                    </div>
                    
            <!-- Screen Time Control Section -->
            <div class="control-section">
                <div class="control-header" onclick="toggleScreenTimeDropdown()">
                    <h4><i class="fas fa-clock"></i> Screen Time Control</h4>
                    <i class="fas fa-chevron-down dropdown-arrow" id="screenTimeArrow"></i>
                </div>
                
                <div class="control-dropdown" id="screenTimeDropdown">
                    <div class="control-options">
                        <div class="control-option" onclick="toggleTonedown()">
                            <div class="control-icon">
                                <i class="fas fa-play" id="timerIcon"></i>
                            </div>
                            <div class="control-info">
                                <h5 id="timerText">Start Timer</h5>
                                <p id="timerStatus">Ready to start</p>
                    </div>
                </div>
                
                        <div class="control-option" onclick="startQuickTimer()">
                            <div class="control-icon">
                                <i class="fas fa-bolt"></i>
                        </div>
                            <div class="control-info">
                                <h5>Quick 5min Timer</h5>
                                <p>Start a quick 5-minute session</p>
                        </div>
                        </div>
                        
                        <div class="control-option" onclick="resetTonedown()">
                            <div class="control-icon">
                                <i class="fas fa-refresh"></i>
                        </div>
                            <div class="control-info">
                                <h5>Reset Timer</h5>
                                <p>Reset all timers and filters</p>
                    </div>
                </div>
                
                        <div class="control-option" onclick="toggleStatsPanel()">
                            <div class="control-icon">
                                <i class="fas fa-chart-bar"></i>
                        </div>
                            <div class="control-info">
                                <h5>View Statistics</h5>
                                <p>See usage statistics</p>
                            </div>
                        </div>
                    </div>
                </div>
                    </div>
                    
            <!-- Parental Controls Section -->
            <div class="control-section">
                <div class="control-header" onclick="toggleParentalDropdown()">
                    <h4><i class="fas fa-shield-alt"></i> Parental Controls</h4>
                    <i class="fas fa-chevron-down dropdown-arrow" id="parentalArrow"></i>
                </div>
                
                <div class="control-dropdown" id="parentalDropdown">
                    <div class="control-options">
                        <div class="control-option" onclick="openParentalControls()">
                            <div class="control-icon">
                                <i class="fas fa-lock"></i>
                            </div>
                            <div class="control-info">
                                <h5>Access Parental Settings</h5>
                                <p>Configure advanced settings</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <nav class="nav-tabs">
        <button class="nav-tab active" data-category="all">All Videos</button>
        <button class="nav-tab" data-category="cartoons">Cartoons</button>
        <button class="nav-tab" data-category="education">Learning</button>
        <button class="nav-tab" data-category="music">Music</button>
        <button class="nav-tab" data-category="games">Games</button>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Featured Video Section -->
        <section class="featured-video">
            <div class="video-container">
                <div id="videoPlayer" class="video-player">
                    <div class="video-overlay" id="videoOverlay">
                        <div class="overlay-controls">
                            <button class="overlay-play-btn" id="overlayPlayBtn">
                                <i class="fas fa-play"></i>
                            </button>
                            <div class="overlay-progress">
                                <div class="overlay-progress-bar" id="overlayProgressBar">
                                    <div class="overlay-progress-fill" id="overlayProgressFill"></div>
                        </div>
                        </div>
                            <div class="overlay-time">
                                <span id="overlayCurrentTime">0:00</span>
                                <span id="overlayDuration">0:00</span>
                        </div>
                            <div class="overlay-volume">
                                <button class="overlay-volume-btn" id="overlayVolumeBtn">
                                    <i class="fas fa-volume-up"></i>
                                </button>
                                <div class="overlay-volume-slider" id="overlayVolumeSlider">
                                    <div class="overlay-volume-fill" id="overlayVolumeFill"></div>
                        </div>
                        </div>
                            <button class="overlay-fullscreen-btn" id="overlayFullscreenBtn">
                                <i class="fas fa-expand"></i>
                            </button>
                            <button class="overlay-toggle-btn" id="overlayToggleBtn">
                                <i class="fas fa-eye-slash"></i>
                            </button>
                        </div>
                        <div class="overlay-info">
                            <h3 id="overlayTitle">Welcome to KidsTube!</h3>
                            <p id="overlayDescription">Choose a fun video from below to get started! ðŸŽ‰</p>
                    </div>
                </div>
                    <div class="video-placeholder">
                        <i class="fas fa-play-circle"></i>
                        <p>Click a video to start watching!</p>
                    </div>
                </div>
                <div class="video-info">
                    <h2 id="videoTitle">Welcome to KidsTube!</h2>
                    <p id="videoDescription">Choose a fun video from below to get started! ðŸŽ‰</p>
                </div>
            </div>
        </section>

        <!-- Video Grid -->
        <section class="video-grid">
            <h3>Popular Videos</h3>
            <div class="videos-container" id="videosContainer">
                <!-- Videos will be loaded here -->
            </div>
        </section>
    </main>


    <!-- Safety Notice -->
    <div class="safety-notice">
        <i class="fas fa-shield-alt"></i>
        <span>All videos are kid-safe and family-friendly!</span>
    </div>

    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner"></div>
        <p>Loading fun videos...</p>
    </div>

    <script>
        // Video data - Kid-friendly videos with guaranteed working YouTube IDs
        const videoData = [
            // Cartoons
            {
                id: 'XqZsoesa55w',
                title: 'Baby Shark Dance',
                description: 'Sing and dance with Baby Shark! ðŸ¦ˆ',
                category: 'cartoons',
                thumbnail: 'https://img.youtube.com/vi/XqZsoesa55w/maxresdefault.jpg'
            },
            {
                id: 'CQ6K6Y2FJ0A',
                title: 'Peppa Pig - Muddy Puddles',
                description: 'Join Peppa Pig on fun adventures! ðŸ·',
                category: 'cartoons',
                thumbnail: 'https://img.youtube.com/vi/CQ6K6Y2FJ0A/maxresdefault.jpg'
            },
            {
                id: 'kffacxfA7G4',
                title: 'Mickey Mouse Clubhouse - Hot Dog Dance',
                description: 'Fun with Mickey and his friends! ðŸ­',
                category: 'cartoons',
                thumbnail: 'https://img.youtube.com/vi/kffacxfA7G4/maxresdefault.jpg'
            },
            {
                id: '8cK_ONKqk2k',
                title: 'Dinosaur Train - Theme Song',
                description: 'Learn about dinosaurs with Buddy! ðŸ¦•',
                category: 'cartoons',
                thumbnail: 'https://img.youtube.com/vi/8cK_ONKqk2k/maxresdefault.jpg'
            },
            
            // Education
            {
                id: 'BEljZ1zUHEM',
                title: 'ABC Song for Kids',
                description: 'Learn the alphabet with fun music! ðŸŽµ',
                category: 'education',
                thumbnail: 'https://img.youtube.com/vi/BEljZ1zUHEM/maxresdefault.jpg'
            },
            {
                id: 'DRxq6ljIxI0',
                title: 'Counting Numbers 1-10',
                description: 'Learn to count with colorful animations! ðŸ”¢',
                category: 'education',
                thumbnail: 'https://img.youtube.com/vi/DRxq6ljIxI0/maxresdefault.jpg'
            },
            {
                id: 'eHjR6hnjku0',
                title: 'Colors and Shapes',
                description: 'Discover colors and shapes around us! ðŸŒˆ',
                category: 'education',
                thumbnail: 'https://img.youtube.com/vi/eHjR6hnjku0/maxresdefault.jpg'
            },
            {
                id: 'tGBIWA4ITUY',
                title: 'Animal Sounds',
                description: 'Learn what different animals say! ðŸ¶ðŸ±ðŸ®',
                category: 'education',
                thumbnail: 'https://img.youtube.com/vi/tGBIWA4ITUY/maxresdefault.jpg'
            },
            
            // Music
            {
                id: 'VfxByW0WrU8',
                title: 'Wheels on the Bus',
                description: 'Sing along to this classic kids song! ðŸšŒ',
                category: 'music',
                thumbnail: 'https://img.youtube.com/vi/VfxByW0WrU8/maxresdefault.jpg'
            },
            {
                id: 'yCjJyiqpAuU',
                title: 'Twinkle Twinkle Little Star',
                description: 'Beautiful lullaby for bedtime! â­',
                category: 'music',
                thumbnail: 'https://img.youtube.com/vi/yCjJyiqpAuU/maxresdefault.jpg'
            },
            {
                id: '5oYKonYBujg',
                title: 'Old MacDonald Had a Farm',
                description: 'Farm animals and fun sounds! ðŸšœ',
                category: 'music',
                thumbnail: 'https://img.youtube.com/vi/5oYKonYBujg/maxresdefault.jpg'
            },
            
            // Games
            {
                id: 'jNQXAC9IVRw',
                title: 'Me at the zoo',
                description: 'First YouTube video ever! ðŸ“¹',
                category: 'games',
                thumbnail: 'https://img.youtube.com/vi/jNQXAC9IVRw/maxresdefault.jpg'
            },
            {
                id: '9bZkp7q19f0',
                title: 'PSY - GANGNAM STYLE',
                description: 'Famous K-pop dance video! ðŸŽµ',
                category: 'games',
                thumbnail: 'https://img.youtube.com/vi/9bZkp7q19f0/maxresdefault.jpg'
            },
            {
                id: 'kJQP7kiw5Fk',
                title: 'Luis Fonsi - Despacito',
                description: 'Popular Spanish music video! ðŸŽµ',
                category: 'games',
                thumbnail: 'https://img.youtube.com/vi/kJQP7kiw5Fk/maxresdefault.jpg'
            },
            
            // Additional working videos
            {
                id: 'dQw4w9WgXcQ',
                title: 'Rick Astley - Never Gonna Give You Up',
                description: 'Classic music video! ðŸŽµ',
                category: 'music',
                thumbnail: 'https://img.youtube.com/vi/dQw4w9WgXcQ/maxresdefault.jpg'
            },
            {
                id: 'M7lc1UVf-VE',
                title: 'Dinosaur Train Adventures',
                description: 'Learn about dinosaurs with Buddy! ðŸ¦•',
                category: 'cartoons',
                thumbnail: 'https://img.youtube.com/vi/M7lc1UVf-VE/maxresdefault.jpg'
            },
            {
                id: 'CevxZvSJLk8',
                title: 'Educational Game',
                description: 'Fun learning game for kids! ðŸŽ®',
                category: 'games',
                thumbnail: 'https://img.youtube.com/vi/CevxZvSJLk8/maxresdefault.jpg'
            }
        ];

        let currentCategory = 'all';
        let tonedownActive = false;
        let tonedownTimer = null;
        let tonedownStartTime = null;
        let tonedownDuration = 1800000; // 30 minutes in milliseconds
        let breakReminderInterval = null;
        
        // Break system variables
        let videoStartTime = null;
        let breakInterval = null;
        let currentBreakGame = null;
        let breakDuration = 15 * 60 * 1000; // 15 minutes in milliseconds
        let breakReminderDuration = 300000; // 5 minutes
        let lastBreakTime = 0;
        let dailyUsage = 0;
        let weeklyUsage = 0;
        let sessionCount = 0;
        let totalSessionTime = 0;
        let parentalSettings = {
            dailyLimitEnabled: false,
            dailyLimitHours: 2,
            bedtimeMode: false,
            weekendMode: false,
            breakReminderEnabled: false,
            hideParentalBtn: false,
            targetMode: 'none' // filter/goal mode
        };
        let parentalAccess = false;
        const parentalPassword = 'parent123'; // Default password
        
        // YouTube API configuration
        let apiKey = 'AIzaSyDdqnaHe2qjRnZWFM2HNYvWxUwxPo07J8g';
        let isYouTubeEnabled = true;
        let safeSearchEnabled = true; // Enable safe search for kids
        let youtubePlayer = null;
        let isVideoPlaying = false;

        // YouTube API functions
        function onYouTubeIframeAPIReady() {
            console.log('YouTube API ready');
        }
        
        function createYouTubePlayer(videoId) {
            if (youtubePlayer) {
                youtubePlayer.destroy();
            }
            
            youtubePlayer = new YT.Player('youtubePlayer', {
                height: '100%',
                width: '100%',
                videoId: videoId,
                playerVars: {
                    'playsinline': 1,
                    'controls': 0,
                    'disablekb': 1,
                    'fs': 0,
                    'rel': 0,
                    'modestbranding': 1,
                    'showinfo': 0,
                    'iv_load_policy': 3,
                    'cc_load_policy': 0
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }
        
        function onPlayerReady(event) {
            console.log('YouTube player ready');
            isVideoPlaying = false;
        }
        
        function onPlayerStateChange(event) {
            const playBtn = document.getElementById('overlayPlayBtn');
            const icon = playBtn ? playBtn.querySelector('i') : null;
            
            if (event.data === YT.PlayerState.PLAYING) {
                isVideoPlaying = true;
                if (icon) icon.className = 'fas fa-pause';
            } else if (event.data === YT.PlayerState.PAUSED) {
                isVideoPlaying = false;
                if (icon) icon.className = 'fas fa-play';
            }
        }

        // Initialize app
        window.onload = function() {
            console.log('App initialized');
            checkApiKey();
            loadVideos();
            setupEventListeners();
            setupTonedownFeature();
            setupVideoOverlay();
        };
        
        // Check if API key exists
        function checkApiKey() {
            console.log('YouTube API key configured, search enabled');
        }
        
        
        // Fetch videos from YouTube API
        async function fetchYouTubeVideos(query) {
            if (!apiKey) {
                throw new Error('No API key provided');
            }
            
            // Enhanced safe search for kids
            const url = `https://www.googleapis.com/youtube/v3/search?key=${apiKey}&q=${encodeURIComponent(query)}&type=video&part=snippet&maxResults=20&safeSearch=strict&videoEmbeddable=true&videoDuration=short&videoCategoryId=27&order=relevance`;
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error.message);
                }
                
                const videoResults = data.items.map(item => ({
                    id: item.id.videoId,
                    title: item.snippet.title,
                    description: item.snippet.description,
                    category: 'youtube',
                    thumbnail: item.snippet.thumbnails.medium.url,
                    duration: 'Unknown',
                    channelTitle: item.snippet.channelTitle
                }));
                
                // Apply additional client-side safety filtering
                const safeVideos = filterSafeContent(videoResults);
                
                console.log(`Safe search: ${safeVideos.length}/${videoResults.length} videos passed safety filters`);
                return safeVideos;
            } catch (error) {
                console.error('YouTube API error:', error);
                throw error;
            }
        }
        
        // Additional client-side safety filtering for kids
        function filterSafeContent(videos) {
            if (!safeSearchEnabled) return videos;
            
            const inappropriateKeywords = [
                // Violence and scary content
                'scary', 'horror', 'frightening', 'violent', 'fight', 'battle', 'war', 'death', 'kill',
                // Inappropriate language
                'bad words', 'swear', 'curse', 'inappropriate', 'adult', 'mature',
                // Dangerous activities
                'dangerous', 'risky', 'stunt', 'challenge', 'prank', 'scare',
                // Inappropriate content
                'sexy', 'hot', 'adult content', 'inappropriate', 'explicit',
                // Negative behaviors
                'hate', 'bully', 'mean', 'rude', 'disrespectful'
            ];
            
            return videos.filter(video => {
                const title = video.title.toLowerCase();
                const description = video.description.toLowerCase();
                const channelTitle = video.channelTitle.toLowerCase();
                
                // Check for inappropriate keywords
                const hasInappropriateContent = inappropriateKeywords.some(keyword => 
                    title.includes(keyword) || description.includes(keyword) || channelTitle.includes(keyword)
                );
                
                // Check for educational/child-friendly indicators
                const isEducational = [
                    'educational', 'learn', 'teach', 'kids', 'children', 'family', 'fun',
                    'cartoon', 'animation', 'story', 'song', 'music', 'dance', 'art',
                    'science', 'math', 'reading', 'writing', 'abc', '123', 'colors',
                    'shapes', 'animals', 'nature', 'cooking', 'craft', 'toy'
                ].some(keyword => 
                    title.includes(keyword) || description.includes(keyword) || channelTitle.includes(keyword)
                );
                
                // Allow if educational and not inappropriate
                return !hasInappropriateContent && (isEducational || title.length < 50); // Short titles are usually safer
            });
        }

        function setupEventListeners() {
            // Navigation tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                    // Add active class to clicked tab
                    this.classList.add('active');
                    
                    // Get category and filter videos
                    const category = this.getAttribute('data-category');
                    currentCategory = category;
                    loadVideos();
                });
            });

            // Search input - Enter key listener and real-time search
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                // Real-time search as you type
                searchInput.addEventListener('input', function() {
                    searchVideos();
                });
                
                // Enter key listener
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchVideos();
                    }
                });
            }
        }

        function loadVideos() {
            const videosContainer = document.getElementById('videosContainer');
            let videosToShow = videoData;

            // Filter by category
            if (currentCategory !== 'all') {
                videosToShow = videoData.filter(video => video.category === currentCategory);
            }

            // Display videos
            videosContainer.innerHTML = videosToShow.map(video => `
                <div class="video-card" onclick="playVideo('${video.id}', '${video.title.replace(/'/g, "\\'")}', '${video.description.replace(/'/g, "\\'")}')">
                    <div class="video-thumbnail">
                        <img src="${video.thumbnail}" alt="${video.title}" onerror="this.style.display='none'">
                        <i class="fas fa-play-circle play-icon"></i>
                    </div>
                    <div class="video-info">
                        <h4>${video.title}</h4>
                        <p>${video.description}</p>
                        <span class="video-category">${video.category}</span>
                    </div>
                </div>
            `).join('');
        }

        function playVideo(videoId, title, description) {
            console.log('Playing video:', title);
            
            const videoPlayer = document.getElementById('videoPlayer');
            const titleElement = document.getElementById('videoTitle');
            const descElement = document.getElementById('videoDescription');
            
            // Update video player with YouTube API
            videoPlayer.innerHTML = `
                <div class="video-overlay" id="videoOverlay">
                    <div class="overlay-controls">
                        <button class="overlay-play-btn" id="overlayPlayBtn">
                            <i class="fas fa-play"></i>
                        </button>
                        <div class="overlay-progress">
                            <div class="overlay-progress-bar" id="overlayProgressBar">
                                <div class="overlay-progress-fill" id="overlayProgressFill"></div>
                            </div>
                        </div>
                        <div class="overlay-time">
                            <span id="overlayCurrentTime">0:00</span>
                            <span id="overlayDuration">0:00</span>
                        </div>
                        <div class="overlay-volume">
                            <button class="overlay-volume-btn" id="overlayVolumeBtn">
                                <i class="fas fa-volume-up"></i>
                            </button>
                            <div class="overlay-volume-slider" id="overlayVolumeSlider">
                                <div class="overlay-volume-fill" id="overlayVolumeFill"></div>
                            </div>
                        </div>
                        <button class="overlay-fullscreen-btn" id="overlayFullscreenBtn">
                            <i class="fas fa-expand"></i>
                        </button>
                        <button class="overlay-toggle-btn" id="overlayToggleBtn">
                            <i class="fas fa-eye-slash"></i>
                        </button>
                    </div>
                    <div class="overlay-info">
                        <h3 id="overlayTitle">${title}</h3>
                        <p id="overlayDescription">${description}</p>
                    </div>
                </div>
                <div id="youtubePlayer"></div>
            `;
            
            // Add playing class to enable overlay controls
            videoPlayer.classList.add('playing');
            
            // Create YouTube player
            createYouTubePlayer(videoId);
            
            // Re-setup overlay controls for the new elements
            setupVideoOverlay();
            
            // Update video info
            if (titleElement) titleElement.textContent = title;
            if (descElement) descElement.textContent = description;
            
            // Start break timer
            startBreakTimer();
            
            // NO SCROLLING - just show success message
            showSuccessMessage(`Now playing: ${title}! ðŸŽ‰`);

            // Re-apply base filter to new iframe
            applyBaseVideoFilter();
        }

        async function searchVideos() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            console.log('Searching for:', searchTerm);

            if (!searchTerm) {
                loadVideos();
                return;
            }

            // Show loading spinner
            showLoading(true);
            
            try {
                let searchResults = [];
                
                if (isYouTubeEnabled && apiKey) {
                    // Use YouTube API search
                    console.log('Searching YouTube for:', searchTerm);
                    searchResults = await fetchYouTubeVideos(searchTerm);
                    console.log('YouTube search results:', searchResults.length);
                } else {
                    // Fallback to local search
                    console.log('Using local search for:', searchTerm);
                    searchResults = videoData.filter(video => {
                const title = video.title.toLowerCase();
                const description = video.description.toLowerCase();
                const category = video.category.toLowerCase();
                
                // Direct matches
                if (title.includes(searchTerm) || description.includes(searchTerm) || category.includes(searchTerm)) {
                    return true;
                }
                
                // Partial word matches
                const searchWords = searchTerm.split(' ');
                return searchWords.some(word => 
                    title.includes(word) || description.includes(word) || category.includes(word)
                );
            });
                }
                
                displaySearchResults(searchResults, searchTerm);
                
            } catch (error) {
                console.error('Search error:', error);
                showSuccessMessage(`Search failed: ${error.message}. Using local videos instead.`);
                
                // Fallback to local search
                const localResults = videoData.filter(video => {
                    const title = video.title.toLowerCase();
                    const description = video.description.toLowerCase();
                    const category = video.category.toLowerCase();
                    
                    return title.includes(searchTerm) || description.includes(searchTerm) || category.includes(searchTerm);
                });
                
                displaySearchResults(localResults, searchTerm);
            } finally {
                showLoading(false);
            }
        }
        
        function displaySearchResults(results, searchTerm) {
            const videosContainer = document.getElementById('videosContainer');
            
            if (results.length === 0) {
                // Show helpful message when no results found
                videosContainer.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: var(--text-light);">
                        <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 1rem; color: var(--primary-pink);"></i>
                        <h3>No videos found for "${searchTerm}"</h3>
                        <p>Try searching for:</p>
                        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; justify-content: center; margin-top: 1rem;">
                            <span style="background: var(--primary-green); color: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.9rem;">cartoons</span>
                            <span style="background: var(--primary-blue); color: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.9rem;">music</span>
                            <span style="background: var(--primary-yellow); color: var(--text-dark); padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.9rem;">education</span>
                            <span style="background: var(--primary-orange); color: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.9rem;">games</span>
                        </div>
                        <p style="margin-top: 1rem; font-size: 0.9rem;">Or try: "baby", "dinosaur", "abc", "counting", "colors"</p>
                    </div>
                `;
                showSuccessMessage(`No videos found for "${searchTerm}". Try different keywords!`);
            } else {
                // Add safe search indicator
                const safeSearchIndicator = safeSearchEnabled ? `
                    <div class="safe-search-indicator">
                        <i class="fas fa-shield-alt"></i>
                        <span>Safe Search Active - Child-Friendly Content Only</span>
                    </div>
                ` : '';
                
                videosContainer.innerHTML = safeSearchIndicator + results.map(video => `
                    <div class="video-card" onclick="playVideo('${video.id}', '${video.title.replace(/'/g, "\\'")}', '${video.description.replace(/'/g, "\\'")}')">
                        <div class="video-thumbnail">
                            <img src="${video.thumbnail}" alt="${video.title}" onerror="this.style.display='none'">
                            <i class="fas fa-play-circle play-icon"></i>
                        </div>
                        <div class="video-info">
                            <h4>${video.title}</h4>
                            <p>${video.description}</p>
                            <span class="video-category">${video.category}</span>
                            ${video.channelTitle ? `<span class="video-channel">${video.channelTitle}</span>` : ''}
                        </div>
                    </div>
                `).join('');
                showSuccessMessage(`Found ${results.length} safe video${results.length === 1 ? '' : 's'}! ðŸ›¡ï¸ðŸŽ‰`);
            }
        }

        function showLoading(show) {
            const spinner = document.getElementById('loadingSpinner');
            if (spinner) {
                spinner.style.display = show ? 'flex' : 'none';
            }
        }

        function showSuccessMessage(message) {
            // Remove existing messages
            const existingMessage = document.querySelector('.success-message');
            if (existingMessage) {
                existingMessage.remove();
            }

            // Create new message
            const messageDiv = document.createElement('div');
            messageDiv.className = 'success-message';
            messageDiv.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
            messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #4CAF50;
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 10px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.2);
                z-index: 1000;
                font-weight: bold;
                animation: slideIn 0.3s ease;
            `;

            // Add animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);

            document.body.appendChild(messageDiv);

            // Remove after 3 seconds
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 3000);
        }

        // Enhanced Screen Time Control functions
        function setupTonedownFeature() {
            const toggleBtn = document.getElementById('tonedownToggle');
            const resetBtn = document.getElementById('resetBtn');
            const durationSelect = document.getElementById('durationSelect');
            const breakReminderSelect = document.getElementById('breakReminder');
            const quickTimerBtn = document.getElementById('quickTimerBtn');
            const statsBtn = document.getElementById('statsBtn');
            const parentalBtn = document.getElementById('parentalBtn');
            const passwordSubmit = document.getElementById('passwordSubmit');
            const parentalPasswordInput = document.getElementById('parentalPassword');
            const lockSettings = document.getElementById('lockSettings');

            // Basic controls
            if (toggleBtn) toggleBtn.addEventListener('click', toggleTonedown);
            if (resetBtn) resetBtn.addEventListener('click', resetTonedown);
            if (quickTimerBtn) quickTimerBtn.addEventListener('click', startQuickTimer);
            if (statsBtn) statsBtn.addEventListener('click', toggleStatsPanel);
            if (parentalBtn) parentalBtn.addEventListener('click', toggleParentalPanel);
            
            // Password protection
            if (passwordSubmit) passwordSubmit.addEventListener('click', checkParentalPassword);
            if (parentalPasswordInput) {
                parentalPasswordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        checkParentalPassword();
                    }
                });
            }
            if (lockSettings) lockSettings.addEventListener('click', lockParentalSettings);

            // Settings
            if (durationSelect) {
                durationSelect.addEventListener('change', function() {
                    tonedownDuration = parseInt(this.value);
                    updateTimeDisplay();
                });
            }

            if (breakReminderSelect) {
                breakReminderSelect.addEventListener('change', function() {
                    breakReminderDuration = parseInt(this.value);
                    setupBreakReminders();
                });
            }

            // Parental controls
            setupParentalControls();
            loadSettings();
            updateStatistics();
        }

        function startQuickTimer() {
            tonedownDuration = 300000; // 5 minutes
            document.getElementById('durationSelect').value = '300000';
            if (!tonedownActive) {
                toggleTonedown();
            }
            showSuccessMessage('Quick 5-minute timer started! âš¡');
        }

        function toggleStatsPanel() {
            const statsPanel = document.getElementById('statsPanel');
            const parentalPanel = document.getElementById('parentalPanel');
            
            if (statsPanel.style.display === 'none') {
                statsPanel.style.display = 'block';
                parentalPanel.style.display = 'none';
                updateStatistics();
            } else {
                statsPanel.style.display = 'none';
            }
        }

        function toggleParentalPanel() {
            const parentalPanel = document.getElementById('parentalPanel');
            const statsPanel = document.getElementById('statsPanel');
            
            if (parentalPanel.style.display === 'none') {
                parentalPanel.style.display = 'block';
                statsPanel.style.display = 'none';
                
                // Reset password section if not already accessed
                if (!parentalAccess) {
                    showPasswordSection();
                }
            } else {
                parentalPanel.style.display = 'none';
            }
        }

        function checkParentalPassword() {
            const passwordInput = document.getElementById('parentalPassword');
            const enteredPassword = passwordInput.value.trim();
            
            if (enteredPassword === parentalPassword) {
                parentalAccess = true;
                showParentalSettings();
                passwordInput.value = '';
                showSuccessMessage('Parental access granted! ðŸ”“');
            } else {
                showSuccessMessage('Incorrect password. Try again. âŒ');
                passwordInput.value = '';
                passwordInput.focus();
            }
        }

        function showPasswordSection() {
            const passwordSection = document.getElementById('passwordSection');
            const parentalSettings = document.getElementById('parentalSettings');
            
            if (passwordSection) passwordSection.style.display = 'block';
            if (parentalSettings) parentalSettings.style.display = 'none';
        }

        function showParentalSettings() {
            const passwordSection = document.getElementById('passwordSection');
            const parentalSettings = document.getElementById('parentalSettings');
            
            if (passwordSection) passwordSection.style.display = 'none';
            if (parentalSettings) parentalSettings.style.display = 'block';
        }

        function lockParentalSettings() {
            parentalAccess = false;
            showPasswordSection();
            showSuccessMessage('Parental settings locked! ðŸ”’');
        }

        function setupParentalControls() {
            const dailyLimitCheckbox = document.getElementById('dailyLimitEnabled');
            const dailyLimitInput = document.getElementById('dailyLimitHours');
            const bedtimeCheckbox = document.getElementById('bedtimeMode');
            const weekendCheckbox = document.getElementById('weekendMode');
            const breakReminderCheckbox = document.getElementById('breakReminderEnabled');
            const targetModeSelect = document.getElementById('targetModeSelect');

            if (dailyLimitCheckbox) {
                dailyLimitCheckbox.addEventListener('change', function() {
                    parentalSettings.dailyLimitEnabled = this.checked;
                    dailyLimitInput.disabled = !this.checked;
                    saveSettings();
                });
            }

            if (dailyLimitInput) {
                dailyLimitInput.addEventListener('change', function() {
                    parentalSettings.dailyLimitHours = parseFloat(this.value);
                    saveSettings();
                });
            }

            if (bedtimeCheckbox) {
                bedtimeCheckbox.addEventListener('change', function() {
                    parentalSettings.bedtimeMode = this.checked;
                    saveSettings();
                    checkBedtimeMode();
                });
            }

            if (weekendCheckbox) {
                weekendCheckbox.addEventListener('change', function() {
                    parentalSettings.weekendMode = this.checked;
                    saveSettings();
                });
            }

            if (breakReminderCheckbox) {
                breakReminderCheckbox.addEventListener('change', function() {
                    parentalSettings.breakReminderEnabled = this.checked;
                    saveSettings();
                    setupBreakReminders();
                });
            }

            // Hide parental button option
            const hideParentalCheckbox = document.getElementById('hideParentalBtn');
            if (hideParentalCheckbox) {
                hideParentalCheckbox.addEventListener('change', function() {
                    parentalSettings.hideParentalBtn = this.checked;
                    saveSettings();
                    updateParentalButtonVisibility();
                });
            }

            if (targetModeSelect) {
                targetModeSelect.addEventListener('change', function() {
                    parentalSettings.targetMode = this.value;
                    saveSettings();
                    applyBaseVideoFilter();
                });
            }
        }

        function setupBreakReminders() {
            if (breakReminderInterval) {
                clearInterval(breakReminderInterval);
                breakReminderInterval = null;
            }

            if (breakReminderDuration > 0 && parentalSettings.breakReminderEnabled) {
                breakReminderInterval = setInterval(() => {
                    if (tonedownActive) {
                        showBreakReminder();
                    }
                }, breakReminderDuration);
            }
        }

        function showBreakReminder() {
            const now = Date.now();
            if (now - lastBreakTime > breakReminderDuration) {
                showSuccessMessage('Time for a break! Look away from the screen for 20 seconds! ðŸ‘€');
                lastBreakTime = now;
            }
        }

        function checkBedtimeMode() {
            if (!parentalSettings.bedtimeMode) return;
            
            const now = new Date();
            const hour = now.getHours();
            
            if (hour >= 21 || hour < 7) { // 9 PM to 7 AM
                showSuccessMessage('It\'s bedtime! Screen time is limited. ðŸŒ™');
                if (tonedownActive) {
                    completeTonedown();
                }
            }
        }

        function updateStatistics() {
            const todayTime = document.getElementById('todayTime');
            const weekTime = document.getElementById('weekTime');
            const sessionCountEl = document.getElementById('sessionCount');
            const avgSession = document.getElementById('avgSession');

            if (todayTime) todayTime.textContent = formatTime(dailyUsage);
            if (weekTime) weekTime.textContent = formatTime(weeklyUsage);
            if (sessionCountEl) sessionCountEl.textContent = sessionCount;
            if (avgSession) {
                const avg = sessionCount > 0 ? totalSessionTime / sessionCount : 0;
                avgSession.textContent = formatTime(avg);
            }
        }

        function saveSettings() {
            localStorage.setItem('parentalSettings', JSON.stringify(parentalSettings));
            localStorage.setItem('usageStats', JSON.stringify({
                dailyUsage,
                weeklyUsage,
                sessionCount,
                totalSessionTime
            }));
        }

        function loadSettings() {
            const savedSettings = localStorage.getItem('parentalSettings');
            if (savedSettings) {
                parentalSettings = { ...parentalSettings, ...JSON.parse(savedSettings) };
            }

            const savedStats = localStorage.getItem('usageStats');
            if (savedStats) {
                const stats = JSON.parse(savedStats);
                dailyUsage = stats.dailyUsage || 0;
                weeklyUsage = stats.weeklyUsage || 0;
                sessionCount = stats.sessionCount || 0;
                totalSessionTime = stats.totalSessionTime || 0;
            }

            // Update UI
            document.getElementById('dailyLimitEnabled').checked = parentalSettings.dailyLimitEnabled;
            document.getElementById('dailyLimitHours').value = parentalSettings.dailyLimitHours;
            document.getElementById('dailyLimitHours').disabled = !parentalSettings.dailyLimitEnabled;
            document.getElementById('bedtimeMode').checked = parentalSettings.bedtimeMode;
            document.getElementById('weekendMode').checked = parentalSettings.weekendMode;
            document.getElementById('breakReminderEnabled').checked = parentalSettings.breakReminderEnabled;
            document.getElementById('hideParentalBtn').checked = parentalSettings.hideParentalBtn;
            const targetModeSelect = document.getElementById('targetModeSelect');
            if (targetModeSelect) targetModeSelect.value = parentalSettings.targetMode || 'none';
            
            // Update parental button visibility
            updateParentalButtonVisibility();

            // Apply base filter on load
            applyBaseVideoFilter();
            
            // Update sidebar active state
            updateActiveFilterOption();
        }

        function toggleTonedown() {
            const toggleBtn = document.getElementById('tonedownToggle');
            const progressFill = document.getElementById('progressFill');
            
            if (!tonedownActive) {
                // Start tone-down
                tonedownActive = true;
                tonedownStartTime = Date.now();
                
                toggleBtn.innerHTML = '<i class="fas fa-pause"></i> Pause Timer';
                toggleBtn.classList.add('active');
                
                // Start timer
                tonedownTimer = setInterval(updateTonedownProgress, 1000);
                
                // Setup break reminders
                setupBreakReminders();
                
                showSuccessMessage('Screen time timer started! Video will gradually dim! ðŸŒ™');
            } else {
                // Pause tone-down
                tonedownActive = false;
                
                toggleBtn.innerHTML = '<i class="fas fa-play"></i> Resume Timer';
                toggleBtn.classList.remove('active');
                
                // Reset video tonedown effect
                resetVideoTonedown();
                
                // Stop timer
                if (tonedownTimer) {
                    clearInterval(tonedownTimer);
                    tonedownTimer = null;
                }
                
                // Stop break reminders
                if (breakReminderInterval) {
                    clearInterval(breakReminderInterval);
                    breakReminderInterval = null;
                }
                
                showSuccessMessage('Timer paused! Video colors restored! â¸ï¸');
            }
        }

        function updateTonedownProgress() {
            if (!tonedownActive || !tonedownStartTime) return;
            
            const elapsed = Date.now() - tonedownStartTime;
            const remaining = Math.max(0, tonedownDuration - elapsed);
            const progress = Math.min(100, (elapsed / tonedownDuration) * 100);
            
            // Update progress bar
            const progressFill = document.getElementById('progressFill');
            if (progressFill) {
                progressFill.style.width = progress + '%';
            }
            
            // Update time display
            updateTimeDisplay();
            
            // Apply tonedown effect only to video player
            applyVideoTonedown(progress);
            
            // Check if time is up
            if (remaining <= 0) {
                completeTonedown();
            }
        }
        
        function applyVideoTonedown(progress) {
            const videoPlayer = document.getElementById('videoPlayer');
            const videoIframe = videoPlayer.querySelector('iframe');
            
            if (!videoPlayer) return;
            
            // Calculate gradual effects based on progress
            const saturation = calculateGradualSaturation(progress);
            const brightness = calculateGradualBrightness(progress);
            const contrast = calculateGradualContrast(progress);
            
            // Combine base filter with tonedown overlay
            const base = computeBaseFilter();
            const filterValue = `${base} saturate(${saturation}) brightness(${brightness}) contrast(${contrast})`;
            
            // Apply tonedown effect only to video player
            videoPlayer.style.filter = filterValue;
            
            // Also apply to iframe if it exists (for YouTube videos)
            if (videoIframe) {
                videoIframe.style.filter = filterValue;
            }
            
            // Handle fullscreen mode - check if video is in fullscreen
            const fullscreenElement = document.fullscreenElement || 
                                    document.webkitFullscreenElement || 
                                    document.mozFullScreenElement || 
                                    document.msFullscreenElement;
            
            if (fullscreenElement === videoPlayer) {
                // Video is in fullscreen, ensure tonedown applies
                videoPlayer.style.filter = filterValue;
                if (videoIframe) {
                    videoIframe.style.filter = filterValue;
                }
            }
        }

        // Compute the base filter from parentalSettings.targetMode
        function computeBaseFilter() {
            switch (parentalSettings.targetMode) {
                case 'reduce_addiction':
                    // Desaturated, low saturation
                    return 'saturate(0.6) contrast(0.95) ';
                case 'sleep_warm':
                    // Warm amber tone via sepia + hue/rotate + reduced blue
                    return 'sepia(0.6) hue-rotate(10deg) saturate(0.9) brightness(0.98) ';
                case 'calm_cool':
                    // Cool soft tones
                    return 'hue-rotate(190deg) saturate(0.85) brightness(0.96) ';
                case 'focus_monotone':
                    // Monotone/low contrast
                    return 'grayscale(0.6) contrast(0.9) brightness(0.98) ';
                case 'memory_balanced':
                    // Balanced natural tones
                    return 'saturate(0.9) contrast(0.98) brightness(1.0) ';
                case 'creativity_soft':
                    // Soft pastel artistic
                    return 'saturate(0.85) contrast(0.94) brightness(1.02) ';
                case 'anxiety_green':
                    // Calming green/blue tint
                    return 'hue-rotate(150deg) saturate(0.85) brightness(0.97) ';
                case 'none':
                default:
                    return '';
            }
        }

        // Apply only the base filter (used on load, video change, or mode change)
        function applyBaseVideoFilter() {
            const videoPlayer = document.getElementById('videoPlayer');
            if (!videoPlayer) return;
            const videoIframe = videoPlayer.querySelector('iframe');
            const base = computeBaseFilter();
            videoPlayer.style.filter = base.trim();
            if (videoIframe) videoIframe.style.filter = base.trim();
        }
        
        // Sidebar functionality
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.toggle('open');
            overlay.classList.toggle('show');
            
            // Update active filter option
            updateActiveFilterOption();
            
            // Update timer status
            updateTimerStatus();
        }
        
        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.remove('open');
            overlay.classList.remove('show');
            
            // Close all dropdowns when sidebar closes
            closeAllDropdowns();
        }
        
        function closeAllDropdowns() {
            // Close Video Filters dropdown
            const filterDropdown = document.getElementById('filterDropdown');
            const filterArrow = document.getElementById('dropdownArrow');
            if (filterDropdown && filterArrow) {
                filterDropdown.classList.remove('open');
                filterArrow.classList.remove('rotated');
            }
            
            // Close Screen Time dropdown
            const screenTimeDropdown = document.getElementById('screenTimeDropdown');
            const screenTimeArrow = document.getElementById('screenTimeArrow');
            if (screenTimeDropdown && screenTimeArrow) {
                screenTimeDropdown.classList.remove('open');
                screenTimeArrow.classList.remove('rotated');
            }
            
            // Close Parental Controls dropdown
            const parentalDropdown = document.getElementById('parentalDropdown');
            const parentalArrow = document.getElementById('parentalArrow');
            if (parentalDropdown && parentalArrow) {
                parentalDropdown.classList.remove('open');
                parentalArrow.classList.remove('rotated');
            }
        }
        
        function selectFilter(filterMode) {
            parentalSettings.targetMode = filterMode;
            saveSettings();
            applyBaseVideoFilter();
            updateActiveFilterOption();
            showSuccessMessage(`Filter applied: ${getFilterDisplayName(filterMode)}! ðŸŽ¨`);
        }
        
        function updateActiveFilterOption() {
            // Remove active class from all options
            document.querySelectorAll('.filter-option').forEach(option => {
                option.classList.remove('active');
            });
            
            // Add active class to current selection
            const currentMode = parentalSettings.targetMode || 'none';
            const activeOption = document.querySelector(`[onclick="selectFilter('${currentMode}')"]`);
            if (activeOption) {
                activeOption.classList.add('active');
            }
        }
        
        function getFilterDisplayName(filterMode) {
            const names = {
                'none': 'No Filter',
                'reduce_addiction': 'Reduce Screen Addiction',
                'sleep_warm': 'Help with Sleep',
                'calm_cool': 'Calm Overstimulation',
                'focus_monotone': 'Improve Focus',
                'memory_balanced': 'Enhance Memory',
                'creativity_soft': 'Stimulate Creativity',
                'anxiety_green': 'Reduce Anxiety'
            };
            return names[filterMode] || 'Unknown';
        }
        
        function openParentalControls() {
            closeSidebar();
            toggleParentalPanel();
        }
        
        function toggleFilterDropdown() {
            const dropdown = document.getElementById('filterDropdown');
            const arrow = document.getElementById('dropdownArrow');
            
            dropdown.classList.toggle('open');
            arrow.classList.toggle('rotated');
        }
        
        function toggleScreenTimeDropdown() {
            const dropdown = document.getElementById('screenTimeDropdown');
            const arrow = document.getElementById('screenTimeArrow');
            
            dropdown.classList.toggle('open');
            arrow.classList.toggle('rotated');
        }
        
        function toggleParentalDropdown() {
            const dropdown = document.getElementById('parentalDropdown');
            const arrow = document.getElementById('parentalArrow');
            
            dropdown.classList.toggle('open');
            arrow.classList.toggle('rotated');
        }
        
        function startQuickTimer() {
            // Set a 5-minute timer
            parentalSettings.timerDuration = 5;
            parentalSettings.timerActive = true;
            parentalSettings.timerStartTime = Date.now();
            saveSettings();
            
            // Start the timer
            startTimer();
            
            // Close sidebar
            closeSidebar();
            
            showSuccessMessage('Quick 5-minute timer started! â°');
        }
        
        function toggleStatsPanel() {
            // Close sidebar first
            closeSidebar();
            
            // Toggle stats panel (if it exists) or show a message
            if (typeof toggleParentalPanel === 'function') {
                toggleParentalPanel();
            } else {
                showSuccessMessage('Statistics feature coming soon! ðŸ“Š');
            }
        }
        
        function updateTimerStatus() {
            const timerIcon = document.getElementById('timerIcon');
            const timerText = document.getElementById('timerText');
            const timerStatus = document.getElementById('timerStatus');
            
            if (!timerIcon || !timerText || !timerStatus) return;
            
            if (parentalSettings.timerActive) {
                timerIcon.className = 'fas fa-pause';
                timerText.textContent = 'Pause Timer';
                timerStatus.textContent = 'Timer is running';
            } else {
                timerIcon.className = 'fas fa-play';
                timerText.textContent = 'Start Timer';
                timerStatus.textContent = 'Ready to start';
            }
        }
        
        // Video Overlay Controls
        function setupVideoOverlay() {
            const playBtn = document.getElementById('overlayPlayBtn');
            const progressBar = document.getElementById('overlayProgressBar');
            const volumeBtn = document.getElementById('overlayVolumeBtn');
            const volumeSlider = document.getElementById('overlayVolumeSlider');
            const fullscreenBtn = document.getElementById('overlayFullscreenBtn');
            const toggleBtn = document.getElementById('overlayToggleBtn');
            
            if (playBtn) {
                playBtn.addEventListener('click', toggleVideoPlayback);
            }
            
            if (progressBar) {
                progressBar.addEventListener('click', seekVideo);
            }
            
            if (volumeBtn) {
                volumeBtn.addEventListener('click', toggleVideoMute);
            }
            
            if (volumeSlider) {
                volumeSlider.addEventListener('click', adjustVolume);
            }
            
            if (fullscreenBtn) {
                fullscreenBtn.addEventListener('click', toggleFullscreen);
            }
            
            if (toggleBtn) {
                toggleBtn.addEventListener('click', toggleOverlayVisibility);
            }
        }
        
        function toggleVideoPlayback() {
            if (!youtubePlayer) {
                showSuccessMessage('Video player not ready yet! Please wait... â³');
                return;
            }
            
            const playBtn = document.getElementById('overlayPlayBtn');
            const icon = playBtn ? playBtn.querySelector('i') : null;
            
            try {
                if (isVideoPlaying) {
                    // Pause video
                    youtubePlayer.pauseVideo();
                    showSuccessMessage('Video paused! â¸ï¸');
                } else {
                    // Play video
                    youtubePlayer.playVideo();
                    showSuccessMessage('Video playing! â–¶ï¸');
                }
            } catch (error) {
                console.error('Error controlling video:', error);
                showSuccessMessage('Error controlling video. Please try again! âŒ');
            }
        }
        
        
        function seekVideo(event) {
            const progressBar = event.currentTarget;
            const rect = progressBar.getBoundingClientRect();
            const clickX = event.clientX - rect.left;
            const percentage = clickX / rect.width;
            
            // Update progress bar visual
            const progressFill = document.getElementById('overlayProgressFill');
            if (progressFill) {
                progressFill.style.width = (percentage * 100) + '%';
            }
            
            // Try to seek in YouTube video
            const videoPlayer = document.getElementById('videoPlayer');
            const iframe = videoPlayer.querySelector('iframe');
            
            if (iframe) {
                try {
                    // Send seek command to YouTube
                    iframe.contentWindow.postMessage(`{"event":"command","func":"seekTo","args":"${Math.floor(percentage * 100)}"}`, '*');
                    showSuccessMessage(`Seeked to ${Math.floor(percentage * 100)}%`);
                } catch (error) {
                    console.log('Seek not available:', error);
                }
            }
        }
        
        function toggleVideoMute() {
            const volumeBtn = document.getElementById('overlayVolumeBtn');
            const icon = volumeBtn.querySelector('i');
            const videoPlayer = document.getElementById('videoPlayer');
            const iframe = videoPlayer.querySelector('iframe');
            
            // Toggle mute state
            if (icon.classList.contains('fa-volume-up')) {
                icon.className = 'fas fa-volume-mute';
                if (iframe) {
                    try {
                        iframe.contentWindow.postMessage('{"event":"command","func":"mute","args":""}', '*');
                        showSuccessMessage('Video muted! ðŸ”‡');
                    } catch (error) {
                        console.log('Mute not available:', error);
                    }
                }
            } else {
                icon.className = 'fas fa-volume-up';
                if (iframe) {
                    try {
                        iframe.contentWindow.postMessage('{"event":"command","func":"unMute","args":""}', '*');
                        showSuccessMessage('Video unmuted! ðŸ”Š');
                    } catch (error) {
                        console.log('Unmute not available:', error);
                    }
                }
            }
        }
        
        function adjustVolume(event) {
            const volumeSlider = event.currentTarget;
            const rect = volumeSlider.getBoundingClientRect();
            const clickX = event.clientX - rect.left;
            const percentage = clickX / rect.width;
            const volume = Math.floor(percentage * 100);
            
            // Update volume slider visual
            const volumeFill = document.getElementById('overlayVolumeFill');
            if (volumeFill) {
                volumeFill.style.width = (percentage * 100) + '%';
            }
            
            // Try to set volume in YouTube video
            const videoPlayer = document.getElementById('videoPlayer');
            const iframe = videoPlayer.querySelector('iframe');
            
            if (iframe) {
                try {
                    iframe.contentWindow.postMessage(`{"event":"command","func":"setVolume","args":"${volume}"}`, '*');
                    showSuccessMessage(`Volume: ${volume}%`);
                } catch (error) {
                    console.log('Volume control not available:', error);
                }
            }
        }
        
        function toggleFullscreen() {
            const videoPlayer = document.getElementById('videoPlayer');
            const fullscreenBtn = document.getElementById('overlayFullscreenBtn');
            const icon = fullscreenBtn.querySelector('i');
            
            if (!document.fullscreenElement) {
                // Enter fullscreen
                if (videoPlayer.requestFullscreen) {
                    videoPlayer.requestFullscreen();
                } else if (videoPlayer.webkitRequestFullscreen) {
                    videoPlayer.webkitRequestFullscreen();
                } else if (videoPlayer.mozRequestFullScreen) {
                    videoPlayer.mozRequestFullScreen();
                } else if (videoPlayer.msRequestFullscreen) {
                    videoPlayer.msRequestFullscreen();
                }
                icon.className = 'fas fa-compress';
                showSuccessMessage('Fullscreen mode! Use overlay controls. ðŸ–¥ï¸');
            } else {
                // Exit fullscreen
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
                icon.className = 'fas fa-expand';
                showSuccessMessage('Exited fullscreen mode! ðŸ–¥ï¸');
            }
        }
        
        function toggleOverlayVisibility() {
            const videoPlayer = document.getElementById('videoPlayer');
            const toggleBtn = document.getElementById('overlayToggleBtn');
            const icon = toggleBtn.querySelector('i');
            
            videoPlayer.classList.toggle('overlay-hidden');
            
            if (videoPlayer.classList.contains('overlay-hidden')) {
                icon.className = 'fas fa-eye';
            } else {
                icon.className = 'fas fa-eye-slash';
            }
        }
        
        function handleVideoClick() {
            const videoPlayer = document.getElementById('videoPlayer');
            const iframe = videoPlayer.querySelector('iframe');
            const playBtn = document.getElementById('overlayPlayBtn');
            const icon = playBtn.querySelector('i');
            
            if (!iframe) return;
            
            // Temporarily enable iframe interaction
            iframe.style.pointerEvents = 'auto';
            
            // Toggle play/pause state
            if (icon.classList.contains('fa-play')) {
                icon.className = 'fas fa-pause';
                showSuccessMessage('Video playing! â–¶ï¸');
            } else {
                icon.className = 'fas fa-play';
                showSuccessMessage('Video paused! â¸ï¸');
            }
            
            // Restore pointer-events after a short delay
            setTimeout(() => {
                iframe.style.pointerEvents = 'none';
            }, 1000);
        }
        
        // Prevent YouTube redirects and unwanted interactions
        function preventYouTubeRedirects() {
            // Block any attempts to navigate away from the page
            window.addEventListener('beforeunload', function(e) {
                e.preventDefault();
                e.returnValue = '';
                return '';
            });
            
            // Block YouTube iframe navigation
            document.addEventListener('click', function(e) {
                if (e.target.tagName === 'IFRAME') {
                    e.preventDefault();
                    e.stopPropagation();
                    return false;
                }
            });
            
            // Block right-click context menu on iframe
            document.addEventListener('contextmenu', function(e) {
                if (e.target.tagName === 'IFRAME') {
                    e.preventDefault();
                    return false;
                }
            });
        }
        
        function calculateGradualSaturation(progress) {
            // Very gradual saturation reduction
            if (progress < 0.1) return 1.0; // No change for first 10%
            if (progress < 0.3) return 1.0 - (progress - 0.1) * 0.2; // 0.98 to 0.96
            if (progress < 0.6) return 0.96 - (progress - 0.3) * 0.3; // 0.96 to 0.87
            if (progress < 0.9) return 0.87 - (progress - 0.6) * 0.4; // 0.87 to 0.75
            return 0.75 - (progress - 0.9) * 0.65; // 0.75 to 0.1
        }
        
        function calculateGradualBrightness(progress) {
            // Very gradual brightness reduction
            if (progress < 0.2) return 1.0; // No change for first 20%
            if (progress < 0.5) return 1.0 - (progress - 0.2) * 0.1; // 1.0 to 0.97
            if (progress < 0.8) return 0.97 - (progress - 0.5) * 0.2; // 0.97 to 0.91
            return 0.91 - (progress - 0.8) * 0.45; // 0.91 to 0.82
        }
        
        function calculateGradualContrast(progress) {
            // Very gradual contrast reduction
            if (progress < 0.15) return 1.0; // No change for first 15%
            if (progress < 0.4) return 1.0 - (progress - 0.15) * 0.05; // 1.0 to 0.9875
            if (progress < 0.7) return 0.9875 - (progress - 0.4) * 0.1; // 0.9875 to 0.9575
            return 0.9575 - (progress - 0.7) * 0.3; // 0.9575 to 0.87
        }
        
        function resetVideoTonedown() {
            const videoPlayer = document.getElementById('videoPlayer');
            const videoIframe = videoPlayer.querySelector('iframe');
            
            if (videoPlayer) {
                videoPlayer.style.filter = 'none';
            }
            
            if (videoIframe) {
                videoIframe.style.filter = 'none';
            }
            
            // Handle fullscreen mode - check if video is in fullscreen
            const fullscreenElement = document.fullscreenElement || 
                                    document.webkitFullscreenElement || 
                                    document.mozFullScreenElement || 
                                    document.msFullscreenElement;
            
            if (fullscreenElement === videoPlayer) {
                // Video is in fullscreen, ensure reset applies
                videoPlayer.style.filter = 'none';
                if (videoIframe) {
                    videoIframe.style.filter = 'none';
                }
            }
        }

        function updateTimeDisplay() {
            const timeRemaining = document.getElementById('timeRemaining');
            const timeElapsed = document.getElementById('timeElapsed');
            
            if (!tonedownStartTime) {
                if (timeRemaining) timeRemaining.textContent = formatTime(tonedownDuration) + ' remaining';
                if (timeElapsed) timeElapsed.textContent = '0:00 elapsed';
                return;
            }
            
            const elapsed = Date.now() - tonedownStartTime;
            const remaining = Math.max(0, tonedownDuration - elapsed);
            
            if (timeRemaining) timeRemaining.textContent = formatTime(remaining) + ' remaining';
            if (timeElapsed) timeElapsed.textContent = formatTime(elapsed) + ' elapsed';
        }

        function formatTime(milliseconds) {
            const totalSeconds = Math.floor(milliseconds / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return minutes + ':' + (seconds < 10 ? '0' : '') + seconds;
        }

        function completeTonedown() {
            tonedownActive = false;
            
            const toggleBtn = document.getElementById('tonedownToggle');
            if (toggleBtn) {
                toggleBtn.innerHTML = '<i class="fas fa-play"></i> Start Timer';
                toggleBtn.classList.remove('active');
            }
            
            // Track statistics
            if (tonedownStartTime) {
                const sessionTime = Date.now() - tonedownStartTime;
                dailyUsage += sessionTime;
                weeklyUsage += sessionTime;
                sessionCount++;
                totalSessionTime += sessionTime;
                saveSettings();
            }
            
            // Apply maximum tone-down effect only to video
            const videoPlayer = document.getElementById('videoPlayer');
            const videoIframe = videoPlayer.querySelector('iframe');
            
            if (videoPlayer) {
                videoPlayer.style.filter = 'saturate(0.05) brightness(0.6) contrast(0.7)';
            }
            
            if (videoIframe) {
                videoIframe.style.filter = 'saturate(0.05) brightness(0.6) contrast(0.7)';
            }
            
            // Stop timer
            if (tonedownTimer) {
                clearInterval(tonedownTimer);
                tonedownTimer = null;
            }
            
            // Stop break reminders
            if (breakReminderInterval) {
                clearInterval(breakReminderInterval);
                breakReminderInterval = null;
            }
            
            showSuccessMessage('Screen time complete! Video is now very dim - time for a break! ðŸŒ™âœ¨');
        }

        function resetTonedown() {
            tonedownActive = false;
            tonedownStartTime = null;
            
            const toggleBtn = document.getElementById('tonedownToggle');
            const progressFill = document.getElementById('progressFill');
            
            if (toggleBtn) {
                toggleBtn.innerHTML = '<i class="fas fa-play"></i> Start Timer';
                toggleBtn.classList.remove('active');
            }
            
            if (progressFill) {
                progressFill.style.width = '0%';
            }
            
            // Reset video tonedown effects
            resetVideoTonedown();
            
            // Stop timer
            if (tonedownTimer) {
                clearInterval(tonedownTimer);
                tonedownTimer = null;
            }
            
            updateTimeDisplay();
            showSuccessMessage('Timer reset! Video colors restored! ðŸ”„');
        }

        function updateParentalButtonVisibility() {
            const parentalBtn = document.getElementById('parentalBtn');
            if (parentalBtn) {
                if (parentalSettings.hideParentalBtn) {
                    parentalBtn.style.display = 'none';
                } else {
                    parentalBtn.style.display = 'flex';
                }
            }
        }

        // Break System Functions
        function startBreakTimer() {
            // Clear any existing timer
            if (breakInterval) {
                clearInterval(breakInterval);
            }
            
            videoStartTime = Date.now();
            
            // Set up break reminder every 15 minutes
            breakInterval = setInterval(() => {
                showBreakModal();
            }, breakDuration);
        }

        function stopBreakTimer() {
            if (breakInterval) {
                clearInterval(breakInterval);
                breakInterval = null;
            }
            videoStartTime = null;
        }

        function showBreakModal() {
            // Create break modal
            const modal = document.createElement('div');
            modal.id = 'breakModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                font-family: 'Fredoka', sans-serif;
            `;

            // Get random game
            const game = getRandomBreakGame();
            
            modal.innerHTML = `
                <div style="
                    background: var(--bg-white);
                    border-radius: 20px;
                    padding: 2rem;
                    max-width: 500px;
                    width: 90%;
                    text-align: center;
                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                    position: relative;
                ">
                    <div style="
                        position: absolute;
                        top: -10px;
                        right: -10px;
                        width: 30px;
                        height: 20px;
                        background: radial-gradient(ellipse, var(--primary-pink) 12px 8px, transparent 12px 8px);
                    "></div>
                    <div style="
                        position: absolute;
                        bottom: -8px;
                        left: -8px;
                        width: 25px;
                        height: 15px;
                        background: radial-gradient(ellipse, var(--primary-blue) 10px 6px, transparent 10px 6px);
                    "></div>
                    
                    <h2 style="color: var(--text-dark); margin-bottom: 1rem; font-family: 'Fredoka One', cursive;">
                        ðŸŽ® Break Time! ðŸŽ®
                    </h2>
                    <p style="color: var(--text-light); margin-bottom: 2rem;">
                        You've been watching for 15 minutes! Let's play a fun game! ðŸ¦•
                    </p>
                    
                    <div id="breakGameContent" style="margin-bottom: 2rem;">
                        ${game.html}
                    </div>
                    
                    <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                        <button onclick="completeBreakGame()" style="
                            background: var(--primary-green);
                            color: white;
                            border: none;
                            padding: 1rem 2rem;
                            border-radius: 15px;
                            font-family: 'Fredoka', sans-serif;
                            font-weight: 600;
                            font-size: 1rem;
                            cursor: pointer;
                            transition: all 0.3s ease;
                        " onmouseover="this.style.background='#4ECDC4'" onmouseout="this.style.background='var(--primary-green)'">
                            âœ… I'm Done! Continue Watching
                        </button>
                        <button onclick="skipBreak()" style="
                            background: var(--primary-orange);
                            color: white;
                            border: none;
                            padding: 1rem 2rem;
                            border-radius: 15px;
                            font-family: 'Fredoka', sans-serif;
                            font-weight: 600;
                            font-size: 1rem;
                            cursor: pointer;
                            transition: all 0.3s ease;
                        " onmouseover="this.style.background='#FF8C00'" onmouseout="this.style.background='var(--primary-orange)'">
                            â­ï¸ Skip Break
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            currentBreakGame = game;
        }

        function getRandomBreakGame() {
            const games = [
                {
                    name: "Dinosaur Memory Game",
                    html: `
                        <div style="margin-bottom: 1rem;">
                            <h3 style="color: var(--text-dark); margin-bottom: 1rem;">ðŸ¦• Find the Matching Dinosaurs! ðŸ¦•</h3>
                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.5rem; max-width: 300px; margin: 0 auto;">
                                <div onclick="flipCard(this)" style="
                                    width: 60px; height: 60px; background: var(--primary-pink); 
                                    border-radius: 10px; display: flex; align-items: center; 
                                    justify-content: center; cursor: pointer; font-size: 1.5rem;
                                ">ðŸ¦•</div>
                                <div onclick="flipCard(this)" style="
                                    width: 60px; height: 60px; background: var(--primary-blue); 
                                    border-radius: 10px; display: flex; align-items: center; 
                                    justify-content: center; cursor: pointer; font-size: 1.5rem;
                                ">ðŸ¦–</div>
                                <div onclick="flipCard(this)" style="
                                    width: 60px; height: 60px; background: var(--primary-yellow); 
                                    border-radius: 10px; display: flex; align-items: center; 
                                    justify-content: center; cursor: pointer; font-size: 1.5rem;
                                ">ðŸ¦•</div>
                                <div onclick="flipCard(this)" style="
                                    width: 60px; height: 60px; background: var(--primary-green); 
                                    border-radius: 10px; display: flex; align-items: center; 
                                    justify-content: center; cursor: pointer; font-size: 1.5rem;
                                ">ðŸ¦–</div>
                            </div>
                            <p style="font-size: 0.9rem; color: var(--text-light); margin-top: 1rem;">
                                Click the dinosaurs to find matching pairs!
                            </p>
                        </div>
                    `
                },
                {
                    name: "Color Counting Game",
                    html: `
                        <div style="margin-bottom: 1rem;">
                            <h3 style="color: var(--text-dark); margin-bottom: 1rem;">ðŸŒˆ Count the Colors! ðŸŒˆ</h3>
                            <div style="display: flex; gap: 1rem; justify-content: center; margin-bottom: 1rem; flex-wrap: wrap;">
                                <div style="width: 40px; height: 40px; background: var(--primary-pink); border-radius: 50%;"></div>
                                <div style="width: 40px; height: 40px; background: var(--primary-blue); border-radius: 50%;"></div>
                                <div style="width: 40px; height: 40px; background: var(--primary-yellow); border-radius: 50%;"></div>
                                <div style="width: 40px; height: 40px; background: var(--primary-green); border-radius: 50%;"></div>
                                <div style="width: 40px; height: 40px; background: var(--primary-orange); border-radius: 50%;"></div>
                            </div>
                            <p style="font-size: 1.2rem; color: var(--text-dark); font-weight: 600;">
                                How many circles do you see? <span id="colorAnswer" style="color: var(--primary-pink);">5</span>
                            </p>
                        </div>
                    `
                },
                {
                    name: "Shape Puzzle",
                    html: `
                        <div style="margin-bottom: 1rem;">
                            <h3 style="color: var(--text-dark); margin-bottom: 1rem;">ðŸ”· Complete the Pattern! ðŸ”·</h3>
                            <div style="display: flex; gap: 1rem; justify-content: center; margin-bottom: 1rem; flex-wrap: wrap;">
                                <div style="width: 50px; height: 50px; background: var(--primary-pink); border-radius: 10px;"></div>
                                <div style="width: 50px; height: 50px; background: var(--primary-blue); border-radius: 50%;"></div>
                                <div style="width: 50px; height: 50px; background: var(--primary-yellow); border-radius: 10px;"></div>
                                <div style="width: 50px; height: 50px; background: var(--primary-green); border-radius: 50%;"></div>
                                <div style="width: 50px; height: 50px; background: var(--primary-orange); border-radius: 10px; border: 3px dashed var(--text-light);"></div>
                            </div>
                            <p style="font-size: 1rem; color: var(--text-dark);">
                                What shape should go in the empty space? <br>
                                <button onclick="checkShapeAnswer('circle')" style="
                                    background: var(--primary-blue); color: white; border: none; 
                                    padding: 0.5rem 1rem; margin: 0.5rem; border-radius: 10px; cursor: pointer;
                                ">Circle</button>
                                <button onclick="checkShapeAnswer('square')" style="
                                    background: var(--primary-pink); color: white; border: none; 
                                    padding: 0.5rem 1rem; margin: 0.5rem; border-radius: 10px; cursor: pointer;
                                ">Square</button>
                            </p>
                        </div>
                    `
                },
                {
                    name: "Animal Sounds Game",
                    html: `
                        <div style="margin-bottom: 1rem;">
                            <h3 style="color: var(--text-dark); margin-bottom: 1rem;">ðŸ¶ What Sound Does This Animal Make? ðŸ¶</h3>
                            <div style="font-size: 4rem; margin: 1rem 0;">ðŸ±</div>
                            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                                <button onclick="checkAnimalSound('meow')" style="
                                    background: var(--primary-green); color: white; border: none; 
                                    padding: 0.8rem 1.5rem; margin: 0.5rem; border-radius: 15px; cursor: pointer; font-size: 1rem;
                                ">Meow</button>
                                <button onclick="checkAnimalSound('woof')" style="
                                    background: var(--primary-orange); color: white; border: none; 
                                    padding: 0.8rem 1.5rem; margin: 0.5rem; border-radius: 15px; cursor: pointer; font-size: 1rem;
                                ">Woof</button>
                                <button onclick="checkAnimalSound('moo')" style="
                                    background: var(--primary-blue); color: white; border: none; 
                                    padding: 0.8rem 1.5rem; margin: 0.5rem; border-radius: 15px; cursor: pointer; font-size: 1rem;
                                ">Moo</button>
                            </div>
                        </div>
                    `
                }
            ];
            
            return games[Math.floor(Math.random() * games.length)];
        }

        function completeBreakGame() {
            const modal = document.getElementById('breakModal');
            if (modal) {
                modal.remove();
            }
            showSuccessMessage('Great job! Time to continue watching! ðŸŽ‰');
            // Restart the break timer
            startBreakTimer();
        }

        function skipBreak() {
            const modal = document.getElementById('breakModal');
            if (modal) {
                modal.remove();
            }
            showSuccessMessage('Break skipped! Continue watching! â­ï¸');
            // Restart the break timer
            startBreakTimer();
        }

        function flipCard(element) {
            element.style.transform = element.style.transform === 'rotateY(180deg)' ? 'rotateY(0deg)' : 'rotateY(180deg)';
            element.style.transition = 'transform 0.3s ease';
        }

        function checkShapeAnswer(answer) {
            if (answer === 'circle') {
                showSuccessMessage('Correct! It should be a circle! ðŸŽ‰');
            } else {
                showSuccessMessage('Try again! Look at the pattern! ðŸ¤”');
            }
        }

        function checkAnimalSound(answer) {
            if (answer === 'meow') {
                showSuccessMessage('Correct! Cats say meow! ðŸ±ðŸŽ‰');
            } else {
                showSuccessMessage('Not quite! Cats say meow! ðŸ±');
            }
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            loadSettings();
            setupParentalControls();
            updateTimerStatus();
            preventYouTubeRedirects();
            showSuccessMessage('Welcome to Kids Video App! ðŸŽ¬');
        });
    </script>
</body>
</html>
