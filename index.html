<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#FF6B6B">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>KidsTube - No Scroll Test</title>
    <link rel="stylesheet" href="kids-styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Fredoka:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        /* Hide Primary Scrollbar */
        html {
            overflow: -moz-scrollbars-none; /* Firefox */
            -ms-overflow-style: none; /* Internet Explorer 10+ */
        }
        
        html::-webkit-scrollbar {
            display: none; /* WebKit */
        }
        
        body {
            overflow: -moz-scrollbars-none; /* Firefox */
            -ms-overflow-style: none; /* Internet Explorer 10+ */
        }
        
        body::-webkit-scrollbar {
            display: none; /* WebKit */
        }
        
        /* Hide scrollbars for all elements but keep scrolling functionality */
        * {
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* Internet Explorer 10+ */
        }
        
        *::-webkit-scrollbar {
            display: none; /* WebKit */
        }
        
        /* Re-enable custom scrollbars for specific containers */
        .recommendations-section {
            scrollbar-width: thin; /* Firefox */
            -ms-overflow-style: auto; /* Internet Explorer 10+ */
        }
        
        .playlist-preview-list {
            scrollbar-width: thin; /* Firefox */
            -ms-overflow-style: auto; /* Internet Explorer 10+ */
        }
        
        /* Liquid Glass Design System - Subtle Colors */
        :root {
            /* Premium Color System */
            --glass-bg: rgba(255, 255, 255, 0.25);
            --glass-border: rgba(255, 255, 255, 0.4);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            --glass-backdrop: blur(15px);
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-accent: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --solid-primary: #667eea;
            --solid-secondary: #f093fb;
            --solid-accent: #4facfe;
            
            /* Professional Typography System */
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.9);
            --text-muted: rgba(255, 255, 255, 0.7);
            --text-light: #ffffff;
            
            /* Premium Shadow System */
            --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.07), 0 2px 4px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1), 0 4px 6px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.1), 0 10px 10px rgba(0, 0, 0, 0.04);
            --shadow-2xl: 0 25px 50px rgba(0, 0, 0, 0.15);
            --shadow-glow: 0 0 20px rgba(102, 126, 234, 0.3);
            
            /* Premium Spacing System */
            --space-xs: 0.25rem;
            --space-sm: 0.5rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
            --space-2xl: 3rem;
            --space-3xl: 4rem;
            
            /* Premium Border Radius */
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-2xl: 1.5rem;
            --radius-full: 9999px;
            
            /* Animation Timing */
            --timing-fast: 150ms;
            --timing-normal: 300ms;
            --timing-slow: 500ms;
            --easing-ease: cubic-bezier(0.4, 0, 0.2, 1);
            --easing-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Fredoka', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding-top: 80px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 400% 400%;
            animation: gradientShift 20s ease infinite;
            min-height: 100vh;
            color: #2d3748;
            position: relative;
            overflow-x: hidden;
            font-weight: 400;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* Premium Typography Hierarchy */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Fredoka One', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-weight: 400;
            line-height: 1.2;
            margin: 0;
            color: #2d3748;
        }
        
        h1 { font-size: 2.5rem; letter-spacing: -0.025em; color: #1a202c; }
        h2 { font-size: 2rem; letter-spacing: -0.025em; color: #2d3748; }
        h3 { font-size: 1.5rem; letter-spacing: -0.025em; color: #2d3748; }
        h4 { font-size: 1.25rem; letter-spacing: -0.025em; color: #2d3748; }
        h5 { font-size: 1.125rem; letter-spacing: -0.025em; color: #2d3748; }
        h6 { font-size: 1rem; letter-spacing: -0.025em; color: #2d3748; }
        
        p {
            margin: 0;
            color: #4a5568;
            line-height: 1.6;
        }
        
        .text-xs { font-size: 0.75rem; }
        .text-sm { font-size: 0.875rem; }
        .text-base { font-size: 1rem; }
        .text-lg { font-size: 1.125rem; }
        .text-xl { font-size: 1.25rem; }
        .text-2xl { font-size: 1.5rem; }
        .text-3xl { font-size: 1.875rem; }
        .text-4xl { font-size: 2.25rem; }
        
        .font-light { font-weight: 300; }
        .font-normal { font-weight: 400; }
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(168, 181, 209, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(184, 197, 209, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(200, 213, 209, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }
        
        /* Glass Morphism Base */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-backdrop);
            -webkit-backdrop-filter: var(--glass-backdrop);
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            border-radius: 20px;
        }
        
        .glass-strong {
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: var(--shadow-medium);
        }
        
        /* Main App Container */
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header Glass Styling */
        .header {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: var(--shadow-xl), var(--shadow-glow);
            color: #2d3748;
            padding: var(--space-xl);
            text-align: center;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            z-index: 1000 !important;
            overflow: hidden;
            margin: 0 !important;
            border-radius: 0 0 var(--radius-2xl) var(--radius-2xl);
            transition: none !important;
            transform: none !important;
            width: 100% !important;
            height: 80px !important;
            display: flex !important;
            align-items: center !important;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            border-radius: inherit;
            pointer-events: none;
        }
        
        .header:hover {
            box-shadow: var(--shadow-2xl), 0 0 30px rgba(102, 126, 234, 0.4);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .header:active {
            transition: all var(--timing-fast) var(--easing-ease);
        }
        
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1000px;
            margin: 0 auto;
            gap: var(--space-lg);
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: var(--space-lg);
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }
        
        .logo {
            display: flex;
            align-items: center;
            font-size: 1.8rem;
            font-weight: bold;
            font-family: 'Fredoka One', cursive;
            color: #2d3748;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        .logo:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: scale(1.05);
        }
        
        .logo i {
            margin-right: 10px;
            font-size: 2rem;
            color: #667eea;
        }
        
        /* Search Container Glass Styling */
        .search-container {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-full);
            padding: var(--space-sm);
            box-shadow: var(--shadow-lg);
            transition: all var(--timing-normal) var(--easing-ease);
            flex: 1;
            max-width: 500px;
            margin: 0 var(--space-lg);
            position: relative;
            overflow: hidden;
        }
        
        .search-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            border-radius: inherit;
            pointer-events: none;
        }
        
        .search-container:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: var(--shadow-xl), 0 0 20px rgba(102, 126, 234, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
        }
        
        .search-container:focus-within {
            transform: translateY(-2px) scale(1.02);
            border-color: rgba(102, 126, 234, 0.6);
            box-shadow: var(--shadow-xl), 0 0 0 4px rgba(102, 126, 234, 0.2), 0 0 30px rgba(102, 126, 234, 0.3);
        }
        
        .search-input {
            flex: 1;
            border: none;
            background: transparent;
            color: #2d3748;
            padding: var(--space-md) var(--space-lg);
            font-size: 1rem;
            font-weight: 500;
            outline: none;
            font-family: inherit;
            transition: all var(--timing-normal) var(--easing-ease);
            position: relative;
            z-index: 1;
        }
        
        .search-input::placeholder {
            color: #718096;
            font-weight: 400;
            transition: color var(--timing-normal) var(--easing-ease);
        }
        
        .search-input:focus::placeholder {
            color: #4a5568;
        }
        
        .search-btn {
            background: linear-gradient(135deg, var(--solid-primary) 0%, var(--solid-secondary) 100%);
            border: none;
            border-radius: var(--radius-full);
            width: 48px;
            height: 48px;
            color: #ffffff;
            cursor: pointer;
            transition: all var(--timing-normal) var(--easing-ease);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            box-shadow: var(--shadow-lg);
            position: relative;
            z-index: 1;
            overflow: hidden;
        }
        
        .search-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.1) 100%);
            border-radius: inherit;
            opacity: 0;
            transition: opacity var(--timing-normal) var(--easing-ease);
        }
        
        .search-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: var(--shadow-xl), 0 0 20px rgba(102, 126, 234, 0.4);
        }
        
        .search-btn:hover::before {
            opacity: 1;
        }
        
        .search-btn:active {
            transform: translateY(0) scale(0.95);
            transition: all var(--timing-fast) var(--easing-ease);
        }
        
        /* Video Cards Glass Styling */
        .video-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: var(--shadow-lg);
            border-radius: var(--radius-2xl);
            overflow: hidden;
            transition: all var(--timing-normal) var(--easing-ease);
            cursor: pointer;
            position: relative;
            transform: translateY(0);
        }
        
        .video-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            border-radius: inherit;
            opacity: 0;
            transition: opacity var(--timing-normal) var(--easing-ease);
            pointer-events: none;
        }
        
        .video-card:hover {
            transform: translateY(-12px) scale(1.03);
            box-shadow: var(--shadow-2xl), 0 0 30px rgba(102, 126, 234, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
        }
        
        .video-card:hover::before {
            opacity: 1;
        }
        
        .video-card:active {
            transform: translateY(-8px) scale(1.01);
            transition: all var(--timing-fast) var(--easing-ease);
        }
        
        /* Video Action Buttons */
        .video-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 8px;
            opacity: 1;
            transition: all var(--timing-normal) var(--easing-ease);
            z-index: 10;
        }
        
        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all var(--timing-normal) var(--easing-ease);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .add-to-playlist-btn {
            background: rgba(76, 175, 80, 0.9);
            color: white;
        }
        
        .add-to-playlist-btn:hover {
            background: rgba(76, 175, 80, 1);
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(76, 175, 80, 0.4);
        }
        
        .like-btn {
            background: rgba(244, 67, 54, 0.9);
            color: white;
        }
        
        .like-btn:hover {
            background: rgba(244, 67, 54, 1);
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(244, 67, 54, 0.4);
        }
        
        .like-btn.liked {
            background: rgba(244, 67, 54, 1);
            animation: heartBeat 0.6s ease-in-out;
        }
        
        @keyframes heartBeat {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        
        /* Playlist Menu Styles */
        .playlist-menu {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        
        .playlist-menu-content {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-2xl);
            padding: var(--space-xl);
            max-width: 400px;
            width: 90%;
            box-shadow: var(--shadow-2xl);
        }
        
        .playlist-menu-content h4 {
            color: #2d3748;
            margin: 0 0 var(--space-md) 0;
            font-size: 1.2rem;
        }
        
        .playlist-menu-content p {
            color: #4a5568;
            margin: 0 0 var(--space-lg) 0;
            font-size: 0.9rem;
        }
        
        .playlist-options {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
            margin-bottom: var(--space-lg);
        }
        
        .playlist-option {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-md);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--timing-normal) var(--easing-ease);
        }
        
        .playlist-option:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .playlist-option i {
            color: #667eea;
            font-size: 1rem;
        }
        
        .playlist-option span {
            color: #2d3748;
            font-weight: 500;
        }
        
        .playlist-option.create-new-playlist {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            border-color: rgba(76, 175, 80, 0.3);
            color: white;
        }
        
        .playlist-option.create-new-playlist:hover {
            background: linear-gradient(135deg, #45a049, #3d8b40);
            border-color: rgba(76, 175, 80, 0.5);
            transform: translateY(-2px);
        }
        
        .playlist-option.create-new-playlist i {
            color: white;
        }
        
        .playlist-option.create-new-playlist span {
            color: white;
            font-weight: 600;
        }
        
        .playlist-menu-close {
            width: 100%;
            padding: var(--space-md);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-lg);
            color: #2d3748;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--timing-normal) var(--easing-ease);
        }
        
        .playlist-menu-close:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        /* Playlist List Styles */
        .playlist-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-md);
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-sm);
            cursor: pointer;
            transition: all var(--timing-normal) var(--easing-ease);
        }
        
        .playlist-item:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.25);
            transform: translateY(-1px);
        }
        
        .playlist-info h6 {
            margin: 0 0 4px 0;
            color: #2d3748;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .playlist-info p {
            margin: 0;
            color: #4a5568;
            font-size: 0.8rem;
        }
        
        .playlist-actions {
            display: flex;
            gap: 4px;
        }
        
        .playlist-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all var(--timing-normal) var(--easing-ease);
        }
        
        .edit-btn {
            background: rgba(33, 150, 243, 0.8);
            color: white;
        }
        
        .edit-btn:hover {
            background: rgba(33, 150, 243, 1);
            transform: scale(1.1);
        }
        
        .delete-btn {
            background: rgba(244, 67, 54, 0.8);
            color: white;
        }
        
        .delete-btn:hover {
            background: rgba(244, 67, 54, 1);
            transform: scale(1.1);
        }
        
        .no-playlists {
            text-align: center;
            color: #4a5568;
            font-style: italic;
            padding: var(--space-lg);
        }
        
        .playlist-header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
            text-align: center;
        }
        
        .playlist-header h3 {
            margin: 0 0 var(--space-sm) 0;
            color: #2d3748;
            font-size: 1.3rem;
        }
        
        .playlist-header p {
            margin: 0;
            color: #4a5568;
            font-size: 0.9rem;
        }
        
        /* Playlist Options Modal */
        .playlist-options-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        
        .playlist-options-content {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-2xl);
            padding: var(--space-xl);
            max-width: 500px;
            width: 90%;
            box-shadow: var(--shadow-2xl);
            position: relative;
        }
        
        .playlist-options-header {
            text-align: center;
            margin-bottom: var(--space-xl);
        }
        
        .playlist-options-header h3 {
            color: #2d3748;
            margin: 0 0 var(--space-sm) 0;
            font-size: 1.4rem;
        }
        
        .playlist-options-header p {
            color: #4a5568;
            margin: 0 0 var(--space-lg) 0;
            font-size: 0.9rem;
        }
        
        .modal-close {
            position: absolute;
            top: var(--space-lg);
            right: var(--space-lg);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #2d3748;
            transition: all var(--timing-normal) var(--easing-ease);
        }
        
        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }
        
        .playlist-options-actions {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
        }
        
        .playlist-action-btn {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-lg);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-lg);
            color: #2d3748;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--timing-normal) var(--easing-ease);
            text-align: left;
        }
        
        .playlist-action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .play-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }
        
        .play-btn:hover {
            background: linear-gradient(135deg, #45a049, #3d8b40);
        }
        
        .shuffle-btn {
            background: linear-gradient(135deg, #FF9800, #F57C00);
            color: white;
        }
        
        .shuffle-btn:hover {
            background: linear-gradient(135deg, #F57C00, #EF6C00);
        }
        
        .view-btn {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
        }
        
        .view-btn:hover {
            background: linear-gradient(135deg, #1976D2, #1565C0);
        }
        
        .playlist-preview h4 {
            color: #2d3748;
            margin: 0 0 var(--space-md) 0;
            font-size: 1rem;
        }
        
        .playlist-preview-list {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .playlist-preview-item {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm);
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-xs);
        }
        
        .playlist-number {
            background: #667eea;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        .playlist-preview-thumb {
            width: 40px;
            height: 30px;
            object-fit: cover;
            border-radius: 4px;
        }
        
        .playlist-preview-title {
            color: #2d3748;
            font-size: 0.8rem;
            font-weight: 500;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex: 1;
        }
        
        .playlist-preview-more {
            text-align: center;
            color: #4a5568;
            font-style: italic;
            padding: var(--space-sm);
        }
        
        /* Playlist Player Controls */
        .playlist-player-controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-2xl);
            padding: var(--space-lg);
            box-shadow: var(--shadow-2xl);
            z-index: 1000;
            min-width: 400px;
            max-width: 90vw;
        }
        
        .playlist-player-content {
            display: flex;
            align-items: center;
            gap: var(--space-lg);
        }
        
        .playlist-player-info {
            flex: 1;
            min-width: 0;
        }
        
        .playlist-player-title {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            color: #2d3748;
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 4px;
        }
        
        .shuffle-indicator {
            color: #FF9800;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .playlist-player-current {
            color: #4a5568;
            font-size: 0.85rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .playlist-player-actions {
            display: flex;
            gap: var(--space-sm);
        }
        
        .playlist-nav-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: #2d3748;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--timing-normal) var(--easing-ease);
        }
        
        .playlist-nav-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }
        
        .playlist-nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .playlist-nav-btn i.active {
            color: #FF9800;
        }
        
        .playlist-header-actions {
            display: flex;
            gap: var(--space-sm);
            margin-top: var(--space-sm);
        }
        
        .playlist-header-btn {
            padding: var(--space-sm) var(--space-md);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-lg);
            color: #2d3748;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all var(--timing-normal) var(--easing-ease);
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .playlist-header-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }
        
        /* Premium Loading States */
        .loading-skeleton {
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.1) 25%, rgba(255, 255, 255, 0.2) 50%, rgba(255, 255, 255, 0.1) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: var(--radius-lg);
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-top: 3px solid var(--solid-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn var(--timing-slow) var(--easing-ease);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-up {
            animation: slideUp var(--timing-slow) var(--easing-ease);
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Mobile Optimization */
        @media (max-width: 768px) {
            body {
                padding-top: 100px;
            }
            
            .header {
                height: 100px !important;
                padding: var(--space-lg);
            }
            
            .header-content {
                flex-direction: column;
                gap: var(--space-md);
            }
            
            .header-left, .header-right {
                width: 100%;
                justify-content: center;
            }
            
            .search-container {
                margin: 0;
                padding: var(--space-xs);
                max-width: 100%;
            }
            
            .search-input {
                padding: var(--space-sm) var(--space-md);
                font-size: 0.9rem;
            }
            
            .search-btn {
                width: 44px;
                height: 44px;
                font-size: 1rem;
            }
            
            
            .video-player {
                aspect-ratio: 16/9;
                min-height: 250px;
            }
            
            .video-card {
                border-radius: var(--radius-xl);
            }
            
            .video-card:hover {
                transform: translateY(-8px) scale(1.02);
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding-top: 120px;
            }
            
            .header {
                height: 120px !important;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .search-container {
                margin: 0 var(--space-sm);
            }
            
            
            .video-card {
                border-radius: var(--radius-lg);
            }
        }
        
        /* Premium Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all var(--timing-normal) var(--easing-ease);
        }
        
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-2xl);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            transform: scale(0.9) translateY(20px);
            transition: all var(--timing-normal) var(--easing-ease);
        }
        
        .modal-overlay.show .modal-content {
            transform: scale(1) translateY(0);
        }
        
        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-xl);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .modal-header h3 {
            color: var(--text-primary);
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.2rem;
            cursor: pointer;
            padding: var(--space-sm);
            border-radius: var(--radius-md);
            transition: all var(--timing-normal) var(--easing-ease);
        }
        
        .modal-close:hover {
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.1);
        }
        
        .modal-body {
            padding: var(--space-xl);
        }
        
        .parental-section {
            margin-bottom: var(--space-xl);
        }
        
        .parental-section h4 {
            color: var(--text-primary);
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: var(--space-lg);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }
        
        .setting-group {
            margin-bottom: var(--space-lg);
        }
        
        .setting-description {
            font-size: 0.8rem;
            color: #4a5568;
            margin-top: var(--space-xs);
            font-style: italic;
            line-height: 1.4;
        }
        
        /* Modern Radio Button Styles */
        .radio-group {
            margin-bottom: var(--space-lg);
        }
        
        .radio-label {
            display: block;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: var(--space-md);
            font-size: 1rem;
        }
        
        .radio-options {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            padding: var(--space-md);
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--timing-normal) var(--easing-ease);
            position: relative;
            overflow: hidden;
        }
        
        .radio-option:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }
        
        .radio-option input[type="radio"] {
            display: none;
        }
        
        .radio-custom {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            margin-right: var(--space-md);
            position: relative;
            transition: all var(--timing-normal) var(--easing-ease);
            flex-shrink: 0;
        }
        
        .radio-option input[type="radio"]:checked + .radio-custom {
            border-color: #667eea;
            background: #667eea;
        }
        
        .radio-option input[type="radio"]:checked + .radio-custom::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
        }
        
        .radio-option input[type="radio"]:checked ~ .radio-content {
            color: #2d3748;
        }
        
        .radio-content {
            display: flex;
            flex-direction: column;
            flex: 1;
        }
        
        .radio-title {
            font-weight: 600;
            color: #2d3748;
            font-size: 0.95rem;
            margin-bottom: 2px;
        }
        
        .radio-subtitle {
            font-size: 0.8rem;
            color: #4a5568;
            line-height: 1.3;
        }
        
        .radio-option input[type="radio"]:checked + .radio-custom + .radio-content .radio-title {
            color: #667eea;
        }
        
        .radio-option input[type="radio"]:checked + .radio-custom + .radio-content .radio-subtitle {
            color: #4a5568;
        }
        
        /* Radio option selected state */
        .radio-option:has(input[type="radio"]:checked) {
            background: rgba(102, 126, 234, 0.1);
            border-color: rgba(102, 126, 234, 0.3);
            box-shadow: 0 0 0 1px rgba(102, 126, 234, 0.1);
        }
        
        /* Fallback for browsers that don't support :has() */
        .radio-option.selected {
            background: rgba(102, 126, 234, 0.1);
            border-color: rgba(102, 126, 234, 0.3);
            box-shadow: 0 0 0 1px rgba(102, 126, 234, 0.1);
        }
        
        .setting-item {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            margin-bottom: var(--space-md);
            cursor: pointer;
            color: var(--text-secondary);
        }
        
        .setting-item input[type="checkbox"] {
            display: none;
        }
        
        .checkmark {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-sm);
            position: relative;
            transition: all var(--timing-normal) var(--easing-ease);
        }
        
        .setting-item input[type="checkbox"]:checked + .checkmark {
            background: var(--solid-primary);
            border-color: var(--solid-primary);
        }
        
        .setting-item input[type="checkbox"]:checked + .checkmark::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        
        .setting-input {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-left: 28px;
        }
        
        .setting-input input[type="number"] {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            padding: var(--space-sm) var(--space-md);
            width: 80px;
            text-align: center;
        }
        
        .setting-input input[type="number"]:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .setting-input span {
            color: var(--text-muted);
            font-size: 0.9rem;
        }
        
        .setting-item select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            padding: var(--space-sm) var(--space-md);
            margin-left: var(--space-md);
            min-width: 200px;
        }
        
        .modal-footer {
            display: flex;
            gap: var(--space-md);
            padding: var(--space-xl);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            justify-content: flex-end;
        }
        
        .btn-primary, .btn-secondary {
            padding: var(--space-md) var(--space-xl);
            border-radius: var(--radius-lg);
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--timing-normal) var(--easing-ease);
            font-size: 0.9rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--solid-primary) 0%, var(--solid-secondary) 100%);
            color: var(--text-primary);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            color: var(--text-primary);
        }
        
        /* Professional Message Toast System */
        .message-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            padding: var(--space-lg);
            max-width: 400px;
            z-index: 2000;
            transform: translateX(100%);
            opacity: 0;
            transition: all var(--timing-normal) var(--easing-ease);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-md);
        }
        
        .message-toast.show {
            transform: translateX(0);
            opacity: 1;
        }
        
        .message-content {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            flex: 1;
        }
        
        .message-content i {
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        
        .message-content span {
            color: var(--text-primary);
            font-weight: 500;
            line-height: 1.4;
        }
        
        .message-close {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: var(--space-xs);
            border-radius: var(--radius-sm);
            transition: all var(--timing-normal) var(--easing-ease);
            flex-shrink: 0;
        }
        
        .message-close:hover {
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* Message Type Styles */
        .message-success {
            border-left: 4px solid #10b981;
        }
        
        .message-success .message-content i {
            color: #10b981;
        }
        
        .message-error {
            border-left: 4px solid #ef4444;
        }
        
        .message-error .message-content i {
            color: #ef4444;
        }
        
        .message-warning {
            border-left: 4px solid #f59e0b;
        }
        
        .message-warning .message-content i {
            color: #f59e0b;
        }
        
        .message-info {
            border-left: 4px solid #3b82f6;
        }
        
        .message-info .message-content i {
            color: #3b82f6;
        }
        
        .message-loading {
            border-left: 4px solid var(--solid-primary);
        }
        
        .message-loading .message-content i {
            color: var(--solid-primary);
        }
        
        /* Mobile Message Toast */
        @media (max-width: 768px) {
            .message-toast {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
                transform: translateY(-100%);
            }
            
            .message-toast.show {
                transform: translateY(0);
            }
        }
        
        .video-thumbnail {
            position: relative;
            overflow: hidden;
            border-radius: 15px 15px 0 0;
        }
        
        .video-thumbnail img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .video-card:hover .video-thumbnail img {
            transform: scale(1.05);
        }
        
        .video-info {
            padding: 20px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 15px;
            margin: 10px;
        }
        
        .video-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 12px;
            color: #1a202c;
            line-height: 1.3;
        }
        
        .video-category {
            background: var(--solid-primary);
            color: #ffffff;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-block;
            margin-bottom: 8px;
            box-shadow: var(--shadow-soft);
        }
        
        .video-channel {
            color: #4a5568;
            font-size: 0.85rem;
        }
        
        #videoDescription {
            color: #2d3748;
            font-size: 1rem;
            font-weight: 500;
            line-height: 1.5;
        }
        
        /* Video Player Glass Styling */
        .video-player {
            background: transparent;
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            border-radius: 25px;
            overflow: hidden;
            margin: 20px 0;
            position: relative;
            aspect-ratio: 32/9;
            min-height: 400px;
        }
        
        .video-player iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 25px;
        }
        
        #youtubePlayer {
            width: 100%;
            height: 100%;
            border-radius: 25px;
        }
        
        /* Sidebar Glass Styling */
        .sidebar {
            background: var(--glass-strong);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 20px 60px rgba(31, 38, 135, 0.5);
        }
        
        .sidebar-header {
            background: var(--gradient-primary);
            border-radius: 0;
        }
        
        /* Button Glass Styling */
        .menu-toggle {
            background: #a8b5d1;
            border: 1px solid rgba(168, 181, 209, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        
        .menu-toggle:hover {
            transform: scale(1.1);
            background: #b8c5d1;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.08);
        }
        
        /* Loading Spinner Glass Styling */
        .loading-spinner {
            background: var(--glass-strong);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            border-radius: 20px;
        }
        
        /* Success Message Glass Styling */
        .success-message {
            background: var(--glass-strong);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(76, 175, 80, 0.3);
            box-shadow: 0 8px 32px rgba(76, 175, 80, 0.3);
            border-radius: 15px;
            color: white;
        }
        
        /* Video Overlay Glass Styling */
        
        .overlay-controls {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.4));
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0 0 20px 20px;
        }
        
        .overlay-info {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.8));
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px 20px 0 0;
        }
        
        .overlay-play-btn {
            background: #a8b5d1;
            border: 1px solid rgba(168, 181, 209, 0.3);
            box-shadow: 0 8px 32px rgba(168, 181, 209, 0.3);
            transition: all 0.3s ease;
        }
        
        .overlay-play-btn:hover {
            transform: scale(1.15);
            background: #b8c5d1;
            box-shadow: 0 12px 40px rgba(168, 181, 209, 0.4);
        }
        
        .overlay-volume-btn,
        .overlay-fullscreen-btn,
        .overlay-toggle-btn {
            background: var(--glass-bg);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 4px 16px rgba(31, 38, 135, 0.3);
            transition: all 0.3s ease;
        }
        
        .overlay-volume-btn:hover,
        .overlay-fullscreen-btn:hover,
        .overlay-toggle-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 24px rgba(31, 38, 135, 0.4);
        }
        
        /* Progress Bar Glass Styling */
        .overlay-progress-bar {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        .overlay-progress-fill {
            background: #a8b5d1;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(168, 181, 209, 0.3);
        }
        
        .overlay-volume-slider {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        .overlay-volume-fill {
            background: #b8c5d1;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(184, 197, 209, 0.3);
        }
        
        /* Safe Search Indicator Glass Styling */
        .safe-search-indicator {
            background: var(--glass-strong);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(76, 175, 80, 0.3);
            box-shadow: 0 8px 32px rgba(76, 175, 80, 0.3);
            border-radius: 15px;
            color: white;
            margin-bottom: 20px;
        }
        
        /* Main Layout Container */
        .main-content {
            display: flex;
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        
        .video-section {
            flex: 1;
            min-width: 0;
        }
        
        .video-container {
            position: relative;
            width: 100%;
        }
        
        .video-player {
            position: relative;
            width: 100%;
            aspect-ratio: 32/9;
            border-radius: 25px;
            overflow: hidden;
            min-height: 400px;
        }
        
        .popular-videos-section {
            flex: 1;
            min-width: 0;
        }
        
        .popular-videos-section h3 {
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        
        .videos-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px 0;
        }

        /* Video cards for main content area */
        .video-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-2xl);
            overflow: hidden;
            transition: all var(--timing-normal) var(--easing-ease);
            cursor: pointer;
            position: relative;
            box-shadow: var(--shadow-lg);
        }

        .video-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: var(--shadow-2xl), 0 0 30px rgba(102, 126, 234, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .video-thumbnail {
            position: relative;
            overflow: hidden;
            aspect-ratio: 16/9;
        }

        .video-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--timing-normal) var(--easing-ease);
        }

        .video-card:hover .video-thumbnail img {
            transform: scale(1.05);
        }

        .play-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 3rem;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            transition: all var(--timing-normal) var(--easing-ease);
        }

        .video-card:hover .play-icon {
            transform: translate(-50%, -50%) scale(1.1);
        }

        .video-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 8px;
            opacity: 1;
            z-index: 10;
        }

        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--timing-normal) var(--easing-ease);
            font-size: 0.9rem;
            box-shadow: var(--shadow-md);
        }

        .add-to-playlist-btn {
            background: rgba(76, 175, 80, 0.9);
            color: white;
        }

        .add-to-playlist-btn:hover {
            background: rgba(76, 175, 80, 1);
            transform: scale(1.1);
        }

        .like-btn {
            background: rgba(244, 67, 54, 0.9);
            color: white;
        }

        .like-btn:hover {
            background: rgba(244, 67, 54, 1);
            transform: scale(1.1);
        }

        .like-btn.liked {
            background: rgba(244, 67, 54, 1);
            animation: heartBeat 0.6s ease-in-out;
        }

        .video-info {
            padding: var(--space-lg);
            background: rgba(255, 255, 255, 0.05);
        }

        .video-title {
            color: var(--text-primary);
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: var(--space-sm);
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .video-category {
            background: var(--solid-primary);
            color: var(--text-light);
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-block;
            margin-bottom: 8px;
            box-shadow: var(--shadow-soft);
        }

        .video-channel {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin: 0;
        }
        
        /* Extra small video cards for recommendations */
        .recommendations-section .video-card {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-backdrop);
            -webkit-backdrop-filter: var(--glass-backdrop);
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }
        
        .recommendations-section .video-card:hover {
            transform: translateY(-2px) scale(1.005);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.06);
            border-color: rgba(168, 181, 209, 0.3);
        }
        
        .recommendations-section .video-thumbnail {
            position: relative;
            overflow: hidden;
            border-radius: 10px 10px 0 0;
        }
        
        .recommendations-section .video-thumbnail img {
            width: 100%;
            height: 80px;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .recommendations-section .video-card:hover .video-thumbnail img {
            transform: scale(1.02);
        }
        
        .recommendations-section .video-actions {
            position: absolute;
            top: 5px;
            right: 5px;
            display: flex;
            gap: 4px;
            opacity: 1;
            z-index: 10;
        }
        
        .recommendations-section .action-btn {
            width: 24px;
            height: 24px;
            font-size: 10px;
        }
        
        .recommendations-section .video-info {
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
        }
        
        .recommendations-section .video-title {
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 4px;
            color: #4a5568;
            line-height: 1.1;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .recommendations-section .video-category {
            background: #a8b5d1;
            color: white;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 0.65rem;
            font-weight: 500;
            display: inline-block;
            margin-bottom: 4px;
        }
        
        .recommendations-section .video-channel {
            color: rgba(74, 85, 104, 0.5);
            font-size: 0.7rem;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .header {
                margin: 10px;
                padding: 20px;
            }
            
            .header-content {
                flex-direction: column;
                gap: var(--space-md);
            }
            
            .header-left, .header-right {
                width: 100%;
                justify-content: center;
            }
            
            .search-container {
                margin: 0;
                max-width: 100%;
            }
            
            .video-card {
                margin-bottom: 20px;
            }
            
            /* Mobile: Stack video and recommendations vertically */
            .main-content {
                flex-direction: column;
                padding: 10px;
            }
            
            .video-section {
                order: 1;
            }
            
        }
        
        @media (min-width: 769px) and (max-width: 1024px) {
            /* Tablet: Side-by-side layout with fixed video */
            .main-content {
                flex-direction: row;
                padding: 15px;
            }
            
            .video-section {
                flex: 0 0 60%;
                position: sticky;
                top: 20px;
                height: fit-content;
            }
            
        }
        
        @media (min-width: 1025px) {
            /* Desktop: Side-by-side layout with fixed video */
            .main-content {
                flex-direction: row;
                padding: 20px;
            }
            
            .video-section {
                flex: 0 0 70%;
                position: sticky;
                top: 20px;
                height: fit-content;
            }
            
        }
        
        .video-channel {
            display: block;
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }
        
        /* Video player tonedown effects */
        .video-player {
            transition: filter 0.5s ease;
        }
        
        .video-player iframe {
            transition: filter 0.5s ease;
        }
        
        /* Fullscreen support for tonedown */
        .video-player:-webkit-full-screen {
            transition: filter 0.5s ease;
        }
        
        .video-player:-moz-full-screen {
            transition: filter 0.5s ease;
        }
        
        .video-player:fullscreen {
            transition: filter 0.5s ease;
        }
        
        /* Ensure tonedown works in fullscreen */
        .video-player:-webkit-full-screen iframe {
            transition: filter 0.5s ease;
        }
        
        .video-player:-moz-full-screen iframe {
            transition: filter 0.5s ease;
        }
        
        .video-player:fullscreen iframe {
            transition: filter 0.5s ease;
        }
        
        /* Header Actions */
        .header-actions {
            display: flex;
            align-items: center;
            margin-left: 15px;
        }
        
        /* Kid-Friendly Menu Button */
        .kids-menu-toggle {
            background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 50%, #45b7d1 100%);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: #ffffff;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            font-size: 0.9rem;
            padding: 8px 16px;
            border-radius: 25px;
            cursor: pointer;
            transition: all var(--timing-normal) var(--easing-ease);
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .kids-menu-toggle::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .kids-menu-toggle:hover::before {
            left: 100%;
        }
        
        .kids-menu-toggle:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .kids-menu-toggle:active {
            transform: translateY(-1px) scale(1.02);
        }
        
        .menu-icon {
            display: flex;
            flex-direction: column;
            gap: 3px;
            align-items: center;
        }
        
        .menu-dot {
            width: 4px;
            height: 4px;
            background: #ffffff;
            border-radius: 50%;
            transition: all var(--timing-normal) var(--easing-ease);
        }
        
        .kids-menu-toggle:hover .menu-dot {
            transform: scale(1.2);
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
        }
        
        .menu-text {
            font-size: 0.85rem;
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        /* Parent Controls Button */
        .parent-controls-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            border-radius: 20px;
            color: white;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
        }
        
        .parent-controls-btn:hover {
            background: linear-gradient(135deg, #5a6fd8, #6a4190);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .parent-controls-btn i {
            font-size: 1rem;
        }
        
        /* Parent Welcome Message */
        .parent-welcome {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .welcome-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .welcome-content h2 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.8rem;
        }
        
        .welcome-content p {
            color: #4a5568;
            margin-bottom: 25px;
            font-size: 1.1rem;
        }
        
        .welcome-tips {
            text-align: left;
            margin-bottom: 25px;
        }
        
        .tip {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 10px;
        }
        
        .tip i {
            color: #667eea;
            font-size: 1.2rem;
            width: 20px;
        }
        
        .tip span {
            color: #2d3748;
            font-size: 0.95rem;
        }
        
        .welcome-close {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .welcome-close:hover {
            background: linear-gradient(135deg, #5a6fd8, #6a4190);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        /* Break Game Container */
        .break-game-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10001;
            backdrop-filter: blur(15px);
        }

        .break-game-overlay {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-2xl);
            padding: var(--space-2xl);
            max-width: 90vw;
            max-height: 90vh;
            width: 800px;
            height: 600px;
            box-shadow: var(--shadow-2xl), 0 0 50px rgba(102, 126, 234, 0.3);
            display: flex;
            flex-direction: column;
            animation: slideInUp 0.5s ease-out;
        }

        .break-game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
            padding-bottom: var(--space-md);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .break-game-header h2 {
            color: var(--text-primary);
            font-size: 2rem;
            font-weight: 700;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .close-break-game {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-muted);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--timing-normal) var(--easing-ease);
        }

        .close-break-game:hover {
            background: rgba(255, 255, 255, 0.2);
            color: var(--text-primary);
            transform: scale(1.1);
        }

        .break-game-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            overflow: hidden;
        }

        /* Game-specific styles */
        .game-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            margin-bottom: var(--space-lg);
        }

        .game-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--space-md);
            width: 100%;
            margin-top: var(--space-lg);
        }

        .game-option {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            cursor: pointer;
            transition: all var(--timing-normal) var(--easing-ease);
            text-align: center;
            color: var(--text-primary);
            font-weight: 600;
        }

        .game-option:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(102, 126, 234, 0.5);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .game-option.correct {
            background: rgba(76, 175, 80, 0.3);
            border-color: rgba(76, 175, 80, 0.6);
            animation: correctAnswer 0.6s ease-in-out;
        }

        .game-option.incorrect {
            background: rgba(244, 67, 54, 0.3);
            border-color: rgba(244, 67, 54, 0.6);
            animation: incorrectAnswer 0.6s ease-in-out;
        }

        .game-score {
            position: absolute;
            top: var(--space-lg);
            right: var(--space-lg);
            background: rgba(255, 255, 255, 0.1);
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-full);
            color: var(--text-primary);
            font-weight: 600;
        }

        .game-progress {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-full);
            margin-bottom: var(--space-lg);
            overflow: hidden;
        }

        .game-progress-fill {
            height: 100%;
            background: linear-gradient(135deg, var(--solid-primary), var(--solid-secondary));
            border-radius: var(--radius-full);
            transition: width 0.3s ease;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes correctAnswer {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes incorrectAnswer {
            0%, 100% { transform: scale(1); }
            25%, 75% { transform: scale(0.95); }
            50% { transform: scale(1.05); }
        }
        
        /* Sidebar Styles */
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9998;
            display: none;
        }
        
        .sidebar {
            position: fixed;
            top: 0;
            right: -450px;
            width: 450px;
            height: 100%;
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border-left: 1px solid rgba(255, 255, 255, 0.25);
            box-shadow: var(--shadow-2xl), 0 0 50px rgba(0, 0, 0, 0.1);
            z-index: 9999;
            transition: all var(--timing-normal) var(--easing-ease);
            overflow-y: auto;
            transform: translateX(0);
        }
        
        .sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.03) 100%);
            pointer-events: none;
        }
        
        .sidebar.open {
            right: 0;
            transform: translateX(0);
        }
        
        .sidebar-overlay.show {
            display: block;
        }

        /* Liked Videos Styling */
        .no-liked-videos {
            text-align: center;
            color: var(--text-muted);
            padding: var(--space-lg);
            font-style: italic;
        }

        .liked-video-item {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-sm);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--timing-normal) var(--easing-ease);
            margin-bottom: var(--space-sm);
        }

        .liked-video-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .liked-video-item img {
            width: 60px;
            height: 45px;
            object-fit: cover;
            border-radius: var(--radius-md);
        }

        .liked-video-info h5 {
            color: var(--text-primary);
            font-size: 0.9rem;
            margin: 0 0 5px 0;
            line-height: 1.3;
        }

        .liked-video-info p {
            color: var(--text-muted);
            font-size: 0.8rem;
            margin: 0;
            line-height: 1.2;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .sidebar-header {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-primary);
            padding: var(--space-xl);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 1;
        }
        
        .sidebar-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            pointer-events: none;
        }
        
        .sidebar-header h3 {
            margin: 0;
            font-family: 'Fredoka One', cursive;
            font-size: 1.4rem;
            font-weight: 600;
            color: #2d3748;
            position: relative;
            z-index: 1;
        }
        
        .close-sidebar {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #2d3748;
            font-size: 1.1rem;
            cursor: pointer;
            padding: var(--space-sm);
            border-radius: var(--radius-full);
            transition: all var(--timing-normal) var(--easing-ease);
            position: relative;
            z-index: 1;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-sidebar:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        .close-sidebar:active {
            transform: scale(0.95);
        }
        
        .sidebar-content {
            padding: var(--space-xl);
            position: relative;
            z-index: 1;
        }
        
        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-lg);
            cursor: pointer;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-md);
            transition: all var(--timing-normal) var(--easing-ease);
            position: relative;
            overflow: hidden;
        }
        
        .filter-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            opacity: 0;
            transition: opacity var(--timing-normal) var(--easing-ease);
        }
        
        .filter-header:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.25);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        .filter-header:hover::before {
            opacity: 1;
        }
        
        .filter-header h4 {
            color: #2d3748;
            margin: 0;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            font-size: 1.1rem;
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }
        
        .dropdown-arrow {
            color: #718096;
            font-size: 1rem;
            transition: all var(--timing-normal) var(--easing-ease);
            position: relative;
            z-index: 1;
        }
        
        .filter-dropdown {
            max-height: 0;
            overflow: hidden;
            transition: all var(--timing-normal) var(--easing-ease);
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-md);
            margin-top: var(--space-sm);
        }
        
        .filter-dropdown.open {
            max-height: 600px;
            padding: var(--space-md);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .dropdown-arrow.rotated {
            transform: rotate(180deg);
        }
        
        /* Control Sections */
        .control-section {
            margin-top: var(--space-lg);
        }
        
        .control-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-lg);
            cursor: pointer;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-md);
            transition: all var(--timing-normal) var(--easing-ease);
            position: relative;
            overflow: hidden;
        }
        
        .control-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            opacity: 0;
            transition: opacity var(--timing-normal) var(--easing-ease);
        }
        
        .control-header:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.25);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        .control-header:hover::before {
            opacity: 1;
        }
        
        .control-header h4 {
            color: #2d3748;
            margin: 0;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            font-size: 1.1rem;
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }
        
        .control-dropdown {
            max-height: 0;
            overflow: hidden;
            transition: all var(--timing-normal) var(--easing-ease);
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-md);
            margin-top: var(--space-sm);
        }
        
        .control-dropdown.open {
            max-height: 400px;
            padding: var(--space-md);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .control-options {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }
        
        .control-option {
            display: flex;
            align-items: center;
            padding: var(--space-md);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--timing-normal) var(--easing-ease);
            background: rgba(255, 255, 255, 0.08);
            position: relative;
            overflow: hidden;
        }
        
        .control-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            opacity: 0;
            transition: opacity var(--timing-normal) var(--easing-ease);
        }
        
        .control-option:hover {
            border-color: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            background: rgba(255, 255, 255, 0.12);
        }
        
        .control-option:hover::before {
            opacity: 1;
        }
        
        .control-icon {
            width: 44px;
            height: 44px;
            border-radius: var(--radius-full);
            background: linear-gradient(135deg, var(--solid-primary) 0%, var(--solid-secondary) 100%);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: var(--space-md);
            flex-shrink: 0;
            font-size: 1.1rem;
            position: relative;
            z-index: 1;
            box-shadow: var(--shadow-sm);
            transition: all var(--timing-normal) var(--easing-ease);
        }
        
        .control-option:hover .control-icon {
            transform: scale(1.05);
            box-shadow: var(--shadow-md);
        }
        
        .control-info {
            position: relative;
            z-index: 1;
        }
        
        .control-info h5 {
            margin: 0 0 var(--space-xs) 0;
            font-size: 1rem;
            color: #2d3748;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
        }
        
        .control-info p {
            margin: 0;
            font-size: 0.85rem;
            color: #4a5568;
        }
        
        .filter-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .filter-option {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        
        .filter-option:hover {
            border-color: #4ECDC4;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .filter-option.active {
            border-color: #FF6B6B;
            background: #fff5f5;
        }
        
        .filter-preview {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            margin-right: 15px;
            flex-shrink: 0;
            border: 2px solid #e0e0e0;
        }
        
        .filter-info h5 {
            margin: 0;
            font-size: 1rem;
            color: #333;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
        }
        
        .sidebar-footer {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }
        
        .parental-access-btn {
            width: 100%;
            background: #4ECDC4;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 1rem;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .parental-access-btn:hover {
            background: #3bb5b0;
            transform: translateY(-2px);
        }
        
        /* Safe Search Indicator */
        .safe-search-indicator {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #4ECDC4, #44A08D);
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(78, 205, 196, 0.3);
        }
        
        .safe-search-indicator i {
            font-size: 18px;
        }
        
        .safe-search-indicator span {
            font-size: 14px;
        }
        
        /* Video Overlay Styles */
        .video-player {
            position: relative;
            overflow: hidden;
            transition: filter 0.5s ease;
        }
        
        .video-player.filter-transitioning {
            transition: filter 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .video-player iframe {
            transition: filter 0.5s ease;
        }
        
        .video-player.filter-transitioning iframe {
            transition: filter 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        .overlay-controls {
            pointer-events: all;
            padding: 20px;
            width: 100%;
        }
        
        .overlay-info {
            pointer-events: all;
            margin-bottom: auto;
            padding: 20px;
        }
        
        .video-player:hover .video-overlay {
            opacity: 1;
            background: rgba(0, 0, 0, 0.3);
        }
        
        .overlay-controls {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            background: linear-gradient(to bottom, rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.3));
            gap: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .overlay-play-btn {
            background: #FF6B6B;
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.4);
            position: relative;
            z-index: 15;
        }
        
        .overlay-play-btn::after {
            content: '';
            position: absolute;
            top: -20px;
            left: -20px;
            right: -20px;
            bottom: -20px;
            background: transparent;
            z-index: 10;
        }
        
        .overlay-play-btn:hover {
            background: #e55a5a;
            transform: scale(1.1);
        }
        
        .overlay-progress {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            cursor: pointer;
            position: relative;
        }
        
        .overlay-progress-bar {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        .overlay-progress-fill {
            height: 100%;
            background: #FF6B6B;
            border-radius: 3px;
            width: 0%;
            transition: width 0.1s ease;
        }
        
        /* Blank overlay for end of video */
        .blank-overlay {
            background: rgba(0, 0, 0, 0.8) !important;
            display: flex !important;
            align-items: center;
            justify-content: center;
            opacity: 1 !important;
        }
        
        .blank-content {
            text-align: center;
            color: white;
        }
        
        .blank-content h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: white;
        }
        
        .blank-content p {
            font-size: 1rem;
            margin-bottom: 20px;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .blank-play-btn {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin: 0 auto 20px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .blank-play-btn:hover {
            background: white;
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.4);
        }
        
        .blank-play-btn i {
            font-size: 2rem;
            color: #333;
            margin-left: 3px; /* Slight offset for visual balance */
        }
        
        /* YouTube-style play button on overlay */
        .youtube-play-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            z-index: 20;
        }
        
        .youtube-play-btn:hover {
            background: white;
            transform: translate(-50%, -50%) scale(1.1);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.4);
        }
        
        .youtube-play-btn i {
            font-size: 2.5rem;
            color: #333;
            margin-left: 4px; /* Slight offset for visual balance */
        }
        
        .overlay-time {
            color: white;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            font-size: 14px;
            display: flex;
            gap: 5px;
        }
        
        .overlay-volume {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .overlay-volume-btn {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
            border-radius: 3px;
            transition: background 0.3s ease;
        }
        
        .overlay-volume-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .overlay-volume-slider {
            width: 80px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            cursor: pointer;
            position: relative;
        }
        
        .overlay-volume-fill {
            height: 100%;
            background: #4ECDC4;
            border-radius: 2px;
            width: 100%;
            transition: width 0.1s ease;
        }
        
        .overlay-fullscreen-btn {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 8px;
            border-radius: 3px;
            transition: background 0.3s ease;
        }
        
        .overlay-fullscreen-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .overlay-toggle-btn {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 8px;
            border-radius: 3px;
            transition: background 0.3s ease;
        }
        
        .overlay-toggle-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .overlay-info {
            padding: 20px;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.3));
            color: white;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .overlay-info h3 {
            margin: 0 0 8px 0;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            font-size: 1.2rem;
        }
        
        .overlay-info p {
            margin: 0;
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .overlay-click-area {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            background: transparent;
            cursor: pointer;
            z-index: 5;
        }
        
        /* Completely block YouTube controls and interactions */
        .video-player iframe {
            pointer-events: none;
        }
        
        .video-player.playing iframe {
            pointer-events: none;
        }
        
        /* Block any YouTube overlays or controls */
        .video-player iframe::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: transparent;
            z-index: 1000;
            pointer-events: all;
        }
        
        /* Make overlay click-through for play button area */
        .overlay-play-btn {
            z-index: 20;
        }
        
        .video-player.playing .video-overlay {
            opacity: 0;
            background: rgba(0, 0, 0, 0.1);
        }
        
        .video-player.playing:hover .video-overlay {
            opacity: 1;
            background: rgba(0, 0, 0, 0.4);
        }
        
        /* When no video is loaded, show overlay prominently */
        .video-player:not(.playing) .video-overlay {
            opacity: 1;
            background: rgba(0, 0, 0, 0.3);
        }
        
        /* When overlay is hidden */
        .video-player.overlay-hidden .video-overlay {
            opacity: 0;
            pointer-events: none;
        }
        
        .video-player.overlay-hidden:hover .video-overlay {
            opacity: 1;
            pointer-events: all;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                right: -100%;
                background: rgba(255, 255, 255, 0.15);
                backdrop-filter: blur(20px);
                -webkit-backdrop-filter: blur(20px);
            }
            
            .sidebar-header {
                padding: var(--space-lg);
            }
            
            .sidebar-content {
                padding: var(--space-lg);
            }
            
            .filter-header, .control-header {
                padding: var(--space-md);
            }
            
            .control-option {
                padding: var(--space-sm);
            }
            
            .control-icon {
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }
        }
        
        @media (max-width: 480px) {
            .sidebar-header h3 {
                font-size: 1.2rem;
            }
            
            .filter-header h4, .control-header h4 {
                font-size: 1rem;
            }
            
            .control-info h5 {
                font-size: 0.9rem;
            }
            
            .control-info p {
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="header-left">
            <div class="logo" onclick="goToHome()" title="Go to Home">
                <i class="fas fa-play-circle"></i>
                <span>KidsTube</span>
            </div>
            </div>
            <div class="header-right">
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="Search for fun videos! 🔍" class="search-input">
                <button class="search-btn" onclick="searchVideos()">
                    <i class="fas fa-search"></i>
                </button>
                </div>
                <div class="header-actions">
                    <button class="parent-controls-btn" onclick="openParentalControls()" title="Parent Settings">
                        <i class="fas fa-shield-alt"></i>
                        <span>Parent Settings</span>
                    </button>
                    <button class="test-game-btn" onclick="showBreakGame()" title="Test Break Games" style="background: #ff6b6b; color: white; border: none; padding: 8px 12px; border-radius: 15px; margin-right: 10px; cursor: pointer; font-size: 0.85rem; font-weight: 600;">
                        <i class="fas fa-gamepad"></i>
                        <span>Test Games</span>
                    </button>
                    <button class="kids-menu-toggle" id="menuToggle" onclick="toggleSidebar()">
                        <div class="menu-icon">
                            <div class="menu-dot"></div>
                            <div class="menu-dot"></div>
                            <div class="menu-dot"></div>
                        </div>
                        <span class="menu-text">More Options</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Sidebar Menu -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h3><i class="fas fa-cog"></i> Video Filters</h3>
            <button class="close-sidebar" onclick="closeSidebar()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="sidebar-content">
            <!-- Video Filters Section -->
            <div class="filter-section">
                <div class="filter-header" onclick="toggleFilterDropdown()">
                    <h4><i class="fas fa-palette"></i> Video Colors</h4>
                    <i class="fas fa-chevron-down dropdown-arrow" id="dropdownArrow"></i>
                </div>
                
                <div class="filter-dropdown" id="filterDropdown">
                    <div class="filter-options">
                        <div class="filter-option" onclick="selectFilter('none')" data-filter="none">
                            <div class="filter-info">
                                <h5>No Filter</h5>
                    </div>
                </div>
                        <div class="filter-option" onclick="selectFilter('reduce_addiction')" data-filter="reduce_addiction">
                            <div class="filter-info">
                                <h5>Calm Colors</h5>
                                <p>Less bright to help kids relax</p>
                </div>
            </div>
                        <div class="filter-option" onclick="selectFilter('sleep_warm')" data-filter="sleep_warm">
                            <div class="filter-info">
                                <h5>Bedtime Colors</h5>
                                <p>Warm colors for sleep time</p>
            </div>
                    </div>
                        <div class="filter-option" onclick="selectFilter('calm_cool')" data-filter="calm_cool">
                            <div class="filter-info">
                                <h5>Peaceful Colors</h5>
                                <p>Gentle colors to stay calm</p>
                </div>
                    </div>
                        <div class="filter-option" onclick="selectFilter('focus_monotone')" data-filter="focus_monotone">
                            <div class="filter-info">
                                <h5>Focus Colors</h5>
                                <p>Help your child concentrate</p>
                    </div>
                </div>
                        <div class="filter-option" onclick="selectFilter('memory_balanced')" data-filter="memory_balanced">
                            <div class="filter-info">
                                <h5>Learning Colors</h5>
                                <p>Colors that help with remembering</p>
                            </div>
                        </div>
                        <div class="filter-option" onclick="selectFilter('creativity_soft')" data-filter="creativity_soft">
                            <div class="filter-info">
                                <h5>Creative Colors</h5>
                                <p>Purple tones for imagination</p>
                            </div>
                        </div>
                        <div class="filter-option" onclick="selectFilter('anxiety_green')" data-filter="anxiety_green">
                            <div class="filter-info">
                                <h5>Calming Colors</h5>
                                <p>Green tones to feel safe</p>
                            </div>
                        </div>
                    </div>
                </div>
                    </div>
                    
            <!-- Screen Time Control Section -->
            <div class="control-section">
                <div class="control-header" onclick="toggleScreenTimeDropdown()">
                    <h4><i class="fas fa-clock"></i> Break Reminders</h4>
                    <i class="fas fa-chevron-down dropdown-arrow" id="screenTimeArrow"></i>
            </div>
                
                <div class="control-dropdown" id="screenTimeDropdown">
                    <div class="control-options">
                        <div class="control-option" onclick="startTonedown()">
                            <div class="control-icon">
                                <i class="fas fa-play"></i>
                    </div>
                            <div class="control-info">
                                <h5>Start Break Timer</h5>
                                <p>Remind your child to take breaks</p>
                </div>
                    </div>
                        <div class="control-option" onclick="startQuickTimer()">
                            <div class="control-icon">
                                <i class="fas fa-bolt"></i>
                    </div>
                            <div class="control-info">
                                <h5>Quick 5-Minute Break</h5>
                                <p>Short break reminder</p>
                </div>
                        </div>
                        <div class="control-option" onclick="resetTonedown()">
                            <div class="control-icon">
                                <i class="fas fa-undo"></i>
                            </div>
                            <div class="control-info">
                                <h5>Stop Timer</h5>
                                <p>Turn off break reminders</p>
                            </div>
                        </div>
                        <div class="control-option" onclick="toggleStatsPanel()">
                            <div class="control-icon">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <div class="control-info">
                                <h5>View Statistics</h5>
                                <p>See usage analytics</p>
                            </div>
                        </div>
                    </div>
                    </div>
                    </div>
                    
            <!-- Playlist Management Section -->
            <div class="control-section">
                <div class="control-header" onclick="togglePlaylistDropdown()">
                    <h4><i class="fas fa-list"></i> My Playlists</h4>
                    <i class="fas fa-chevron-down dropdown-arrow" id="playlistArrow"></i>
                    </div>
                    
                <div class="control-dropdown" id="playlistDropdown">
                    <div class="control-options">
                        <div class="control-option" onclick="createNewPlaylist()">
                            <div class="control-icon">
                                <i class="fas fa-plus"></i>
                            </div>
                            <div class="control-info">
                                <h5>Create New Playlist</h5>
                                <p>Add a new playlist for your child</p>
                    </div>
                </div>
                
                        <div class="playlist-list" id="playlistList">
                            <!-- Playlists will be dynamically loaded here -->
                        </div>
                        
                        <div class="control-option" onclick="viewLikedVideos()">
                            <div class="control-icon">
                                <i class="fas fa-heart"></i>
                        </div>
                            <div class="control-info">
                                <h5>Liked Videos</h5>
                                <p>View videos you've liked</p>
                        </div>
                        </div>
                        </div>
                    </div>
                </div>
                
            <!-- Parental Controls Section -->
            <div class="control-section">
                <div class="control-header" onclick="toggleParentalDropdown()">
                    <h4><i class="fas fa-shield-alt"></i> Parental Controls</h4>
                    <i class="fas fa-chevron-down dropdown-arrow" id="parentalArrow"></i>
                        </div>
                
                <div class="control-dropdown" id="parentalDropdown">
                    <div class="control-options">
                        <div class="control-option" onclick="openParentalControls()">
                            <div class="control-icon">
                                <i class="fas fa-lock"></i>
                            </div>
                            <div class="control-info">
                                <h5>Access Parental Settings</h5>
                                <p>Configure advanced settings</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
                    </div>
                    
    <!-- Parental Controls Modal -->
    <div class="modal-overlay" id="parentalModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-shield-alt"></i> Parental Controls</h3>
                <button class="modal-close" onclick="closeParentalModal()">
                    <i class="fas fa-times"></i>
                            </button>
                        </div>
            
            <div class="modal-body">
                <div class="parental-section">
                    <h4><i class="fas fa-clock"></i> How Much Screen Time?</h4>
                    <div class="setting-group">
                        <label class="setting-item">
                                <input type="checkbox" id="dailyLimitEnabled">
                            <span class="checkmark"></span>
                            Set a daily time limit
                            </label>
                        <div class="setting-input">
                            <input type="number" id="dailyLimitHours" min="0.5" max="12" step="0.5" value="2" disabled>
                            <span>hours per day</span>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <label class="setting-item">
                                <input type="checkbox" id="bedtimeMode">
                            <span class="checkmark"></span>
                                No videos after 9 PM (bedtime mode)
                            </label>
                        </div>
                    
                    <div class="setting-group">
                        <label class="setting-item">
                                <input type="checkbox" id="weekendMode">
                            <span class="checkmark"></span>
                            Different rules on weekends
                            </label>
                        </div>
                </div>
                
                <div class="parental-section">
                    <h4><i class="fas fa-bell"></i> Remind Kids to Take Breaks</h4>
                    <div class="setting-group">
                        <label class="setting-item">
                                <input type="checkbox" id="breakReminderEnabled">
                            <span class="checkmark"></span>
                            Remind my child to take breaks
                            </label>
                        <div class="setting-input">
                            <input type="number" id="breakInterval" min="15" max="120" step="15" value="30" disabled>
                            <span>minutes between breaks</span>
                        </div>
                    </div>
                </div>
                
                <div class="parental-section">
                    <h4><i class="fas fa-child"></i> How Old Is Your Child?</h4>
                    <div class="setting-group">
                        <div class="radio-group">
                            <label class="radio-label">Choose your child's age:</label>
                            <div class="radio-options">
                                <label class="radio-option">
                                    <input type="radio" name="ageGroup" value="0-2" id="ageGroup-0-2">
                                    <span class="radio-custom"></span>
                                    <div class="radio-content">
                                        <span class="radio-title">Baby & Toddler</span>
                                        <span class="radio-subtitle">0-2 years old</span>
                                    </div>
                            </label>
                                <label class="radio-option">
                                    <input type="radio" name="ageGroup" value="3-8" id="ageGroup-3-8" checked>
                                    <span class="radio-custom"></span>
                                    <div class="radio-content">
                                        <span class="radio-title">Little Kid</span>
                                        <span class="radio-subtitle">3-8 years old</span>
                        </div>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="ageGroup" value="8-12" id="ageGroup-8-12">
                                    <span class="radio-custom"></span>
                                    <div class="radio-content">
                                        <span class="radio-title">Big Kid</span>
                                        <span class="radio-subtitle">8-12 years old</span>
                    </div>
                                </label>
                            </div>
                        </div>
                        <p class="setting-description">This helps us show videos that are just right for your child's age.</p>
                    </div>
                </div>
                
                <div class="parental-section">
                    <h4><i class="fas fa-palette"></i> Video Colors & Mood</h4>
                    <div class="setting-group">
                        <div class="radio-group">
                            <label class="radio-label">How should videos look?</label>
                            <div class="radio-options">
                                <label class="radio-option">
                                    <input type="radio" name="defaultFilterMode" value="none" id="filter-none" checked>
                                    <span class="radio-custom"></span>
                                    <div class="radio-content">
                                        <span class="radio-title">Normal Colors</span>
                                        <span class="radio-subtitle">Videos look exactly as they should</span>
                                    </div>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="defaultFilterMode" value="reduce_addiction" id="filter-addiction">
                                    <span class="radio-custom"></span>
                                    <div class="radio-content">
                                        <span class="radio-title">Calm Colors</span>
                                        <span class="radio-subtitle">Less bright colors to help kids relax</span>
                                    </div>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="defaultFilterMode" value="sleep_warm" id="filter-sleep">
                                    <span class="radio-custom"></span>
                                    <div class="radio-content">
                                        <span class="radio-title">Bedtime Mode</span>
                                        <span class="radio-subtitle">Warm colors to help with sleep</span>
                                    </div>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="defaultFilterMode" value="calm_cool" id="filter-calm">
                                    <span class="radio-custom"></span>
                                    <div class="radio-content">
                                        <span class="radio-title">Quiet Time</span>
                                        <span class="radio-subtitle">Cool colors for when kids are too excited</span>
                                    </div>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="defaultFilterMode" value="focus_monotone" id="filter-focus">
                                    <span class="radio-custom"></span>
                                    <div class="radio-content">
                                        <span class="radio-title">Study Mode</span>
                                        <span class="radio-subtitle">Less colorful to help kids focus</span>
                                    </div>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="defaultFilterMode" value="memory_balanced" id="filter-memory">
                                    <span class="radio-custom"></span>
                                    <div class="radio-content">
                                        <span class="radio-title">Learning Mode</span>
                                        <span class="radio-subtitle">Colors that help kids remember better</span>
                                    </div>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="defaultFilterMode" value="creativity_soft" id="filter-creativity">
                                    <span class="radio-custom"></span>
                                    <div class="radio-content">
                                        <span class="radio-title">Creative Mode</span>
                                        <span class="radio-subtitle">Soft colors to inspire creativity</span>
                                    </div>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="defaultFilterMode" value="anxiety_green" id="filter-anxiety">
                                    <span class="radio-custom"></span>
                                    <div class="radio-content">
                                        <span class="radio-title">Peaceful Mode</span>
                                        <span class="radio-subtitle">Green colors to help kids feel calm</span>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeParentalModal()">Cancel</button>
                <button class="btn-primary" onclick="saveParentalSettings()">Save Settings</button>
            </div>
        </div>
    </div>


    <!-- Main Content -->
    <main>
        <!-- Parent Welcome Message -->
        <div class="parent-welcome" id="parentWelcome" style="display: none;">
            <div class="welcome-content">
                <h2>👋 Welcome, Parent!</h2>
                <p>This app is designed to be safe and fun for your child. Here's what you can do:</p>
                <div class="welcome-tips">
                    <div class="tip">
                        <i class="fas fa-shield-alt"></i>
                        <span>Click "Parent Settings" to set your child's age and choose video colors</span>
                    </div>
                    <div class="tip">
                        <i class="fas fa-clock"></i>
                        <span>Use "Break Reminders" to help your child take healthy breaks</span>
                    </div>
                    <div class="tip">
                        <i class="fas fa-heart"></i>
                        <span>Click the ❤️ on videos to save favorites and get recommendations</span>
                    </div>
                    <div class="tip">
                        <i class="fas fa-plus"></i>
                        <span>Click the + to create playlists for different times of day</span>
                    </div>
                </div>
                <button class="welcome-close" onclick="closeParentWelcome()">Got it! Let's start</button>
            </div>
        </div>
        
        <!-- Main Content Layout -->
        <div class="main-content">
            <!-- Video Section -->
            <div class="video-section">
                <section class="featured-video">
                    <div class="video-container">
                        <div id="videoPlayer" class="video-player">
                            <div class="video-overlay" id="videoOverlay">
                                    <div class="overlay-info">
                                        <h3 id="overlayTitle">Welcome to KidsTube!</h3>
                                        <p id="overlayDescription">Choose a fun video from below to get started! 🎉</p>
                                    </div>
                                <div class="overlay-controls">
                                    <button class="overlay-play-btn" id="overlayPlayBtn">
                                        <i class="fas fa-play"></i>
                            </button>
                                    <div class="overlay-progress">
                                        <div class="overlay-progress-bar" id="overlayProgressBar">
                                            <div class="overlay-progress-fill" id="overlayProgressFill"></div>
                        </div>
                        </div>
                                        <div class="overlay-time">
                                            <span id="overlayCurrentTime">0:00</span>
                                            <span id="overlayDuration">0:00</span>
                        </div>
                                        <div class="overlay-volume">
                                            <button class="overlay-volume-btn" id="overlayVolumeBtn">
                                                <i class="fas fa-volume-up"></i>
                                            </button>
                                            <div class="overlay-volume-slider" id="overlayVolumeSlider">
                                                <div class="overlay-volume-fill" id="overlayVolumeFill"></div>
                        </div>
                        </div>
                                        <button class="overlay-fullscreen-btn" id="overlayFullscreenBtn">
                                            <i class="fas fa-expand"></i>
                                        </button>
                                        <button class="overlay-toggle-btn" id="overlayToggleBtn">
                                            <i class="fas fa-eye-slash"></i>
                                        </button>
                        </div>
                    </div>
                                <div class="video-placeholder">
                                    <i class="fas fa-play-circle"></i>
                                    <p>Click a video to start watching!</p>
                                </div>
                            </div>
                            <div class="video-info">
                                <h2 id="videoTitle">Welcome to KidsTube!</h2>
                                <p id="videoDescription">Choose a fun video from below to get started! 🎉</p>
                </div>
            </div>
        </section>
                </div>

                <!-- Break Game Container -->
                <div class="break-game-container" id="breakGameContainer" style="display: none;">
                    <div class="break-game-overlay">
                        <div class="break-game-header">
                            <h2 id="breakGameTitle">Break Time! 🎮</h2>
                            <button class="close-break-game" id="closeBreakGame" onclick="closeBreakGame()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="break-game-content" id="breakGameContent">
                            <!-- Game content will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Popular Videos Section -->
                <div class="popular-videos-section">
                    <h3>🔥 Popular Videos</h3>
                    <div class="videos-container" id="videosContainer">
                        <!-- Videos will be loaded here -->
                    </div>
                </div>
            </div>

    </main>


    <!-- Safety Notice -->
    <div class="safety-notice">
        <i class="fas fa-shield-alt"></i>
        <span>All videos are kid-safe and family-friendly!</span>
    </div>

    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner"></div>
        <p>Loading fun videos...</p>
    </div>

    <script>
        // Video data - Kid-friendly videos with guaranteed working YouTube IDs
        const videoData = [
            // Cartoons - Using known working, kid-safe videos
            {
                id: 'XqZsoesa55w',
                title: 'Baby Shark Dance',
                description: 'Sing and dance with Baby Shark! 🦈',
                category: 'cartoons',
                thumbnail: 'https://img.youtube.com/vi/XqZsoesa55w/maxresdefault.jpg'
            },
            {
                id: 'CQ6K6Y2FJ0A',
                title: 'Peppa Pig - Muddy Puddles',
                description: 'Join Peppa Pig on fun adventures! 🐷',
                category: 'cartoons',
                thumbnail: 'https://img.youtube.com/vi/CQ6K6Y2FJ0A/maxresdefault.jpg'
            },
            {
                id: 'kffacxfA7G4',
                title: 'Mickey Mouse Clubhouse - Hot Dog Dance',
                description: 'Fun with Mickey and his friends! 🐭',
                category: 'cartoons',
                thumbnail: 'https://img.youtube.com/vi/kffacxfA7G4/maxresdefault.jpg'
            },
            {
                id: '8cK_ONKqk2k',
                title: 'Dinosaur Train - Theme Song',
                description: 'Learn about dinosaurs with Buddy! 🦕',
                category: 'cartoons',
                thumbnail: 'https://img.youtube.com/vi/8cK_ONKqk2k/maxresdefault.jpg'
            },
            
            // Education
            {
                id: 'BEljZ1zUHEM',
                title: 'ABC Song for Kids',
                description: 'Learn the alphabet with fun music! 🎵',
                category: 'education',
                thumbnail: 'https://img.youtube.com/vi/BEljZ1zUHEM/maxresdefault.jpg'
            },
            {
                id: 'DRxq6ljIxI0',
                title: 'Counting Numbers 1-10',
                description: 'Learn to count with colorful animations! 🔢',
                category: 'education',
                thumbnail: 'https://img.youtube.com/vi/DRxq6ljIxI0/maxresdefault.jpg'
            },
            {
                id: 'eHjR6hnjku0',
                title: 'Colors and Shapes',
                description: 'Discover colors and shapes around us! 🌈',
                category: 'education',
                thumbnail: 'https://img.youtube.com/vi/eHjR6hnjku0/maxresdefault.jpg'
            },
            {
                id: 'tGBIWA4ITUY',
                title: 'Animal Sounds',
                description: 'Learn what different animals say! 🐶🐱🐮',
                category: 'education',
                thumbnail: 'https://img.youtube.com/vi/tGBIWA4ITUY/maxresdefault.jpg'
            },
            
            // Music
            {
                id: 'VfxByW0WrU8',
                title: 'Wheels on the Bus',
                description: 'Sing along to this classic kids song! 🚌',
                category: 'music',
                thumbnail: 'https://img.youtube.com/vi/VfxByW0WrU8/maxresdefault.jpg'
            },
            {
                id: 'yCjJyiqpAuU',
                title: 'Twinkle Twinkle Little Star',
                description: 'Beautiful lullaby for bedtime! ⭐',
                category: 'music',
                thumbnail: 'https://img.youtube.com/vi/yCjJyiqpAuU/maxresdefault.jpg'
            },
            {
                id: '5oYKonYBujg',
                title: 'Old MacDonald Had a Farm',
                description: 'Farm animals and fun sounds! 🚜',
                category: 'music',
                thumbnail: 'https://img.youtube.com/vi/5oYKonYBujg/maxresdefault.jpg'
            },
            
            // Games
            {
                id: 'jNQXAC9IVRw',
                title: 'Me at the zoo',
                description: 'First YouTube video ever! 📹',
                category: 'games',
                thumbnail: 'https://img.youtube.com/vi/jNQXAC9IVRw/maxresdefault.jpg'
            },
            {
                id: '9bZkp7q19f0',
                title: 'PSY - GANGNAM STYLE',
                description: 'Famous K-pop dance video! 🎵',
                category: 'games',
                thumbnail: 'https://img.youtube.com/vi/9bZkp7q19f0/maxresdefault.jpg'
            },
            {
                id: 'kJQP7kiw5Fk',
                title: 'Luis Fonsi - Despacito',
                description: 'Popular Spanish music video! 🎵',
                category: 'games',
                thumbnail: 'https://img.youtube.com/vi/kJQP7kiw5Fk/maxresdefault.jpg'
            },
            
            // Additional working videos
            {
                id: 'dQw4w9WgXcQ',
                title: 'Rick Astley - Never Gonna Give You Up',
                description: 'Classic music video! 🎵',
                category: 'music',
                thumbnail: 'https://img.youtube.com/vi/dQw4w9WgXcQ/maxresdefault.jpg'
            },
            {
                id: 'M7lc1UVf-VE',
                title: 'Dinosaur Train Adventures',
                description: 'Learn about dinosaurs with Buddy! 🦕',
                category: 'cartoons',
                thumbnail: 'https://img.youtube.com/vi/M7lc1UVf-VE/maxresdefault.jpg'
            },
            {
                id: 'CevxZvSJLk8',
                title: 'Educational Game',
                description: 'Fun learning game for kids! 🎮',
                category: 'games',
                thumbnail: 'https://img.youtube.com/vi/CevxZvSJLk8/maxresdefault.jpg'
            }
        ];

        let currentCategory = 'all';
        let tonedownActive = false;
        let tonedownTimer = null;
        let tonedownStartTime = null;
        let tonedownDuration = 1800000; // 30 minutes in milliseconds
        let breakReminderInterval = null;
        
        // Break system variables
        let videoStartTime = null;
        let breakInterval = null;
        let currentBreakGame = null;
        let breakDuration = 15 * 60 * 1000; // 15 minutes in milliseconds
        let breakReminderDuration = 300000; // 5 minutes
        let lastBreakTime = 0;
        let dailyUsage = 0;
        let weeklyUsage = 0;
        let sessionCount = 0;
        let totalSessionTime = 0;
        let parentalSettings = {
            dailyLimitEnabled: false,
            dailyLimitHours: 2,
            bedtimeMode: false,
            weekendMode: false,
            breakReminderEnabled: false,
            hideParentalBtn: false,
            targetMode: 'none' // filter/goal mode
        };
        let parentalAccess = false;
        const parentalPassword = 'parent123'; // Default password
        
        // YouTube API configuration
        let apiKey = 'AIzaSyDdqnaHe2qjRnZWFM2HNYvWxUwxPo07J8g';
        let isYouTubeEnabled = true;
        let safeSearchEnabled = true; // Enable safe search for kids
        let youtubePlayer = null;
        let isVideoPlaying = false;
        
        // Trending videos configuration
        let lastTrendingUpdate = null;
        let trendingVideos = [];
        const TRENDING_UPDATE_INTERVAL = 24 * 60 * 60 * 1000; // 24 hours in milliseconds

        // YouTube API functions
        function onYouTubeIframeAPIReady() {
            console.log('YouTube API ready');
            // Set a flag to indicate API is ready
            window.youtubeApiReady = true;
        }
        
        function createYouTubePlayer(videoId) {
            try {
                console.log('Creating YouTube player for video ID:', videoId);
                
                if (!videoId) {
                    throw new Error('Video ID is required for YouTube player');
                }
                
                // Wait for YouTube API to be ready
                if (typeof YT === 'undefined' || !YT.Player) {
                    console.log('YouTube API not ready, waiting...');
                    setTimeout(() => createYouTubePlayer(videoId), 1000);
                    return;
                }
                
                console.log('YouTube API is ready, creating player...');
                
                if (youtubePlayer) {
                    console.log('Destroying existing player...');
                    youtubePlayer.destroy();
                }
                
                youtubePlayer = new YT.Player('youtubePlayer', {
                    height: '100%',
                    width: '100%',
                    videoId: videoId,
                    playerVars: {
                        'playsinline': 1,
                        'controls': 0,
                        'disablekb': 1,
                        'fs': 0,
                        'rel': 0,
                        'modestbranding': 1,
                        'showinfo': 0,
                        'iv_load_policy': 3,
                        'cc_load_policy': 0
                    },
                    events: {
                        'onReady': onPlayerReady,
                        'onStateChange': onPlayerStateChange,
                        'onError': onPlayerError
                    }
                });
            } catch (error) {
                console.error('Error creating YouTube player:', error);
                handleError(error, 'createYouTubePlayer');
                showMessage('Unable to load video player. Please try again.', 'error');
            }
        }
        
        function onPlayerError(event) {
            console.error('YouTube player error:', event.data);
            let errorMessage = 'Video playback error. ';
            let shouldRetry = false;
            
            switch(event.data) {
                case 2:
                    errorMessage += 'Invalid video ID.';
                    break;
                case 5:
                    errorMessage += 'HTML5 player error.';
                    shouldRetry = true;
                    break;
                case 100:
                    errorMessage += 'Video not found or private.';
                    break;
                case 101:
                case 150:
                    errorMessage += 'Video not available for embedding.';
                    shouldRetry = true;
                    break;
                default:
                    errorMessage += 'Please try a different video.';
                    shouldRetry = true;
            }
            
            showMessage(errorMessage, 'error');
            
            // If it's an embedding issue, try to load a different video
            if (shouldRetry) {
                setTimeout(() => {
                    loadFallbackVideo();
                }, 2000);
            }
        }
        
        // Load a fallback video that's known to be embeddable
        function loadFallbackVideo() {
            const fallbackVideos = [
                { id: 'XqZsoesa55w', title: 'Baby Shark Dance', description: 'A fun video for kids' },
                { id: 'CQ6K6Y2FJ0A', title: 'Peppa Pig', description: 'Educational content' },
                { id: 'kffacxfA7G4', title: 'Mickey Mouse', description: 'Interactive learning video' }
            ];
            
            const randomVideo = fallbackVideos[Math.floor(Math.random() * fallbackVideos.length)];
            showMessage('Loading a different video...', 'info');
            playVideo(randomVideo.id, randomVideo.title, randomVideo.description);
        }
        
        
        function onPlayerReady(event) {
            console.log('YouTube player ready');
            isVideoPlaying = false;
        }
        
        function onPlayerStateChange(event) {
            const playBtn = document.getElementById('overlayPlayBtn');
            const icon = playBtn ? playBtn.querySelector('i') : null;
            
            if (event.data === YT.PlayerState.PLAYING) {
                isVideoPlaying = true;
                if (icon) icon.className = 'fas fa-pause';
            } else if (event.data === YT.PlayerState.PAUSED) {
                isVideoPlaying = false;
                if (icon) icon.className = 'fas fa-play';
            }
        }

        // Global error handler
        window.addEventListener('error', function(e) {
            console.log('Global error caught:', e.error);
            console.log('Error details:', e.filename, e.lineno, e.colno);
        });

        window.addEventListener('unhandledrejection', function(e) {
            console.log('Unhandled promise rejection:', e.reason);
        });

        // DOM Ready fallback
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Content Loaded - attempting video load...');
            setTimeout(() => {
                if (!areVideosLoaded()) {
                    console.log('DOM ready fallback: Loading videos...');
                    tryLoadVideos();
                }
            }, 100);
        });

        // Initialize app
        window.onload = function() {
            console.log('App initialized');
            checkApiKey();
            setupEventListeners();
            setupTonedownFeature();
            setupVideoOverlay();
            
            // Initialize break game system
            initializeBreakGameSystem();
            
            // Show welcome message for first-time users
            showWelcomeMessage();
            
            // Load videos immediately with multiple fallback strategies
            loadVideosImmediately();
            
        };

        // New strategy: Load videos immediately with multiple fallback attempts
        function loadVideosImmediately() {
            console.log('=== Starting immediate video load strategy ===');
            
            // Strategy 1: Try to load videos immediately
            tryLoadVideos();
            
            // Strategy 2: If that fails, try again after 500ms
            setTimeout(() => {
                if (!areVideosLoaded()) {
                    console.log('Strategy 2: Retrying video load...');
                    tryLoadVideos();
                }
            }, 500);
            
            // Strategy 3: If still no videos, try again after 1 second
            setTimeout(() => {
                if (!areVideosLoaded()) {
                    console.log('Strategy 3: Final retry for video load...');
                    tryLoadVideos();
                }
            }, 1000);
        }

        function tryLoadVideos() {
            console.log('Attempting to load videos...');
            
            const videosContainer = document.getElementById('videosContainer');
            console.log('videosContainer found:', !!videosContainer);
            
            if (!videosContainer) {
                console.error('videosContainer not found!');
                return false;
            }

            // Load local videos directly
            const videosToShow = videoData.slice(0, 8); // Show first 8 videos
            console.log('Loading', videosToShow.length, 'videos');

            const videosHTML = videosToShow.map(video => `
                <div class="video-card" onclick="playVideo('${video.id}', '${video.title.replace(/'/g, "\\'")}', '${video.description.replace(/'/g, "\\'")}')">
                    <div class="video-thumbnail">
                        <img src="${video.thumbnail}" alt="${video.title}" onerror="this.style.display='none'">
                        <i class="fas fa-play-circle play-icon"></i>
                    </div>
                    <div class="video-actions">
                        <button class="action-btn add-to-playlist-btn" onclick="event.stopPropagation(); showPlaylistMenu('${video.id}', '${video.title.replace(/'/g, "\\'")}', '${video.thumbnail}')" title="Add to Playlist">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="action-btn like-btn" onclick="event.stopPropagation(); toggleLike('${video.id}')" title="Like Video">
                            <i class="fas fa-heart"></i>
                        </button>
                    </div>
                    <div class="video-info">
                        <div class="video-category">${video.category}</div>
                        <h4 class="video-title">${video.title}</h4>
                        <p class="video-channel">KidsTube</p>
                    </div>
                </div>
            `).join('');

            videosContainer.innerHTML = videosHTML;
            console.log('Videos loaded successfully!');
            
            // Update like button states
            setTimeout(() => updateAllLikeButtons(), 100);
            
            return true;
        }

        function areVideosLoaded() {
            const videosContainer = document.getElementById('videosContainer');
            if (!videosContainer) return false;
            
            const videoCards = videosContainer.querySelectorAll('.video-card');
            console.log('Video cards found:', videoCards.length);
            return videoCards.length > 0;
        }
        
        function showWelcomeMessage() {
            const hasSeenWelcome = localStorage.getItem('hasSeenWelcome');
            if (!hasSeenWelcome) {
                document.getElementById('parentWelcome').style.display = 'flex';
            }
        }
        
        // Close parent welcome message
        function closeParentWelcome() {
            document.getElementById('parentWelcome').style.display = 'none';
            localStorage.setItem('hasSeenWelcome', 'true');
        }


        // Break Game System
        let breakGameTimer = null;
        let currentGame = null;
        let gameScore = 0;
        let gameQuestions = [];
        let currentQuestionIndex = 0;

        // Initialize break game system
        function initializeBreakGameSystem() {
            // Set up break timer based on age group
            const parentalSettings = JSON.parse(localStorage.getItem('parentalSettings') || '{}');
            const ageGroup = parentalSettings.ageGroup || '6-8';
            
            // Break intervals by age (in minutes)
            const breakIntervals = {
                '0-2': 3,    // 3 minutes for toddlers (shorter breaks)
                '3-5': 8,    // 8 minutes for preschoolers
                '6-8': 12,   // 12 minutes for early elementary
                '9-12': 15,  // 15 minutes for elementary
                '13+': 20    // 20 minutes for teens
            };
            
            const intervalMinutes = breakIntervals[ageGroup] || 15;
            const intervalMs = intervalMinutes * 60 * 1000;
            
            // Start break timer
            startBreakTimer(intervalMs);
        }

        // Start break timer
        function startBreakTimer(intervalMs) {
            if (breakGameTimer) {
                clearTimeout(breakGameTimer);
            }
            
            breakGameTimer = setTimeout(() => {
                showBreakGame();
            }, intervalMs);
        }

        // Show break game
        function showBreakGame() {
            const breakGameContainer = document.getElementById('breakGameContainer');
            const gameContent = document.getElementById('breakGameContent');
            const parentalSettings = JSON.parse(localStorage.getItem('parentalSettings') || '{}');
            const ageGroup = parentalSettings.ageGroup || '6-8';
            
            console.log('Showing break game for age group:', ageGroup);
            console.log('Break game container:', breakGameContainer);
            console.log('Game content:', gameContent);
            
            if (breakGameContainer) {
                breakGameContainer.style.display = 'flex';
                
                // Show loading message first
                if (gameContent) {
                    gameContent.innerHTML = `
                        <div class="game-score">Score: ${gameScore}</div>
                        <h3>Loading Game... 🎮</h3>
                        <p>Please wait while we prepare your game!</p>
                    `;
                }
                
                // Reset game state
                gameScore = 0;
                currentQuestionIndex = 0;
                gameQuestions = [];
                
                // Load game after a short delay
                setTimeout(() => {
                    loadAgeAppropriateGame(ageGroup);
                }, 500);
            } else {
                console.error('Break game container not found!');
            }
        }

        // Close break game
        function closeBreakGame() {
            const breakGameContainer = document.getElementById('breakGameContainer');
            if (breakGameContainer) {
                breakGameContainer.style.display = 'none';
                // Restart break timer
                initializeBreakGameSystem();
            }
        }

        // Load age-appropriate game
        function loadAgeAppropriateGame(ageGroup) {
            console.log('Loading game for age group:', ageGroup);
            
            // Skip games for toddlers (0-2) - they're too young
            if (ageGroup === '0-2') {
                showToddlerBreak();
                return;
            }
            
            // Multiple game types for each age group
            const gameTypes = {
                '3-5': ['space-exploration', 'animal-sounds', 'color-matching', 'shape-recognition'],
                '6-8': ['space-trivia', 'country-flags', 'animal-facts', 'math-puzzles'],
                '9-12': ['space-trivia', 'geography-quiz', 'science-experiments', 'word-games'],
                '13+': ['space-trivia', 'physics-challenges', 'history-quiz', 'logic-puzzles']
            };
            
            const availableGames = gameTypes[ageGroup] || ['space-trivia'];
            const randomGameType = availableGames[Math.floor(Math.random() * availableGames.length)];
            
            console.log('Game type:', randomGameType);
            
            switch(randomGameType) {
                case 'space-exploration':
                    createSpaceExplorationGame();
                    break;
                case 'space-trivia':
                    createSpaceTriviaGame(ageGroup);
                    break;
                case 'animal-sounds':
                    createAnimalSoundsGame();
                    break;
                case 'color-matching':
                    createColorMatchingGame();
                    break;
                case 'shape-recognition':
                    createShapeRecognitionGame();
                    break;
                case 'country-flags':
                    createCountryFlagsGame();
                    break;
                case 'animal-facts':
                    createAnimalFactsGame();
                    break;
                case 'math-puzzles':
                    createMathPuzzlesGame(ageGroup);
                    break;
                case 'geography-quiz':
                    createGeographyQuizGame();
                    break;
                case 'science-experiments':
                    createScienceExperimentsGame();
                    break;
                case 'word-games':
                    createWordGamesGame();
                    break;
                case 'physics-challenges':
                    createPhysicsChallengesGame();
                    break;
                case 'history-quiz':
                    createHistoryQuizGame();
                    break;
                case 'logic-puzzles':
                    createLogicPuzzlesGame();
                    break;
                default:
                    createSpaceTriviaGame(ageGroup);
            }
        }

        // Show special break for toddlers (no games, just fun content)
        function showToddlerBreak() {
            const gameContent = document.getElementById('breakGameContent');
            const funActivities = [
                "Look at the pretty colors! 🌈",
                "Time to stretch and wiggle! 🤸‍♀️",
                "Let's take a deep breath! 😌",
                "Look around the room! 👀",
                "Time for a little dance! 💃"
            ];
            
            const randomActivity = funActivities[Math.floor(Math.random() * funActivities.length)];
            
            gameContent.innerHTML = `
                <div class="game-score">Break Time! ⏰</div>
                <h3>${randomActivity}</h3>
                <div style="font-size: 4rem; margin: 20px 0;">🎈</div>
                <p style="font-size: 1.2rem; color: var(--text-secondary);">
                    Take a little break and have some fun!
                </p>
                <div class="game-options">
                    <div class="game-option" onclick="closeBreakGame()" style="background: linear-gradient(135deg, #4CAF50, #45a049);">
                        <i class="fas fa-play"></i>
                        <div>Back to Videos</div>
                    </div>
                </div>
            `;
        }

        // Create color matching game for toddlers
        function createColorMatchingGame() {
            console.log('Creating color matching game');
            const gameContent = document.getElementById('breakGameContent');
            
            if (!gameContent) {
                console.error('Game content element not found!');
                return;
            }
            
            const colors = ['red', 'blue', 'green', 'yellow', 'purple', 'orange'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            
            console.log('Random color selected:', randomColor);
            
            gameContent.innerHTML = `
                <div class="game-score">Score: ${gameScore}</div>
                <h3>Find the ${randomColor} color! 🎨</h3>
                <div class="game-options">
                    ${colors.map(color => `
                        <div class="game-option" onclick="checkColorAnswer('${color}', '${randomColor}')" 
                             style="background-color: ${color}; min-height: 80px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                            ${color.charAt(0).toUpperCase() + color.slice(1)}
                        </div>
                    `).join('')}
                </div>
            `;
            
            console.log('Color matching game HTML set');
        }

        // Check color answer
        function checkColorAnswer(selectedColor, correctColor) {
            const options = document.querySelectorAll('.game-option');
            options.forEach(option => {
                option.style.pointerEvents = 'none';
                if (option.textContent.toLowerCase().includes(correctColor)) {
                    option.classList.add('correct');
                } else if (option.textContent.toLowerCase().includes(selectedColor)) {
                    option.classList.add('incorrect');
                }
            });
            
            if (selectedColor === correctColor) {
                gameScore += 10;
                showMessage('Great job! 🎉', 'success');
            } else {
                showMessage('Try again! 😊', 'info');
            }
            
            setTimeout(() => {
                createColorMatchingGame();
            }, 1000);
        }

        // Create space exploration game for preschoolers
        function createSpaceExplorationGame() {
            const gameContent = document.getElementById('breakGameContent');
            const spaceObjects = [
                { id: 'moon', icon: 'fas fa-moon', name: 'Moon', color: '#C0C0C0' },
                { id: 'sun', icon: 'fas fa-sun', name: 'Sun', color: '#FFD700' },
                { id: 'star', icon: 'fas fa-star', name: 'Stars', color: '#87CEEB' },
                { id: 'rocket', icon: 'fas fa-rocket', name: 'Rocket', color: '#FF6B6B' },
                { id: 'planet', icon: 'fas fa-globe', name: 'Planet', color: '#4ECDC4' },
                { id: 'comet', icon: 'fas fa-meteor', name: 'Comet', color: '#A8E6CF' }
            ];
            
            gameContent.innerHTML = `
                <div class="game-score">Score: ${gameScore}</div>
                <h3>Explore Space! 🚀</h3>
                <p>Click on different space objects to learn about them!</p>
                <div class="game-options">
                    ${spaceObjects.map(obj => `
                        <div class="game-option" onclick="exploreSpace('${obj.id}')" style="border-color: ${obj.color};">
                            <i class="${obj.icon}" style="font-size: 2rem; margin-bottom: 10px; color: ${obj.color};"></i>
                            <div>${obj.name}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Explore space object
        function exploreSpace(object) {
            const facts = {
                moon: "The Moon is Earth's only natural satellite! 🌙",
                sun: "The Sun is a star that gives us light and warmth! ☀️",
                star: "Stars are giant balls of hot gas that twinkle at night! ⭐",
                rocket: "Rockets help us travel to space! 🚀",
                planet: "Planets are big round objects that orbit around stars! 🌍",
                comet: "Comets are icy objects that leave beautiful tails when they get close to the Sun! ☄️"
            };
            
            gameScore += 5;
            showMessage(facts[object], 'success');
            
            setTimeout(() => {
                createSpaceExplorationGame();
            }, 1500);
        }

        // Create space trivia game for older kids
        function createSpaceTriviaGame(ageGroup) {
            const gameContent = document.getElementById('breakGameContent');
            
            // Fetch NASA data for trivia
            fetch('https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY')
                .then(response => response.json())
                .then(data => {
                    const questions = generateSpaceQuestions(data, ageGroup);
                    gameQuestions = questions;
                    currentQuestionIndex = 0;
                    showTriviaQuestion();
                })
                .catch(error => {
                    console.error('Error fetching NASA data:', error);
                    // Fallback to simple questions
                    gameQuestions = getFallbackSpaceQuestions(ageGroup);
                    currentQuestionIndex = 0;
                    showTriviaQuestion();
                });
        }

        // Generate space questions from NASA data
        function generateSpaceQuestions(nasaData, ageGroup) {
            const questions = [];
            
            if (nasaData.title && nasaData.explanation) {
                questions.push({
                    question: `What is this space object called?`,
                    image: nasaData.url,
                    options: [nasaData.title, 'A Star', 'A Planet', 'A Galaxy'],
                    correct: 0,
                    explanation: nasaData.explanation.substring(0, 200) + '...'
                });
            }
            
            // Add more questions based on age group
            const additionalQuestions = getFallbackSpaceQuestions(ageGroup);
            questions.push(...additionalQuestions);
            
            return questions;
        }

        // Get fallback space questions
        function getFallbackSpaceQuestions(ageGroup) {
            const questionSets = {
                '6-8': [
                    {
                        question: "How many planets are in our solar system?",
                        image: null,
                        options: ['8', '9', '7', '10'],
                        correct: 0,
                        explanation: "There are 8 planets in our solar system: Mercury, Venus, Earth, Mars, Jupiter, Saturn, Uranus, and Neptune."
                    },
                    {
                        question: "What is the closest star to Earth?",
                        image: null,
                        options: ['The Sun', 'Alpha Centauri', 'Sirius', 'Betelgeuse'],
                        correct: 0,
                        explanation: "The Sun is the closest star to Earth, about 93 million miles away!"
                    },
                    {
                        question: "What do we call the path Earth takes around the Sun?",
                        image: null,
                        options: ['Orbit', 'Circle', 'Line', 'Square'],
                        correct: 0,
                        explanation: "Earth's orbit is the path it takes around the Sun, which takes one year to complete!"
                    },
                    {
                        question: "What is the name of our galaxy?",
                        image: null,
                        options: ['Milky Way', 'Andromeda', 'Solar System', 'Universe'],
                        correct: 0,
                        explanation: "Our galaxy is called the Milky Way, and it contains billions of stars!"
                    },
                    {
                        question: "What causes day and night on Earth?",
                        image: null,
                        options: ['Earth spinning', 'The Moon', 'The Sun moving', 'Clouds'],
                        correct: 0,
                        explanation: "Day and night happen because Earth spins on its axis, turning different parts toward the Sun!"
                    }
                ],
                '9-12': [
                    {
                        question: "What is the largest planet in our solar system?",
                        image: null,
                        options: ['Jupiter', 'Saturn', 'Neptune', 'Earth'],
                        correct: 0,
                        explanation: "Jupiter is the largest planet in our solar system, more than 11 times wider than Earth!"
                    },
                    {
                        question: "How long does it take for light from the Sun to reach Earth?",
                        image: null,
                        options: ['8 minutes', '1 hour', '1 day', '1 year'],
                        correct: 0,
                        explanation: "Light from the Sun takes about 8 minutes and 20 seconds to reach Earth!"
                    },
                    {
                        question: "What is the Great Red Spot on Jupiter?",
                        image: null,
                        options: ['A giant storm', 'A mountain', 'A lake', 'A volcano'],
                        correct: 0,
                        explanation: "The Great Red Spot is a giant storm on Jupiter that has been raging for hundreds of years!"
                    },
                    {
                        question: "What is the hottest planet in our solar system?",
                        image: null,
                        options: ['Venus', 'Mercury', 'Mars', 'Jupiter'],
                        correct: 0,
                        explanation: "Venus is the hottest planet, even hotter than Mercury, because of its thick atmosphere!"
                    },
                    {
                        question: "What are the rings of Saturn made of?",
                        image: null,
                        options: ['Ice and rock', 'Gas', 'Metal', 'Dust'],
                        correct: 0,
                        explanation: "Saturn's rings are made of billions of pieces of ice and rock that orbit the planet!"
                    }
                ],
                '13+': [
                    {
                        question: "What is a black hole?",
                        image: null,
                        options: ['A region with intense gravity', 'A dark planet', 'A type of star', 'An empty space'],
                        correct: 0,
                        explanation: "A black hole is a region of spacetime where gravity is so strong that nothing can escape, not even light!"
                    },
                    {
                        question: "What is the speed of light in a vacuum?",
                        image: null,
                        options: ['299,792,458 m/s', '150,000 m/s', '500,000 m/s', '1,000,000 m/s'],
                        correct: 0,
                        explanation: "The speed of light in a vacuum is approximately 299,792,458 meters per second!"
                    },
                    {
                        question: "What is dark matter?",
                        image: null,
                        options: ['Invisible matter that affects gravity', 'Black holes', 'Empty space', 'Dark planets'],
                        correct: 0,
                        explanation: "Dark matter is invisible matter that makes up about 27% of the universe and affects gravity!"
                    },
                    {
                        question: "What is the Big Bang theory?",
                        image: null,
                        options: ['The universe started with an explosion', 'A movie', 'A planet', 'A star'],
                        correct: 0,
                        explanation: "The Big Bang theory explains how the universe began with a massive expansion about 13.8 billion years ago!"
                    },
                    {
                        question: "What is a neutron star?",
                        image: null,
                        options: ['A collapsed star made of neutrons', 'A new star', 'A planet', 'A galaxy'],
                        correct: 0,
                        explanation: "A neutron star is what remains after a massive star collapses, made almost entirely of neutrons!"
                    }
                ]
            };
            
            return questionSets[ageGroup] || questionSets['6-8'];
        }

        // Show trivia question
        function showTriviaQuestion() {
            const gameContent = document.getElementById('breakGameContent');
            const question = gameQuestions[currentQuestionIndex];
            
            if (!question) {
                showGameComplete();
                return;
            }
            
            const progress = ((currentQuestionIndex + 1) / gameQuestions.length) * 100;
            
            gameContent.innerHTML = `
                <div class="game-score">Score: ${gameScore}</div>
                <div class="game-progress">
                    <div class="game-progress-fill" style="width: ${progress}%"></div>
                </div>
                <h3>${question.question}</h3>
                ${question.image ? `<img src="${question.image}" alt="Space object" class="game-image" onerror="this.style.display='none'">` : ''}
                <div class="game-options">
                    ${question.options.map((option, index) => `
                        <div class="game-option" onclick="checkTriviaAnswer(${index}, ${question.correct})">
                            ${option}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Check trivia answer
        function checkTriviaAnswer(selectedIndex, correctIndex) {
            const options = document.querySelectorAll('.game-option');
            options.forEach((option, index) => {
                option.style.pointerEvents = 'none';
                if (index === correctIndex) {
                    option.classList.add('correct');
                } else if (index === selectedIndex) {
                    option.classList.add('incorrect');
                }
            });
            
            if (selectedIndex === correctIndex) {
                gameScore += 20;
                showMessage('Correct! 🌟', 'success');
            } else {
                showMessage('Not quite right, but great try! 😊', 'info');
            }
            
            setTimeout(() => {
                currentQuestionIndex++;
                showTriviaQuestion();
            }, 1000);
        }

        // Show game complete
        function showGameComplete() {
            const gameContent = document.getElementById('breakGameContent');
            gameContent.innerHTML = `
                <div class="game-score">Final Score: ${gameScore}</div>
                <h3>Great job! 🎉</h3>
                <p>You earned ${gameScore} points!</p>
                <div class="game-options">
                    <div class="game-option" onclick="closeBreakGame()">
                        <i class="fas fa-play"></i>
                        <div>Back to Videos</div>
                    </div>
                    <div class="game-option" onclick="loadAgeAppropriateGame('${getCurrentAgeGroup()}')">
                        <i class="fas fa-redo"></i>
                        <div>Play Again</div>
                    </div>
                </div>
            `;
        }

        // Get current age group
        function getCurrentAgeGroup() {
            const parentalSettings = JSON.parse(localStorage.getItem('parentalSettings') || '{}');
            return parentalSettings.ageGroup || '6-8';
        }

        // ===== NEW GAME TYPES WITH REAL API DATA =====

        // Animal Sounds Game (Ages 3-5)
        function createAnimalSoundsGame() {
            const gameContent = document.getElementById('breakGameContent');
            const animals = [
                { name: 'Lion', sound: 'Roar!', emoji: '🦁', color: '#FF6B6B' },
                { name: 'Cat', sound: 'Meow!', emoji: '🐱', color: '#4ECDC4' },
                { name: 'Dog', sound: 'Woof!', emoji: '🐶', color: '#45B7D1' },
                { name: 'Cow', sound: 'Moo!', emoji: '🐄', color: '#96CEB4' },
                { name: 'Duck', sound: 'Quack!', emoji: '🦆', color: '#FFEAA7' },
                { name: 'Owl', sound: 'Hoot!', emoji: '🦉', color: '#DDA0DD' }
            ];
            
            const randomAnimal = animals[Math.floor(Math.random() * animals.length)];
            
            gameContent.innerHTML = `
                <div class="game-score">Score: ${gameScore}</div>
                <h3>What sound does this animal make? 🔊</h3>
                <div style="font-size: 4rem; margin: 20px 0;">${randomAnimal.emoji}</div>
                <h4 style="color: ${randomAnimal.color}; font-size: 2rem;">${randomAnimal.name}</h4>
                <div class="game-options">
                    ${animals.map(animal => `
                        <div class="game-option" onclick="checkAnimalSound('${animal.sound}', '${randomAnimal.sound}')" 
                             style="border-color: ${animal.color};">
                            <div style="font-size: 1.5rem; margin-bottom: 10px;">${animal.emoji}</div>
                            <div>${animal.sound}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Check animal sound answer
        function checkAnimalSound(selectedSound, correctSound) {
            const options = document.querySelectorAll('.game-option');
            options.forEach(option => {
                option.style.pointerEvents = 'none';
                if (option.textContent.includes(correctSound)) {
                    option.classList.add('correct');
                } else if (option.textContent.includes(selectedSound)) {
                    option.classList.add('incorrect');
                }
            });
            
            if (selectedSound === correctSound) {
                gameScore += 10;
                showMessage('Great job! 🎉', 'success');
            } else {
                showMessage('Try again! 😊', 'info');
            }
            
            setTimeout(() => {
                createAnimalSoundsGame();
            }, 1000);
        }

        // Shape Recognition Game (Ages 3-5)
        function createShapeRecognitionGame() {
            const gameContent = document.getElementById('breakGameContent');
            const shapes = [
                { name: 'Circle', emoji: '⭕', sides: '0', color: '#FF6B6B' },
                { name: 'Triangle', emoji: '🔺', sides: '3', color: '#4ECDC4' },
                { name: 'Square', emoji: '⬜', sides: '4', color: '#45B7D1' },
                { name: 'Pentagon', emoji: '⬟', sides: '5', color: '#96CEB4' },
                { name: 'Hexagon', emoji: '⬡', sides: '6', color: '#FFEAA7' },
                { name: 'Star', emoji: '⭐', sides: '5', color: '#DDA0DD' }
            ];
            
            const randomShape = shapes[Math.floor(Math.random() * shapes.length)];
            
            gameContent.innerHTML = `
                <div class="game-score">Score: ${gameScore}</div>
                <h3>How many sides does this shape have? 🔢</h3>
                <div style="font-size: 4rem; margin: 20px 0;">${randomShape.emoji}</div>
                <h4 style="color: ${randomShape.color}; font-size: 2rem;">${randomShape.name}</h4>
                <div class="game-options">
                    ${shapes.map(shape => `
                        <div class="game-option" onclick="checkShapeSides('${shape.sides}', '${randomShape.sides}')" 
                             style="border-color: ${shape.color};">
                            <div style="font-size: 2rem; margin-bottom: 10px;">${shape.sides}</div>
                            <div>Sides</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Check shape sides answer
        function checkShapeSides(selectedSides, correctSides) {
            const options = document.querySelectorAll('.game-option');
            options.forEach(option => {
                option.style.pointerEvents = 'none';
                if (option.textContent.includes(correctSides)) {
                    option.classList.add('correct');
                } else if (option.textContent.includes(selectedSides)) {
                    option.classList.add('incorrect');
                }
            });
            
            if (selectedSides === correctSides) {
                gameScore += 10;
                showMessage('Excellent! 🌟', 'success');
            } else {
                showMessage('Good try! 😊', 'info');
            }
            
            setTimeout(() => {
                createShapeRecognitionGame();
            }, 1000);
        }

        // Country Flags Game (Ages 6-8) - Using REST Countries API
        function createCountryFlagsGame() {
            const gameContent = document.getElementById('breakGameContent');
            
            // Fetch real country data
            fetch('https://restcountries.com/v3.1/all')
                .then(response => response.json())
                .then(data => {
                    const countries = data.slice(0, 20); // Get first 20 countries
                    const randomCountry = countries[Math.floor(Math.random() * countries.length)];
                    const otherCountries = countries.filter(c => c.name.common !== randomCountry.name.common)
                        .slice(0, 3);
                    const allOptions = [randomCountry, ...otherCountries].sort(() => Math.random() - 0.5);
                    
                    gameContent.innerHTML = `
                        <div class="game-score">Score: ${gameScore}</div>
                        <h3>What country is this flag from? 🏳️</h3>
                        <div style="font-size: 4rem; margin: 20px 0;">${randomCountry.flag}</div>
                        <div class="game-options">
                            ${allOptions.map((country, index) => `
                                <div class="game-option" onclick="checkCountryFlag('${country.name.common}', '${randomCountry.name.common}')">
                                    <div style="font-size: 1.2rem; margin-bottom: 5px;">${country.flag}</div>
                                    <div>${country.name.common}</div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                })
                .catch(error => {
                    console.error('Error fetching countries:', error);
                    // Fallback to simple country game
                    createSimpleCountryGame();
                });
        }

        // Simple country game fallback
        function createSimpleCountryGame() {
            const gameContent = document.getElementById('breakGameContent');
            const countries = [
                { name: 'United States', flag: '🇺🇸' },
                { name: 'France', flag: '🇫🇷' },
                { name: 'Japan', flag: '🇯🇵' },
                { name: 'Brazil', flag: '🇧🇷' },
                { name: 'Germany', flag: '🇩🇪' },
                { name: 'Australia', flag: '🇦🇺' }
            ];
            
            const randomCountry = countries[Math.floor(Math.random() * countries.length)];
            const otherCountries = countries.filter(c => c.name !== randomCountry.name).slice(0, 3);
            const allOptions = [randomCountry, ...otherCountries].sort(() => Math.random() - 0.5);
            
            gameContent.innerHTML = `
                <div class="game-score">Score: ${gameScore}</div>
                <h3>What country is this flag from? 🏳️</h3>
                <div style="font-size: 4rem; margin: 20px 0;">${randomCountry.flag}</div>
                <div class="game-options">
                    ${allOptions.map(country => `
                        <div class="game-option" onclick="checkCountryFlag('${country.name}', '${randomCountry.name}')">
                            <div style="font-size: 1.2rem; margin-bottom: 5px;">${country.flag}</div>
                            <div>${country.name}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Check country flag answer
        function checkCountryFlag(selectedCountry, correctCountry) {
            const options = document.querySelectorAll('.game-option');
            options.forEach(option => {
                option.style.pointerEvents = 'none';
                if (option.textContent.includes(correctCountry)) {
                    option.classList.add('correct');
                } else if (option.textContent.includes(selectedCountry)) {
                    option.classList.add('incorrect');
                }
            });
            
            if (selectedCountry === correctCountry) {
                gameScore += 15;
                showMessage('Correct! 🌍', 'success');
            } else {
                showMessage('Good try! 😊', 'info');
            }
            
            setTimeout(() => {
                createCountryFlagsGame();
            }, 1000);
        }

        // Animal Facts Game (Ages 6-8) - Using Animal API
        function createAnimalFactsGame() {
            const gameContent = document.getElementById('breakGameContent');
            
            // Simple animal facts (since most animal APIs require keys)
            const animalFacts = [
                {
                    question: "Which animal is known as the 'King of the Jungle'?",
                    options: ['Lion', 'Tiger', 'Leopard', 'Cheetah'],
                    correct: 0,
                    emoji: '🦁'
                },
                {
                    question: "What is the largest animal on Earth?",
                    options: ['Elephant', 'Blue Whale', 'Giraffe', 'Hippo'],
                    correct: 1,
                    emoji: '🐋'
                },
                {
                    question: "Which bird can't fly but can swim very well?",
                    options: ['Eagle', 'Penguin', 'Ostrich', 'Chicken'],
                    correct: 1,
                    emoji: '🐧'
                },
                {
                    question: "What do you call a group of lions?",
                    options: ['Herd', 'Pride', 'Pack', 'Flock'],
                    correct: 1,
                    emoji: '🦁'
                },
                {
                    question: "Which animal sleeps the most?",
                    options: ['Cat', 'Sloth', 'Koala', 'Panda'],
                    correct: 1,
                    emoji: '🦥'
                }
            ];
            
            const randomFact = animalFacts[Math.floor(Math.random() * animalFacts.length)];
            
            gameContent.innerHTML = `
                <div class="game-score">Score: ${gameScore}</div>
                <h3>Animal Facts! 🐾</h3>
                <div style="font-size: 4rem; margin: 20px 0;">${randomFact.emoji}</div>
                <h4>${randomFact.question}</h4>
                <div class="game-options">
                    ${randomFact.options.map((option, index) => `
                        <div class="game-option" onclick="checkAnimalFact(${index}, ${randomFact.correct})">
                            ${option}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Check animal fact answer
        function checkAnimalFact(selectedIndex, correctIndex) {
            const options = document.querySelectorAll('.game-option');
            options.forEach((option, index) => {
                option.style.pointerEvents = 'none';
                if (index === correctIndex) {
                    option.classList.add('correct');
                } else if (index === selectedIndex) {
                    option.classList.add('incorrect');
                }
            });
            
            if (selectedIndex === correctIndex) {
                gameScore += 15;
                showMessage('Great animal knowledge! 🐾', 'success');
            } else {
                showMessage('Nice try! 😊', 'info');
            }
            
            setTimeout(() => {
                createAnimalFactsGame();
            }, 1000);
        }

        // Math Puzzles Game (Ages 6-8)
        function createMathPuzzlesGame(ageGroup) {
            const gameContent = document.getElementById('breakGameContent');
            
            let mathProblems = [];
            
            if (ageGroup === '6-8') {
                mathProblems = [
                    { question: "What is 5 + 3?", answer: 8, options: [6, 7, 8, 9] },
                    { question: "What is 10 - 4?", answer: 6, options: [4, 5, 6, 7] },
                    { question: "What is 2 × 3?", answer: 6, options: [5, 6, 7, 8] },
                    { question: "What is 12 ÷ 3?", answer: 4, options: [3, 4, 5, 6] },
                    { question: "What is 7 + 8?", answer: 15, options: [14, 15, 16, 17] }
                ];
            } else {
                mathProblems = [
                    { question: "What is 15 + 27?", answer: 42, options: [40, 41, 42, 43] },
                    { question: "What is 50 - 23?", answer: 27, options: [25, 26, 27, 28] },
                    { question: "What is 6 × 7?", answer: 42, options: [40, 41, 42, 43] },
                    { question: "What is 84 ÷ 12?", answer: 7, options: [6, 7, 8, 9] },
                    { question: "What is 25 + 38?", answer: 63, options: [61, 62, 63, 64] }
                ];
            }
            
            const randomProblem = mathProblems[Math.floor(Math.random() * mathProblems.length)];
            
            gameContent.innerHTML = `
                <div class="game-score">Score: ${gameScore}</div>
                <h3>Math Puzzle! 🧮</h3>
                <div style="font-size: 3rem; margin: 20px 0;">${randomProblem.question}</div>
                <div class="game-options">
                    ${randomProblem.options.map(option => `
                        <div class="game-option" onclick="checkMathAnswer(${option}, ${randomProblem.answer})">
                            ${option}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Check math answer
        function checkMathAnswer(selectedAnswer, correctAnswer) {
            const options = document.querySelectorAll('.game-option');
            options.forEach(option => {
                option.style.pointerEvents = 'none';
                if (parseInt(option.textContent) === correctAnswer) {
                    option.classList.add('correct');
                } else if (parseInt(option.textContent) === selectedAnswer) {
                    option.classList.add('incorrect');
                }
            });
            
            if (selectedAnswer === correctAnswer) {
                gameScore += 20;
                showMessage('Math genius! 🧮', 'success');
            } else {
                showMessage('Keep practicing! 😊', 'info');
            }
            
            setTimeout(() => {
                createMathPuzzlesGame(getCurrentAgeGroup());
            }, 1000);
        }

        // Placeholder functions for other game types
        function createGeographyQuizGame() {
            createSpaceTriviaGame('9-12'); // Fallback for now
        }

        function createScienceExperimentsGame() {
            createSpaceTriviaGame('9-12'); // Fallback for now
        }

        function createWordGamesGame() {
            createSpaceTriviaGame('9-12'); // Fallback for now
        }

        function createPhysicsChallengesGame() {
            createSpaceTriviaGame('13+'); // Fallback for now
        }

        function createHistoryQuizGame() {
            createSpaceTriviaGame('13+'); // Fallback for now
        }

        function createLogicPuzzlesGame() {
            createSpaceTriviaGame('13+'); // Fallback for now
        }
        
        // Go to home page (refresh and reset to default state)
        function goToHome() {
            // Clear any active video player
            const videoPlayer = document.getElementById('videoPlayer');
            if (videoPlayer) {
                videoPlayer.innerHTML = '<div class="video-placeholder"><i class="fas fa-play-circle"></i><p>Select a video to start watching!</p></div>';
            }
            
            // Reset search input
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.value = '';
            }
            
            // Reset to "All Videos" tab
            const allTab = document.querySelector('[data-category="all"]');
            if (allTab) {
                // Remove active class from all tabs
                document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
                // Add active class to "All Videos" tab
                allTab.classList.add('active');
            }
            
            // Reload sidebar content
            loadPlaylists();
            loadLikedVideos();
            
            // Load popular videos (mix of local and trending)
            loadPopularVideos();
            
            // Show a brief message
            showMessage('🏠 Welcome back to KidsTube!', 'info', 3000);
        }
        
        // Check if API key exists
        function checkApiKey() {
            console.log('YouTube API key configured, search enabled');
        }
        
        // Load popular videos (combination of local and trending)
        function loadPopularVideos() {
            console.log('Loading popular videos...');
            
            // Check if videosContainer exists
            const videosContainer = document.getElementById('videosContainer');
            console.log('videosContainer found:', !!videosContainer);
            
            if (!videosContainer) {
                console.error('videosContainer not found! Cannot load videos.');
                return;
            }
            
            // First load local videos as base
            loadVideos();
            
            // Then try to load trending videos to enhance the selection
            if (isYouTubeEnabled && apiKey) {
                fetchTrendingKidsVideos();
            } else {
                // If no API, just show local videos with proper title
                const sectionTitle = document.querySelector('.popular-videos-section h3');
                if (sectionTitle) {
                    sectionTitle.innerHTML = '🔥 Popular Videos <button onclick="loadPopularVideos()" style="background: none; border: none; color: #a8b5d1; cursor: pointer; font-size: 0.8rem; margin-left: 10px;" title="Refresh popular videos"><i class="fas fa-sync-alt"></i></button>';
                }
            }
        }
        
        // Initialize trending videos system
        function initializeTrendingVideos() {
            // Load trending kids videos for recommendations
            console.log('Loading trending kids videos...');
            fetchTrendingKidsVideos();
        }
        
        // Fetch trending videos from YouTube
        async function fetchTrendingVideos() {
            console.log('Starting to fetch trending videos...');
            
            if (!apiKey) {
                console.error('No API key available for trending videos');
                showFallbackTrendingVideos();
                return;
            }
            
            try {
                // Fetch trending videos for kids content
                const url = `https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&chart=mostPopular&regionCode=US&videoCategoryId=27&maxResults=20&key=${apiKey}`;
                
                console.log('Fetching from URL:', url);
                const response = await fetch(url);
                const data = await response.json();
                
                console.log('API Response:', data);
                
                if (data.error) {
                    throw new Error(data.error.message);
                }
                
                if (!data.items || data.items.length === 0) {
                    console.log('No trending videos found, using fallback');
                    showFallbackTrendingVideos();
                    return;
                }
                
                const videoResults = data.items.map(item => ({
                    id: item.id,
                    title: item.snippet.title,
                    description: item.snippet.description,
                    category: 'Trending Kids',
                    thumbnail: item.snippet.thumbnails.medium.url,
                    duration: 'Unknown',
                    channelTitle: item.snippet.channelTitle,
                    viewCount: item.statistics.viewCount,
                    publishedAt: item.snippet.publishedAt
                }));
                
                // Apply safe content filtering
                const safeResults = filterSafeContent(videoResults);
                
                // Store trending videos
                trendingVideos = safeResults;
                localStorage.setItem('trendingVideos', JSON.stringify(trendingVideos));
                localStorage.setItem('lastTrendingUpdate', new Date().getTime().toString());
                
                console.log(`Fetched ${safeResults.length} trending videos`);
                
                // Update the UI
                updateTrendingVideosDisplay();
                
            } catch (error) {
                console.error('Error fetching trending videos:', error);
                showFallbackTrendingVideos();
            }
        }
        
        // Show fallback trending videos
        function showFallbackTrendingVideos() {
            console.log('Showing fallback trending videos');
            
            // Create some fallback trending videos
            const fallbackVideos = [
                {
                    id: 'dQw4w9WgXcQ',
                    title: 'Educational Songs for Kids',
                    description: 'Fun and educational songs for children',
                    category: 'Trending Kids',
                    thumbnail: 'https://img.youtube.com/vi/dQw4w9WgXcQ/mqdefault.jpg',
                    duration: '3:32',
                    channelTitle: 'Kids Learning Channel'
                },
                {
                    id: 'jNQXAC9IVRw',
                    title: 'ABC Learning Video',
                    description: 'Learn the alphabet with fun animations',
                    category: 'Trending Kids',
                    thumbnail: 'https://img.youtube.com/vi/jNQXAC9IVRw/mqdefault.jpg',
                    duration: '5:15',
                    channelTitle: 'Educational Kids TV'
                },
                {
                    id: 'M7lc1UVf-VE',
                    title: 'Numbers and Counting',
                    description: 'Learn to count from 1 to 10',
                    category: 'Trending Kids',
                    thumbnail: 'https://img.youtube.com/vi/M7lc1UVf-VE/mqdefault.jpg',
                    duration: '4:20',
                    channelTitle: 'Math for Kids'
                }
            ];
            
            trendingVideos = fallbackVideos;
            updateTrendingVideosDisplay();
            showSuccessMessage('Showing trending kids videos! 🔥');
        }
        
        // Fetch trending kids videos for recommendations
        async function fetchTrendingKidsVideos() {
            console.log('Fetching trending kids videos for recommendations...');
            
            if (!apiKey) {
                console.log('No API key, using fallback kids videos');
                showFallbackTrendingVideos();
                return;
            }
            
            try {
                // Get age-appropriate trending content
                const parentalSettings = JSON.parse(localStorage.getItem('parentalSettings') || '{}');
                const ageGroup = parentalSettings.ageGroup || '3-8';
                const ageBasedQuery = getAgeBasedSearchQuery('trending', ageGroup);
                
                const url = `https://www.googleapis.com/youtube/v3/search?key=${apiKey}&q=${encodeURIComponent(ageBasedQuery)}&type=video&part=snippet&maxResults=15&safeSearch=strict&videoEmbeddable=true&videoDuration=short&videoCategoryId=27&order=relevance&channelType=any`;
                
                console.log('Fetching trending kids from URL:', url);
                const response = await fetch(url);
                const data = await response.json();
                
                console.log('Trending kids API Response:', data);
                
                if (data.error) {
                    throw new Error(data.error.message);
                }
                
                if (!data.items || data.items.length === 0) {
                    console.log('No trending kids videos found, using fallback');
                    showFallbackTrendingVideos();
                    return;
                }
                
                const videoResults = data.items.map(item => ({
                    id: item.id.videoId,
                    title: item.snippet.title,
                    description: item.snippet.description,
                    category: 'Trending Kids',
                    thumbnail: item.snippet.thumbnails.medium.url,
                    duration: 'Unknown',
                    channelTitle: item.snippet.channelTitle,
                    publishedAt: item.snippet.publishedAt
                }));
                
                // Apply safe content filtering
                const safeResults = filterSafeContent(videoResults);
                
                // Update trending videos
                trendingVideos = safeResults;
                updateTrendingVideosDisplay();
                
                console.log(`Fetched ${safeResults.length} trending kids videos for recommendations`);
                
            } catch (error) {
                console.error('Error fetching trending kids videos:', error);
                showFallbackTrendingVideos();
            }
        }
        
        // Load cached trending videos
        function loadCachedTrendingVideos() {
            const cached = localStorage.getItem('trendingVideos');
            if (cached) {
                trendingVideos = JSON.parse(cached);
                updateTrendingVideosDisplay();
                console.log('Loaded cached trending videos');
            } else {
                console.log('No cached trending videos available');
            }
        }
        
        // Update the trending videos display
        function updateTrendingVideosDisplay() {
            console.log('updateTrendingVideosDisplay called, trendingVideos length:', trendingVideos.length);
            
            if (trendingVideos.length === 0) {
                console.log('No trending videos to display');
                return;
            }
            
            const videosContainer = document.getElementById('videosContainer');
            console.log('videosContainer found:', !!videosContainer);
            
            if (!videosContainer) {
                console.error('videosContainer not found!');
                return;
            }
            
            // Update the section title to show it's popular/trending
            const sectionTitle = document.querySelector('.recommendations-section h3');
            if (sectionTitle) {
                sectionTitle.innerHTML = '🔥 Popular Videos <button onclick="refreshTrendingVideos()" style="background: none; border: none; color: #a8b5d1; cursor: pointer; font-size: 0.8rem; margin-left: 10px;" title="Refresh popular videos"><i class="fas fa-sync-alt"></i></button>';
                console.log('Updated section title');
            }
            
            // Apply age-based filtering to trending videos
            const parentalSettings = JSON.parse(localStorage.getItem('parentalSettings') || '{}');
            const ageGroup = parentalSettings.ageGroup || '3-8';
            let filteredTrendingVideos = trendingVideos;
            
            if (ageGroup !== 'none') {
                filteredTrendingVideos = trendingVideos.filter(video => isAgeAppropriate(video, ageGroup));
            }
            
            // Display trending videos
            const safeSearchIndicator = safeSearchEnabled ? `
                <div class="safe-search-indicator">
                    <i class="fas fa-child"></i>
                    <span>YouTube Kids Content Search Active</span>
                </div>
            ` : '';
            
            const videosHTML = filteredTrendingVideos.map(video => `
                <div class="video-card" onclick="playVideo('${video.id}', '${video.title.replace(/'/g, "\\'")}', '${video.description.replace(/'/g, "\\'")}')">
                    <div class="video-thumbnail">
                        <img src="${video.thumbnail}" alt="${video.title}">
                    </div>
                    <div class="video-actions">
                        <button class="action-btn add-to-playlist-btn" onclick="event.stopPropagation(); showPlaylistMenu('${video.id}', '${video.title.replace(/'/g, "\\'")}', '${video.thumbnail}')" title="Add to Playlist">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="action-btn like-btn" onclick="event.stopPropagation(); toggleLike('${video.id}')" title="Like Video">
                            <i class="fas fa-heart"></i>
                        </button>
                    </div>
                    <div class="video-info">
                        <div class="video-title">${video.title}</div>
                        <div class="video-meta">
                            <span class="video-category">${video.category}</span>
                            ${video.channelTitle ? `<span class="video-channel">${video.channelTitle}</span>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
            
            videosContainer.innerHTML = safeSearchIndicator + videosHTML;
            console.log('Updated videosContainer with', trendingVideos.length, 'videos');
            
            // Update like button states
            setTimeout(() => updateAllLikeButtons(), 100);
            
            showSuccessMessage(`Updated with ${trendingVideos.length} trending videos! 🔥`);
        }
        
        // Check and update trending videos periodically
        function checkTrendingUpdate() {
            const now = new Date().getTime();
            const lastUpdate = localStorage.getItem('lastTrendingUpdate');
            
            if (!lastUpdate || (now - parseInt(lastUpdate)) > TRENDING_UPDATE_INTERVAL) {
                fetchTrendingVideos();
            }
        }
        
        // Set up periodic check for trending updates (every hour)
        setInterval(checkTrendingUpdate, 60 * 60 * 1000);
        
        // Manual refresh function for popular videos
        function refreshTrendingVideos() {
            showSuccessMessage('Refreshing popular videos... 🔄');
            loadPopularVideos();
        }
        
        // Test function to manually trigger trending videos display
        function testTrendingVideos() {
            console.log('Testing trending videos display...');
            showFallbackTrendingVideos();
        }
        
        // Make functions available globally for testing
        window.testTrendingVideos = testTrendingVideos;
        window.refreshTrendingVideos = refreshTrendingVideos;
        
        
        // Fetch videos from YouTube API
        async function fetchYouTubeVideos(query) {
            if (!apiKey) {
                showMessage('YouTube API not configured. Using offline library.', 'warning');
                return [];
            }
            
            try {
                // Show loading state
                showLoading(true);
                
                // Get age-appropriate search query
                const parentalSettings = JSON.parse(localStorage.getItem('parentalSettings') || '{}');
                const ageGroup = parentalSettings.ageGroup || '3-8';
                const ageBasedQuery = getAgeBasedSearchQuery(query, ageGroup);
                
                const url = `https://www.googleapis.com/youtube/v3/search?key=${apiKey}&q=${encodeURIComponent(ageBasedQuery)}&type=video&part=snippet&maxResults=20&safeSearch=strict&videoEmbeddable=true&videoDuration=short&videoCategoryId=27&order=relevance&channelType=any`;
                
                // Add timeout to prevent hanging
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 second timeout
                
                const response = await fetch(url, { 
                    signal: controller.signal,
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });
                
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    if (response.status === 403) {
                        throw new Error('YouTube API quota exceeded. Please try again later.');
                    } else if (response.status === 400) {
                        throw new Error('Invalid search request. Please try different keywords.');
                    } else if (response.status >= 500) {
                        throw new Error('YouTube service temporarily unavailable. Please try again later.');
                    } else {
                        throw new Error(`YouTube API error: ${response.status} ${response.statusText}`);
                    }
                }
                
                const data = await response.json();
                
                if (data.error) {
                    if (data.error.code === 403) {
                        throw new Error('YouTube API access denied. Please check your API key.');
                    } else if (data.error.code === 400) {
                        throw new Error('Invalid search parameters. Please try different keywords.');
                    } else {
                        throw new Error(`YouTube API error: ${data.error.message}`);
                    }
                }
                
                if (!data.items || data.items.length === 0) {
                    showMessage('No videos found for your search. Try different keywords.', 'warning');
                    return [];
                }
                
                const videoResults = data.items.map(item => ({
                    id: item.id.videoId,
                    title: item.snippet.title,
                    description: item.snippet.description,
                    category: 'Kids Educational',
                    thumbnail: item.snippet.thumbnails.medium.url,
                    duration: 'Unknown',
                    channelTitle: item.snippet.channelTitle
                }));
                
                // Apply additional client-side safety filtering
                const safeVideos = filterSafeContent(videoResults);
                
                console.log(`Safe search: ${safeVideos.length}/${videoResults.length} videos passed safety filters`);
                
                if (safeVideos.length === 0) {
                    showMessage('No safe videos found. Try different search terms.', 'warning');
                }
                
                return safeVideos;
                
            } catch (error) {
                console.error('YouTube API error:', error);
                
                if (error.name === 'AbortError') {
                    showMessage('Request timed out. Please check your internet connection.', 'error');
                } else if (error.message.includes('quota exceeded')) {
                    showMessage('Daily video limit reached. Please try again tomorrow.', 'error');
                } else if (error.message.includes('access denied')) {
                    showMessage('API access issue. Please contact support.', 'error');
                } else if (error.message.includes('network') || error.message.includes('fetch')) {
                    showMessage('Network error. Please check your internet connection.', 'error');
                } else {
                    showMessage(`Unable to load videos: ${error.message}`, 'error');
                }
                
                return [];
            } finally {
                showLoading(false);
            }
        }
        
        // Additional client-side safety filtering for kids
        function filterSafeContent(videos) {
            if (!safeSearchEnabled) return videos;
            
            const inappropriateKeywords = [
                // Violence and scary content
                'scary', 'horror', 'frightening', 'violent', 'fight', 'battle', 'war', 'death', 'kill',
                'monster', 'ghost', 'nightmare', 'terrifying', 'creepy', 'spooky', 'dark',
                // Inappropriate language
                'bad words', 'swear', 'curse', 'inappropriate', 'adult', 'mature', 'teen',
                // Dangerous activities
                'dangerous', 'risky', 'stunt', 'challenge', 'prank', 'scare', 'weapon', 'gun',
                // Inappropriate content
                'sexy', 'hot', 'adult content', 'inappropriate', 'explicit', 'dating', 'romance',
                // Negative behaviors
                'hate', 'bully', 'mean', 'rude', 'disrespectful', 'angry', 'mad', 'upset'
            ];
            
            return videos.filter(video => {
                const title = video.title.toLowerCase();
                const description = video.description.toLowerCase();
                const channelTitle = video.channelTitle.toLowerCase();
                
                // Check for inappropriate keywords
                const hasInappropriateContent = inappropriateKeywords.some(keyword => 
                    title.includes(keyword) || description.includes(keyword) || channelTitle.includes(keyword)
                );
                
                // Check for educational/child-friendly indicators
                const isEducational = [
                    'educational', 'learn', 'teach', 'kids', 'children', 'family', 'fun',
                    'cartoon', 'animation', 'story', 'song', 'music', 'dance', 'art',
                    'science', 'math', 'reading', 'writing', 'abc', '123', 'colors',
                    'shapes', 'animals', 'nature', 'cooking', 'craft', 'toy',
                    'nursery', 'rhyme', 'disney', 'pixar', 'cocomelon', 'blippi',
                    'peppa pig', 'little baby bum', 'super simple songs', 'pinkfong',
                    'kids tv', 'chuchu tv', 'hoopla kidz', 'sesame street', 'barney',
                    'preschool', 'kindergarten', 'toddler', 'baby', 'cute', 'play'
                ].some(keyword => 
                    title.includes(keyword) || description.includes(keyword) || channelTitle.includes(keyword)
                );
                
                // Allow if educational and not inappropriate
                return !hasInappropriateContent && (isEducational || title.length < 50); // Short titles are usually safer
            });
        }

        function setupEventListeners() {
            // Navigation tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                    // Add active class to clicked tab
                    this.classList.add('active');
                    
                    // Get category and filter videos
                    const category = this.getAttribute('data-category');
                    currentCategory = category;
                    loadVideos();
                });
            });

            // Search input - Enter key listener and real-time search
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                // Real-time search as you type
                searchInput.addEventListener('input', function() {
                    searchVideos();
                });
                
                // Enter key listener
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchVideos();
                    }
                });
            }
        }

        function loadVideos() {
            const videosContainer = document.getElementById('videosContainer');
            if (!videosContainer) {
                console.log('videosContainer not found, skipping video load');
                return;
            }
            
            let videosToShow = videoData;

            // Filter by category
            if (currentCategory !== 'all') {
                videosToShow = videoData.filter(video => video.category === currentCategory);
            }

            // Set the section title if it's not already set by trending videos
            const sectionTitle = document.querySelector('.popular-videos-section h3');
            if (sectionTitle && !sectionTitle.innerHTML.includes('🔥')) {
                sectionTitle.innerHTML = '🔥 Popular Videos <button onclick="loadPopularVideos()" style="background: none; border: none; color: #a8b5d1; cursor: pointer; font-size: 0.8rem; margin-left: 10px;" title="Refresh popular videos"><i class="fas fa-sync-alt"></i></button>';
            }

            // Display videos
            videosContainer.innerHTML = videosToShow.map(video => `
                <div class="video-card" onclick="playVideo('${video.id}', '${video.title.replace(/'/g, "\\'")}', '${video.description.replace(/'/g, "\\'")}')">
                    <div class="video-thumbnail">
                        <img src="${video.thumbnail}" alt="${video.title}" onerror="this.style.display='none'">
                        <i class="fas fa-play-circle play-icon"></i>
                    </div>
                    <div class="video-actions">
                        <button class="action-btn add-to-playlist-btn" onclick="event.stopPropagation(); showPlaylistMenu('${video.id}', '${video.title.replace(/'/g, "\\'")}', '${video.thumbnail}')" title="Add to Playlist">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="action-btn like-btn" onclick="event.stopPropagation(); toggleLike('${video.id}')" title="Like Video">
                            <i class="fas fa-heart"></i>
                        </button>
                    </div>
                    <div class="video-info">
                        <h4>${video.title}</h4>
                        <p>${video.description}</p>
                        <span class="video-category">${video.category}</span>
                    </div>
                </div>
            `).join('');
            
            // Update like button states
            setTimeout(() => updateAllLikeButtons(), 100);
        }

        function playVideo(videoId, title, description) {
            try {
            console.log('Playing video:', title);
                
                
                // Validate inputs
                if (!videoId) {
                    throw new Error('Video ID is required');
                }
                
                if (!title) {
                    throw new Error('Video title is required');
                }
            
            const videoPlayer = document.getElementById('videoPlayer');
            const titleElement = document.getElementById('videoTitle');
            const descElement = document.getElementById('videoDescription');
            
                if (!videoPlayer) {
                    throw new Error('Video player element not found');
                }
                
                if (!titleElement) {
                    throw new Error('Video title element not found');
                }
                
                if (!descElement) {
                    throw new Error('Video description element not found');
                }
            
            // Update video player with YouTube API
            videoPlayer.innerHTML = `
                <div class="video-overlay" id="videoOverlay">
                    <div class="overlay-info">
                        <h3 id="overlayTitle">${title}</h3>
                        <p id="overlayDescription">${description}</p>
                    </div>
                    <div class="overlay-controls">
                        <button class="overlay-play-btn" id="overlayPlayBtn">
                            <i class="fas fa-play"></i>
                        </button>
                        <div class="overlay-progress">
                            <div class="overlay-progress-bar" id="overlayProgressBar">
                                <div class="overlay-progress-fill" id="overlayProgressFill"></div>
                            </div>
                        </div>
                        <div class="overlay-time">
                            <span id="overlayCurrentTime">0:00</span>
                            <span id="overlayDuration">0:00</span>
                        </div>
                        <div class="overlay-volume">
                            <button class="overlay-volume-btn" id="overlayVolumeBtn">
                                <i class="fas fa-volume-up"></i>
                            </button>
                            <div class="overlay-volume-slider" id="overlayVolumeSlider">
                                <div class="overlay-volume-fill" id="overlayVolumeFill"></div>
                            </div>
                        </div>
                        <button class="overlay-fullscreen-btn" id="overlayFullscreenBtn">
                            <i class="fas fa-expand"></i>
                        </button>
                        <button class="overlay-toggle-btn" id="overlayToggleBtn">
                            <i class="fas fa-eye-slash"></i>
                        </button>
                    </div>
                </div>
                <div id="youtubePlayer"></div>
            `;
            
            // Add playing class to enable overlay controls
            videoPlayer.classList.add('playing');
            
            // Create YouTube player
            createYouTubePlayer(videoId);
            
            // Re-setup overlay controls for the new elements
            setupVideoOverlay();
            
            // Update video info
            if (titleElement) titleElement.textContent = title;
            if (descElement) descElement.textContent = description;
            
            // Start break timer
            startBreakTimer();
            
            // NO SCROLLING - just show success message
            showSuccessMessage(`Now playing: ${title}! 🎉`);

            // Re-apply base filter to new iframe
            applyBaseVideoFilter();
            
            } catch (error) {
                console.error('Error playing video:', error);
                handleError(error, 'playVideo');
                showMessage('Unable to play video. Please try again.', 'error');
            }
        }

        async function searchVideos() {
            const searchInput = document.getElementById('searchInput');
            if (!searchInput) {
                handleError(new Error('Search input not found'), 'searchVideos');
                return;
            }
            
            const searchTerm = searchInput.value.toLowerCase().trim();
            console.log('Searching for:', searchTerm);

            if (!searchTerm) {
                showMessage('Please enter a search term', 'warning', 3000);
                loadVideos();
                return;
            }

            // Validate search term
            if (searchTerm.length < 2) {
                showMessage('Search term must be at least 2 characters', 'warning', 3000);
                return;
            }
            
            if (searchTerm.length > 100) {
                showMessage('Search term is too long. Please use fewer characters.', 'warning', 3000);
                return;
            }

            // Show loading spinner
            showLoading(true);
            showMessage('Searching for videos...', 'loading', 0);
            
            try {
                let searchResults = [];
                
                if (isYouTubeEnabled && apiKey) {
                    // Use YouTube API search
                    console.log('Searching YouTube for:', searchTerm);
                    searchResults = await fetchYouTubeVideos(searchTerm);
                    console.log('YouTube search results:', searchResults.length);
                    
                    // Always fetch trending kids videos for recommendations
                    try {
                        await fetchTrendingKidsVideos();
                    } catch (trendingError) {
                        console.warn('Failed to fetch trending videos:', trendingError);
                        // Don't show error for trending videos as it's not critical
                    }
                } else {
                    // Fallback to local search
                    console.log('Using local search for:', searchTerm);
                    searchResults = videoData.filter(video => {
                const title = video.title.toLowerCase();
                const description = video.description.toLowerCase();
                const category = video.category.toLowerCase();
                
                // Direct matches
                if (title.includes(searchTerm) || description.includes(searchTerm) || category.includes(searchTerm)) {
                    return true;
                }
                
                // Partial word matches
                const searchWords = searchTerm.split(' ');
                return searchWords.some(word => 
                    title.includes(word) || description.includes(word) || category.includes(word)
                );
            });
                }
                
                // Apply age-based filtering
                const parentalSettings = JSON.parse(localStorage.getItem('parentalSettings') || '{}');
                const ageGroup = parentalSettings.ageGroup || '3-8';
                
                if (ageGroup !== 'none') {
                    searchResults = searchResults.filter(video => isAgeAppropriate(video, ageGroup));
                }
                
                // Remove loading message
                const loadingMessages = document.querySelectorAll('.message-loading');
                loadingMessages.forEach(msg => msg.remove());
                
                displaySearchResults(searchResults, searchTerm);
                
            } catch (error) {
                console.error('Search error:', error);
                handleError(error, 'searchVideos');
                
                // Fallback to local search
                try {
                    const localResults = videoData.filter(video => {
                        const title = video.title.toLowerCase();
                        const description = video.description.toLowerCase();
                        const category = video.category.toLowerCase();
                        
                        return title.includes(searchTerm) || description.includes(searchTerm) || category.includes(searchTerm);
                    });
                    
                    showMessage('Using offline video library', 'info', 3000);
                    displaySearchResults(localResults, searchTerm);
                } catch (fallbackError) {
                    console.error('Fallback search error:', fallbackError);
                    showMessage('Unable to search videos. Please try again later.', 'error');
                }
            } finally {
                showLoading(false);
            }
        }
        
        function displaySearchResults(results, searchTerm) {
            const videosContainer = document.getElementById('videosContainer');
            
            if (results.length === 0) {
                // Show helpful message when no results found
                videosContainer.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: var(--text-light);">
                        <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 1rem; color: var(--primary-pink);"></i>
                        <h3>No videos found for "${searchTerm}"</h3>
                        <p>Try searching for:</p>
                        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; justify-content: center; margin-top: 1rem;">
                            <span style="background: var(--primary-green); color: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.9rem;">cartoons</span>
                            <span style="background: var(--primary-blue); color: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.9rem;">music</span>
                            <span style="background: var(--primary-yellow); color: var(--text-dark); padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.9rem;">education</span>
                            <span style="background: var(--primary-orange); color: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.9rem;">games</span>
                        </div>
                        <p style="margin-top: 1rem; font-size: 0.9rem;">Or try: "baby", "dinosaur", "abc", "counting", "colors"</p>
                    </div>
                `;
                showSuccessMessage(`No videos found for "${searchTerm}". Try different keywords!`);
            } else {
                // Add safe search indicator
                const safeSearchIndicator = safeSearchEnabled ? `
                    <div class="safe-search-indicator">
                        <i class="fas fa-child"></i>
                        <span>YouTube Kids Content Search Active</span>
                    </div>
                ` : '';
                
                videosContainer.innerHTML = safeSearchIndicator + results.map(video => `
                    <div class="video-card" onclick="playVideo('${video.id}', '${video.title.replace(/'/g, "\\'")}', '${video.description.replace(/'/g, "\\'")}')">
                        <div class="video-thumbnail">
                            <img src="${video.thumbnail}" alt="${video.title}" onerror="this.style.display='none'">
                            <i class="fas fa-play-circle play-icon"></i>
                        </div>
                        <div class="video-actions">
                            <button class="action-btn add-to-playlist-btn" onclick="event.stopPropagation(); showPlaylistMenu('${video.id}', '${video.title.replace(/'/g, "\\'")}', '${video.thumbnail}')" title="Add to Playlist">
                                <i class="fas fa-plus"></i>
                            </button>
                            <button class="action-btn like-btn" onclick="event.stopPropagation(); toggleLike('${video.id}')" title="Like Video">
                                <i class="fas fa-heart"></i>
                            </button>
                        </div>
                        <div class="video-info">
                            <h4>${video.title}</h4>
                            <p>${video.description}</p>
                            <span class="video-category">${video.category}</span>
                            ${video.channelTitle ? `<span class="video-channel">${video.channelTitle}</span>` : ''}
                        </div>
                    </div>
                `).join('');
                
                // Update like button states
                setTimeout(() => updateAllLikeButtons(), 100);
                
                showSuccessMessage(`Found ${results.length} kid-friendly video${results.length === 1 ? '' : 's'}! 🧒🎉`);
            }
        }

        function showLoading(show) {
            const spinner = document.getElementById('loadingSpinner');
            if (spinner) {
                spinner.style.display = show ? 'flex' : 'none';
            }
        }

        function showSuccessMessage(message) {
            // Remove existing messages
            const existingMessage = document.querySelector('.success-message');
            if (existingMessage) {
                existingMessage.remove();
            }

            // Create new message
            const messageDiv = document.createElement('div');
            messageDiv.className = 'success-message';
            messageDiv.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
            messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #4CAF50;
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 10px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.2);
                z-index: 1000;
                font-weight: bold;
                animation: slideIn 0.3s ease;
            `;

            // Add animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);

            document.body.appendChild(messageDiv);

            // Remove after 3 seconds
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 3000);
        }

        // Enhanced Screen Time Control functions
        function setupTonedownFeature() {
            const toggleBtn = document.getElementById('tonedownToggle');
            const resetBtn = document.getElementById('resetBtn');
            const durationSelect = document.getElementById('durationSelect');
            const breakReminderSelect = document.getElementById('breakReminder');
            const quickTimerBtn = document.getElementById('quickTimerBtn');
            const statsBtn = document.getElementById('statsBtn');
            const parentalBtn = document.getElementById('parentalBtn');
            const passwordSubmit = document.getElementById('passwordSubmit');
            const parentalPasswordInput = document.getElementById('parentalPassword');
            const lockSettings = document.getElementById('lockSettings');

            // Basic controls
            if (toggleBtn) toggleBtn.addEventListener('click', toggleTonedown);
            if (resetBtn) resetBtn.addEventListener('click', resetTonedown);
            if (quickTimerBtn) quickTimerBtn.addEventListener('click', startQuickTimer);
            if (statsBtn) statsBtn.addEventListener('click', toggleStatsPanel);
            if (parentalBtn) parentalBtn.addEventListener('click', toggleParentalPanel);
            
            // Password protection
            if (passwordSubmit) passwordSubmit.addEventListener('click', checkParentalPassword);
            if (parentalPasswordInput) {
                parentalPasswordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        checkParentalPassword();
                    }
                });
            }
            if (lockSettings) lockSettings.addEventListener('click', lockParentalSettings);

            // Settings
            if (durationSelect) {
                durationSelect.addEventListener('change', function() {
                    tonedownDuration = parseInt(this.value);
                    updateTimeDisplay();
                });
            }

            if (breakReminderSelect) {
                breakReminderSelect.addEventListener('change', function() {
                    breakReminderDuration = parseInt(this.value);
                    setupBreakReminders();
                });
            }

            // Parental controls
            setupParentalControls();
            loadSettings();
            updateStatistics();
        }

        function startQuickTimer() {
            tonedownDuration = 300000; // 5 minutes
            document.getElementById('durationSelect').value = '300000';
            if (!tonedownActive) {
                toggleTonedown();
            }
            showSuccessMessage('Quick 5-minute timer started! ⚡');
        }

        function toggleStatsPanel() {
            const statsPanel = document.getElementById('statsPanel');
            const parentalPanel = document.getElementById('parentalPanel');
            
            if (statsPanel.style.display === 'none') {
                statsPanel.style.display = 'block';
                parentalPanel.style.display = 'none';
                updateStatistics();
            } else {
                statsPanel.style.display = 'none';
            }
        }

        function toggleParentalPanel() {
            const parentalPanel = document.getElementById('parentalPanel');
            const statsPanel = document.getElementById('statsPanel');
            
            if (parentalPanel.style.display === 'none') {
                parentalPanel.style.display = 'block';
                statsPanel.style.display = 'none';
                
                // Reset password section if not already accessed
                if (!parentalAccess) {
                    showPasswordSection();
                }
            } else {
                parentalPanel.style.display = 'none';
            }
        }

        function checkParentalPassword() {
            const passwordInput = document.getElementById('parentalPassword');
            const enteredPassword = passwordInput.value.trim();
            
            if (enteredPassword === parentalPassword) {
                parentalAccess = true;
                showParentalSettings();
                passwordInput.value = '';
                showSuccessMessage('Parental access granted! 🔓');
            } else {
                showSuccessMessage('Incorrect password. Try again. ❌');
                passwordInput.value = '';
                passwordInput.focus();
            }
        }

        function showPasswordSection() {
            const passwordSection = document.getElementById('passwordSection');
            const parentalSettings = document.getElementById('parentalSettings');
            
            if (passwordSection) passwordSection.style.display = 'block';
            if (parentalSettings) parentalSettings.style.display = 'none';
        }

        function showParentalSettings() {
            const passwordSection = document.getElementById('passwordSection');
            const parentalSettings = document.getElementById('parentalSettings');
            
            if (passwordSection) passwordSection.style.display = 'none';
            if (parentalSettings) parentalSettings.style.display = 'block';
        }

        function lockParentalSettings() {
            parentalAccess = false;
            showPasswordSection();
            showSuccessMessage('Parental settings locked! 🔒');
        }

        function setupParentalControls() {
            const dailyLimitCheckbox = document.getElementById('dailyLimitEnabled');
            const dailyLimitInput = document.getElementById('dailyLimitHours');
            const bedtimeCheckbox = document.getElementById('bedtimeMode');
            const weekendCheckbox = document.getElementById('weekendMode');
            const breakReminderCheckbox = document.getElementById('breakReminderEnabled');
            const targetModeSelect = document.getElementById('targetModeSelect');

            if (dailyLimitCheckbox) {
                dailyLimitCheckbox.addEventListener('change', function() {
                    parentalSettings.dailyLimitEnabled = this.checked;
                    dailyLimitInput.disabled = !this.checked;
                    saveSettings();
                });
            }

            if (dailyLimitInput) {
                dailyLimitInput.addEventListener('change', function() {
                    parentalSettings.dailyLimitHours = parseFloat(this.value);
                    saveSettings();
                });
            }

            if (bedtimeCheckbox) {
                bedtimeCheckbox.addEventListener('change', function() {
                    parentalSettings.bedtimeMode = this.checked;
                    saveSettings();
                    checkBedtimeMode();
                });
            }

            if (weekendCheckbox) {
                weekendCheckbox.addEventListener('change', function() {
                    parentalSettings.weekendMode = this.checked;
                    saveSettings();
                });
            }

            if (breakReminderCheckbox) {
                breakReminderCheckbox.addEventListener('change', function() {
                    parentalSettings.breakReminderEnabled = this.checked;
                    saveSettings();
                    setupBreakReminders();
                });
            }

            // Hide parental button option
            const hideParentalCheckbox = document.getElementById('hideParentalBtn');
            if (hideParentalCheckbox) {
                hideParentalCheckbox.addEventListener('change', function() {
                    parentalSettings.hideParentalBtn = this.checked;
                    saveSettings();
                    updateParentalButtonVisibility();
                });
            }

            if (targetModeSelect) {
                targetModeSelect.addEventListener('change', function() {
                    parentalSettings.targetMode = this.value;
                    saveSettings();
                    applyBaseVideoFilter();
                });
            }
        }

        function setupBreakReminders() {
            if (breakReminderInterval) {
                clearInterval(breakReminderInterval);
                breakReminderInterval = null;
            }

            if (breakReminderDuration > 0 && parentalSettings.breakReminderEnabled) {
                breakReminderInterval = setInterval(() => {
                    if (tonedownActive) {
                        showBreakReminder();
                    }
                }, breakReminderDuration);
            }
        }

        function showBreakReminder() {
            const now = Date.now();
            if (now - lastBreakTime > breakReminderDuration) {
                showSuccessMessage('Time for a break! Look away from the screen for 20 seconds! 👀');
                lastBreakTime = now;
            }
        }

        function checkBedtimeMode() {
            if (!parentalSettings.bedtimeMode) return;
            
            const now = new Date();
            const hour = now.getHours();
            
            if (hour >= 21 || hour < 7) { // 9 PM to 7 AM
                showSuccessMessage('It\'s bedtime! Screen time is limited. 🌙');
                if (tonedownActive) {
                    completeTonedown();
                }
            }
        }

        function updateStatistics() {
            const todayTime = document.getElementById('todayTime');
            const weekTime = document.getElementById('weekTime');
            const sessionCountEl = document.getElementById('sessionCount');
            const avgSession = document.getElementById('avgSession');

            if (todayTime) todayTime.textContent = formatTime(dailyUsage);
            if (weekTime) weekTime.textContent = formatTime(weeklyUsage);
            if (sessionCountEl) sessionCountEl.textContent = sessionCount;
            if (avgSession) {
                const avg = sessionCount > 0 ? totalSessionTime / sessionCount : 0;
                avgSession.textContent = formatTime(avg);
            }
        }

        function saveSettings() {
            localStorage.setItem('parentalSettings', JSON.stringify(parentalSettings));
            localStorage.setItem('usageStats', JSON.stringify({
                dailyUsage,
                weeklyUsage,
                sessionCount,
                totalSessionTime
            }));
        }

        function loadSettings() {
            const savedSettings = localStorage.getItem('parentalSettings');
            if (savedSettings) {
                parentalSettings = { ...parentalSettings, ...JSON.parse(savedSettings) };
            }

            const savedStats = localStorage.getItem('usageStats');
            if (savedStats) {
                const stats = JSON.parse(savedStats);
                dailyUsage = stats.dailyUsage || 0;
                weeklyUsage = stats.weeklyUsage || 0;
                sessionCount = stats.sessionCount || 0;
                totalSessionTime = stats.totalSessionTime || 0;
            }

            // Update UI
            document.getElementById('dailyLimitEnabled').checked = parentalSettings.dailyLimitEnabled;
            document.getElementById('dailyLimitHours').value = parentalSettings.dailyLimitHours;
            document.getElementById('dailyLimitHours').disabled = !parentalSettings.dailyLimitEnabled;
            document.getElementById('bedtimeMode').checked = parentalSettings.bedtimeMode;
            document.getElementById('weekendMode').checked = parentalSettings.weekendMode;
            document.getElementById('breakReminderEnabled').checked = parentalSettings.breakReminderEnabled;
            document.getElementById('hideParentalBtn').checked = parentalSettings.hideParentalBtn;
            const targetModeSelect = document.getElementById('targetModeSelect');
            if (targetModeSelect) targetModeSelect.value = parentalSettings.targetMode || 'none';
            
            // Update parental button visibility
            updateParentalButtonVisibility();

            // Apply base filter on load
            applyBaseVideoFilter();
            
            // Update sidebar active state
            updateActiveFilterOption();
        }

        function toggleTonedown() {
            const toggleBtn = document.getElementById('tonedownToggle');
            const progressFill = document.getElementById('progressFill');
            
            if (!tonedownActive) {
                // Start tone-down
                tonedownActive = true;
                tonedownStartTime = Date.now();
                
                toggleBtn.innerHTML = '<i class="fas fa-pause"></i> Pause Timer';
                toggleBtn.classList.add('active');
                
                // Start timer
                tonedownTimer = setInterval(updateTonedownProgress, 1000);
                
                // Setup break reminders
                setupBreakReminders();
                
                showSuccessMessage('Screen time timer started! Video will gradually dim! 🌙');
            } else {
                // Pause tone-down
                tonedownActive = false;
                
                toggleBtn.innerHTML = '<i class="fas fa-play"></i> Resume Timer';
                toggleBtn.classList.remove('active');
                
                // Reset video tonedown effect
                resetVideoTonedown();
                
                // Stop timer
                if (tonedownTimer) {
                    clearInterval(tonedownTimer);
                    tonedownTimer = null;
                }
                
                // Stop break reminders
                if (breakReminderInterval) {
                    clearInterval(breakReminderInterval);
                    breakReminderInterval = null;
                }
                
                showSuccessMessage('Timer paused! Video colors restored! ⏸️');
            }
        }

        function updateTonedownProgress() {
            if (!tonedownActive || !tonedownStartTime) return;
            
            const elapsed = Date.now() - tonedownStartTime;
            const remaining = Math.max(0, tonedownDuration - elapsed);
            const progress = Math.min(100, (elapsed / tonedownDuration) * 100);
            
            // Update progress bar
            const progressFill = document.getElementById('progressFill');
            if (progressFill) {
                progressFill.style.width = progress + '%';
            }
            
            // Update time display
            updateTimeDisplay();
            
            // Apply gradual filter changes based on timer progress and target mode
            const progressRatio = progress / 100; // Convert to 0-1 range
            applyVideoTonedown(progressRatio);
            
            // Update timer status with current filter intensity
            updateTimerStatusWithFilter(progressRatio);
            
            // Check if time is up
            if (remaining <= 0) {
                completeTonedown();
            }
        }
        
        // Update timer status with current filter intensity
        function updateTimerStatusWithFilter(progress) {
            const timerStatus = document.getElementById('timerStatus');
            if (!timerStatus) return;
            
            const targetMode = parentalSettings.targetMode;
            let statusText = '';
            
            if (progress < 0.2) {
                statusText = 'Filter intensity: Light';
            } else if (progress < 0.5) {
                statusText = 'Filter intensity: Medium';
            } else if (progress < 0.8) {
                statusText = 'Filter intensity: Strong';
            } else {
                statusText = 'Filter intensity: Maximum';
            }
            
            // Add mode-specific information
            switch(targetMode) {
                case 'reduce_addiction':
                    statusText += ' - Reducing screen addiction';
                    break;
                case 'sleep_warm':
                    statusText += ' - Promoting sleep';
                    break;
                case 'calm_cool':
                    statusText += ' - Calming effect active';
                    break;
                case 'focus_monotone':
                    statusText += ' - Focus mode active';
                    break;
                case 'memory_balanced':
                    statusText += ' - Memory enhancement active';
                    break;
                case 'creativity_soft':
                    statusText += ' - Creativity mode active';
                    break;
                case 'anxiety_green':
                    statusText += ' - Anxiety reduction active';
                    break;
            }
            
            timerStatus.textContent = statusText;
        }
        
        function applyVideoTonedown(progress) {
            const videoPlayer = document.getElementById('videoPlayer');
            const videoIframe = videoPlayer.querySelector('iframe');
            
            if (!videoPlayer) return;
            
            // Calculate gradual effects based on progress with research-based psychology
            const gradualFilter = calculateGradualFilter(progress);
            
            // Apply gradual filter with smooth transition
            applyFilterWithTransition(videoPlayer, videoIframe, gradualFilter);
        }
        
        // Calculate gradual filter based on timer progress and target mode
        function calculateGradualFilter(progress) {
            const baseFilter = computeBaseFilter();
            const targetMode = parentalSettings.targetMode;
            
            // Calculate gradual progression based on target mode and research
            let gradualSaturation, gradualBrightness, gradualContrast, gradualHue;
            
            switch(targetMode) {
                case 'reduce_addiction':
                    // Gradually reduce saturation and brightness to minimize dopamine
                    gradualSaturation = 1.0 - (progress * 0.05); // 1.0 to 0.95
                    gradualBrightness = 1.0 - (progress * 0.02); // 1.0 to 0.98
                    gradualContrast = 1.0 - (progress * 0.03); // 1.0 to 0.97
                    gradualHue = 0; // No hue change
                    break;
                    
                case 'sleep_warm':
                    // Gradually increase warm tones and reduce blue light
                    gradualSaturation = 0.98 + (progress * 0.02); // 0.98 to 1.0
                    gradualBrightness = 0.99 + (progress * 0.01); // 0.99 to 1.0
                    gradualContrast = 0.98 + (progress * 0.01); // 0.98 to 0.99
                    gradualHue = 3 + (progress * 2); // 3deg to 5deg (slightly warmer)
                    break;
                    
                case 'calm_cool':
                    // Gradually increase cool tones for calming effect
                    gradualSaturation = 0.96 + (progress * 0.02); // 0.96 to 0.98
                    gradualBrightness = 0.99 - (progress * 0.01); // 0.99 to 0.98
                    gradualContrast = 0.98 + (progress * 0.01); // 0.98 to 0.99
                    gradualHue = 5 + (progress * 3); // 5deg to 8deg (slightly cooler)
                    break;
                    
                case 'focus_monotone':
                    // Gradually increase grayscale for better focus
                    gradualSaturation = 0.92 + (progress * 0.05); // 0.92 to 0.97
                    gradualBrightness = 0.99 + (progress * 0.005); // 0.99 to 0.995
                    gradualContrast = 1.02 - (progress * 0.01); // 1.02 to 1.01
                    gradualHue = 0; // No hue change
                    break;
                    
                case 'memory_balanced':
                    // Gradually enhance memory-friendly colors
                    gradualSaturation = 1.01 + (progress * 0.01); // 1.01 to 1.02
                    gradualBrightness = 1.005 + (progress * 0.005); // 1.005 to 1.01
                    gradualContrast = 1.01 + (progress * 0.01); // 1.01 to 1.02
                    gradualHue = 2 + (progress * 1); // 2deg to 3deg (slightly warmer)
                    break;
                    
                case 'creativity_soft':
                    // Gradually enhance creative colors without overstimulation
                    gradualSaturation = 1.02 + (progress * 0.01); // 1.02 to 1.03
                    gradualBrightness = 1.01 + (progress * 0.005); // 1.01 to 1.015
                    gradualContrast = 0.99 + (progress * 0.005); // 0.99 to 0.995
                    gradualHue = 6 + (progress * 2); // 6deg to 8deg (slightly more vibrant)
                    break;
                    
                case 'anxiety_green':
                    // Gradually increase calming green tones
                    gradualSaturation = 0.96 + (progress * 0.02); // 0.96 to 0.98
                    gradualBrightness = 0.99 + (progress * 0.005); // 0.99 to 0.995
                    gradualContrast = 0.98 + (progress * 0.01); // 0.98 to 0.99
                    gradualHue = 8 + (progress * 2); // 8deg to 10deg (slightly greener)
                    break;
                    
                default:
                    // Default gradual tonedown
                    gradualSaturation = 1.0 - (progress * 0.03);
                    gradualBrightness = 1.0 - (progress * 0.02);
                    gradualContrast = 1.0 - (progress * 0.03);
                    gradualHue = 0;
            }
            
            // Build the gradual filter string
            let filterString = baseFilter;
            if (gradualHue > 0) {
                filterString += ` hue-rotate(${gradualHue}deg)`;
            }
            filterString += ` saturate(${gradualSaturation}) brightness(${gradualBrightness}) contrast(${gradualContrast})`;
            
            return filterString.trim();
        }
        
        // Apply filter with smooth CSS transition
        function applyFilterWithTransition(videoPlayer, videoIframe, filterValue) {
            // Add transition class for smooth animation
            videoPlayer.classList.add('filter-transitioning');
            
            // Apply the filter
            videoPlayer.style.filter = filterValue;
            
            if (videoIframe) {
                videoIframe.style.filter = filterValue;
            }
            
            // Handle fullscreen mode
            const fullscreenElement = document.fullscreenElement || 
                                    document.webkitFullscreenElement || 
                                    document.mozFullScreenElement || 
                                    document.msFullscreenElement;
            
            if (fullscreenElement === videoPlayer) {
                videoPlayer.style.filter = filterValue;
                if (videoIframe) {
                    videoIframe.style.filter = filterValue;
                }
            }
            
            // Remove transition class after animation completes
            setTimeout(() => {
                videoPlayer.classList.remove('filter-transitioning');
            }, 500);
        }

        // Compute the base filter from parentalSettings.targetMode
        function computeBaseFilter() {
            switch (parentalSettings.targetMode) {
                case 'reduce_addiction':
                    // Research: Desaturated colors reduce dopamine spikes and screen addiction
                    return 'saturate(0.95) contrast(0.98) brightness(0.99) hue-rotate(0deg)';
                case 'sleep_warm':
                    // Research: Warm amber tones block blue light, promote melatonin production
                    return 'sepia(0.05) hue-rotate(3deg) saturate(0.98) brightness(0.99)';
                case 'calm_cool':
                    // Research: Cool blues and greens calm the nervous system, reduce hyperactivity
                    return 'hue-rotate(5deg) saturate(0.96) brightness(0.99) contrast(0.98)';
                case 'focus_monotone':
                    // Research: Monochrome reduces visual distraction, improves focus
                    return 'grayscale(0.08) contrast(1.02) brightness(0.99) saturate(0.92)';
                case 'memory_balanced':
                    // Research: Slight yellow tint and balanced contrast improve memory retention
                    return 'saturate(1.01) hue-rotate(2deg) contrast(1.01) brightness(1.005)';
                case 'creativity_soft':
                    // Research: Soft pastels inspire creativity without overstimulation
                    return 'saturate(1.02) hue-rotate(6deg) brightness(1.01) contrast(0.99)';
                case 'anxiety_green':
                    // Research: Green tones promote calm and emotional balance
                    return 'hue-rotate(8deg) saturate(0.96) brightness(0.99) contrast(0.98)';
                case 'none':
                default:
                    return '';
            }
        }

        // Apply only the base filter (used on load, video change, or mode change)
        function applyBaseVideoFilter() {
            const videoPlayer = document.getElementById('videoPlayer');
            if (!videoPlayer) return;
            const videoIframe = videoPlayer.querySelector('iframe');
            const base = computeBaseFilter();
            videoPlayer.style.filter = base.trim();
            if (videoIframe) videoIframe.style.filter = base.trim();
        }
        
        // Sidebar functionality
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.toggle('open');
            overlay.classList.toggle('show');
            
            // Load sidebar content when opening
            if (sidebar.classList.contains('open')) {
                loadPlaylists();
                loadLikedVideos();
            }
            
            // Update active filter option
            updateActiveFilterOption();
            
            // Update timer status
            updateTimerStatus();
        }
        
        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.remove('open');
            overlay.classList.remove('show');
            
            // Close all dropdowns when sidebar closes
            closeAllDropdowns();
        }
        
        // Select filter option
        function selectFilter(filterMode) {
            parentalSettings.targetMode = filterMode;
            saveSettings();
            applyBaseVideoFilter();
            updateActiveFilterOption();
            showSuccessMessage(`Filter changed to: ${getFilterDisplayName(filterMode)}`);
        }
        
        // Update active filter option visual state
        function updateActiveFilterOption() {
            const filterOptions = document.querySelectorAll('.filter-option');
            filterOptions.forEach(option => {
                const filterMode = option.getAttribute('data-filter');
                if (filterMode === parentalSettings.targetMode) {
                    option.classList.add('active');
                } else {
                    option.classList.remove('active');
                }
            });
        }
        
        // Get display name for filter mode
        function getFilterDisplayName(filterMode) {
            const names = {
                'none': 'No Filter',
                'reduce_addiction': 'Reduce Screen Addiction',
                'sleep_warm': 'Help with Sleep',
                'calm_cool': 'Calm Hyperactive Kids',
                'focus_monotone': 'Improve Focus',
                'memory_balanced': 'Enhance Memory',
                'creativity_soft': 'Stimulate Creativity',
                'anxiety_green': 'Reduce Anxiety'
            };
            return names[filterMode] || 'Unknown Filter';
        }
        
        function closeAllDropdowns() {
            // Close Video Filters dropdown
            const filterDropdown = document.getElementById('filterDropdown');
            const filterArrow = document.getElementById('dropdownArrow');
            if (filterDropdown && filterArrow) {
                filterDropdown.classList.remove('open');
                filterArrow.classList.remove('rotated');
            }
            
            // Close Screen Time dropdown
            const screenTimeDropdown = document.getElementById('screenTimeDropdown');
            const screenTimeArrow = document.getElementById('screenTimeArrow');
            if (screenTimeDropdown && screenTimeArrow) {
                screenTimeDropdown.classList.remove('open');
                screenTimeArrow.classList.remove('rotated');
            }
            
            // Close Parental Controls dropdown
            const parentalDropdown = document.getElementById('parentalDropdown');
            const parentalArrow = document.getElementById('parentalArrow');
            if (parentalDropdown && parentalArrow) {
                parentalDropdown.classList.remove('open');
                parentalArrow.classList.remove('rotated');
            }
        }
        
        function selectFilter(filterMode) {
            parentalSettings.targetMode = filterMode;
            saveSettings();
            applyBaseVideoFilter();
            updateActiveFilterOption();
            showSuccessMessage(`Filter applied: ${getFilterDisplayName(filterMode)}! 🎨`);
        }
        
        function updateActiveFilterOption() {
            // Remove active class from all options
            document.querySelectorAll('.filter-option').forEach(option => {
                option.classList.remove('active');
            });
            
            // Add active class to current selection
            const currentMode = parentalSettings.targetMode || 'none';
            const activeOption = document.querySelector(`[onclick="selectFilter('${currentMode}')"]`);
            if (activeOption) {
                activeOption.classList.add('active');
            }
        }
        
        function getFilterDisplayName(filterMode) {
            const names = {
                'none': 'No Filter',
                'reduce_addiction': 'Reduce Screen Addiction',
                'sleep_warm': 'Help with Sleep',
                'calm_cool': 'Calm Overstimulation',
                'focus_monotone': 'Improve Focus',
                'memory_balanced': 'Enhance Memory',
                'creativity_soft': 'Stimulate Creativity',
                'anxiety_green': 'Reduce Anxiety'
            };
            return names[filterMode] || 'Unknown';
        }
        
        // Playlist Management System
        let playlists = JSON.parse(localStorage.getItem('kidsTubePlaylists') || '[]');
        let likedVideos = JSON.parse(localStorage.getItem('kidsTubeLikedVideos') || '[]');
        let currentPlaylist = null; // Current playing playlist state
        
        function togglePlaylistDropdown() {
            const playlistDropdown = document.getElementById('playlistDropdown');
            const playlistArrow = document.getElementById('playlistArrow');
            
            if (playlistDropdown && playlistArrow) {
                playlistDropdown.classList.toggle('open');
                playlistArrow.classList.toggle('rotated');
                loadPlaylists();
            }
        }
        
        function loadPlaylists() {
            const playlistList = document.getElementById('playlistList');
            if (!playlistList) return;
            
            if (playlists.length === 0) {
                playlistList.innerHTML = '<div class="no-playlists">No playlists yet. Create one!</div>';
                return;
            }
            
            playlistList.innerHTML = playlists.map((playlist, index) => `
                <div class="playlist-item" onclick="viewPlaylist(${index})">
                    <div class="playlist-info">
                        <h6>${playlist.name}</h6>
                        <p>${playlist.videos.length} videos</p>
                    </div>
                    <div class="playlist-actions">
                        <button class="playlist-btn edit-btn" onclick="event.stopPropagation(); editPlaylist(${index})" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="playlist-btn delete-btn" onclick="event.stopPropagation(); deletePlaylist(${index})" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function loadLikedVideos() {
            const likedVideosList = document.getElementById('likedVideosList');
            if (!likedVideosList) return;
            
            if (likedVideos.length === 0) {
                likedVideosList.innerHTML = '<div class="no-liked-videos">No liked videos yet. Like some videos! ❤️</div>';
            } else {
                likedVideosList.innerHTML = likedVideos.map(video => `
                    <div class="liked-video-item" onclick="playVideo('${video.id}', '${video.title.replace(/'/g, "\\'")}', '${video.description.replace(/'/g, "\\'")}')">
                        <img src="${video.thumbnail}" alt="${video.title}" onerror="this.style.display='none'">
                        <div class="liked-video-info">
                            <h5>${video.title}</h5>
                            <p>${video.description}</p>
                        </div>
                    </div>
                `).join('');
            }
        }
        
        function createNewPlaylist() {
            const name = prompt('Enter playlist name:');
            if (name && name.trim()) {
                const newPlaylist = {
                    id: Date.now(),
                    name: name.trim(),
                    videos: [],
                    created: new Date().toISOString()
                };
                playlists.push(newPlaylist);
                savePlaylists();
                loadPlaylists();
                showSuccessMessage(`Playlist "${name}" created! 📝`);
            }
        }
        
        function editPlaylist(index) {
            const playlist = playlists[index];
            const newName = prompt('Enter new name:', playlist.name);
            if (newName && newName.trim()) {
                playlists[index].name = newName.trim();
                savePlaylists();
                loadPlaylists();
                showSuccessMessage(`Playlist renamed to "${newName}"! ✏️`);
            }
        }
        
        function deletePlaylist(index) {
            if (confirm(`Delete playlist "${playlists[index].name}"?`)) {
                playlists.splice(index, 1);
                savePlaylists();
                loadPlaylists();
                showSuccessMessage('Playlist deleted! 🗑️');
            }
        }
        
        function viewPlaylist(index) {
            const playlist = playlists[index];
            if (playlist.videos.length === 0) {
                showMessage('This playlist is empty!', 'info');
                return;
            }
            
            // Show playlist options modal
            showPlaylistOptions(playlist, index);
        }
        
        function showPlaylistOptions(playlist, playlistIndex) {
            const modal = document.createElement('div');
            modal.className = 'playlist-options-modal';
            modal.innerHTML = `
                <div class="playlist-options-content">
                    <div class="playlist-options-header">
                        <h3><i class="fas fa-list"></i> ${playlist.name}</h3>
                        <p>${playlist.videos.length} videos • ${Math.round(playlist.videos.length * 3.5)} minutes</p>
                        <button class="modal-close" onclick="closePlaylistOptions()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="playlist-options-actions">
                        <button class="playlist-action-btn play-btn" onclick="startPlaylistPlayback(${playlistIndex}, false)">
                            <i class="fas fa-play"></i>
                            <span>Play</span>
                        </button>
                        <button class="playlist-action-btn shuffle-btn" onclick="startPlaylistPlayback(${playlistIndex}, true)">
                            <i class="fas fa-random"></i>
                            <span>Shuffle Play</span>
                        </button>
                        <button class="playlist-action-btn view-btn" onclick="viewPlaylistVideos(${playlistIndex})">
                            <i class="fas fa-eye"></i>
                            <span>View Videos</span>
                        </button>
                    </div>
                    
                    <div class="playlist-preview">
                        <h4>Playlist Preview</h4>
                        <div class="playlist-preview-list">
                            ${playlist.videos.slice(0, 5).map((video, idx) => `
                                <div class="playlist-preview-item">
                                    <span class="playlist-number">${idx + 1}</span>
                                    <img src="${video.thumbnail}" alt="${video.title}" class="playlist-preview-thumb">
                                    <div class="playlist-preview-info">
                                        <div class="playlist-preview-title">${video.title}</div>
                                    </div>
                                </div>
                            `).join('')}
                            ${playlist.videos.length > 5 ? `<div class="playlist-preview-more">+${playlist.videos.length - 5} more videos</div>` : ''}
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function closePlaylistOptions() {
            const modal = document.querySelector('.playlist-options-modal');
            if (modal) {
                modal.remove();
            }
        }
        
        function startPlaylistPlayback(playlistIndex, shuffle = false) {
            const playlist = playlists[playlistIndex];
            if (!playlist || playlist.videos.length === 0) {
                showMessage('Playlist is empty!', 'warning');
                return;
            }
            
            
            // Create shuffled or normal order
            let videosToPlay = [...playlist.videos];
            if (shuffle) {
                videosToPlay = shuffleArray(videosToPlay);
            }
            
            // Store current playlist state
            currentPlaylist = {
                videos: videosToPlay,
                currentIndex: 0,
                playlistIndex: playlistIndex,
                shuffle: shuffle
            };
            
            // Start playing first video
            const firstVideo = videosToPlay[0];
            playVideo(firstVideo.id, firstVideo.title, firstVideo.description || '');
            
            // Show playlist player controls
            showPlaylistPlayer();
            
            closePlaylistOptions();
            closeSidebar();
            
            showSuccessMessage(`Started ${shuffle ? 'shuffled ' : ''}playlist: ${playlist.name} 🎵`);
        }
        
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }
        
        function viewPlaylistVideos(playlistIndex) {
            const playlist = playlists[playlistIndex];
            
            // Display playlist videos
            const videosContainer = document.getElementById('videosContainer');
            const videosHTML = playlist.videos.map((video, index) => `
                <div class="video-card" onclick="playVideo('${video.id}', '${video.title.replace(/'/g, "\\'")}', '${video.description.replace(/'/g, "\\'")}')">
                    <div class="video-thumbnail">
                        <img src="${video.thumbnail}" alt="${video.title}">
                        <div class="playlist-number">${index + 1}</div>
                    </div>
                    <div class="video-actions">
                        <button class="action-btn add-to-playlist-btn" onclick="event.stopPropagation(); showPlaylistMenu('${video.id}', '${video.title.replace(/'/g, "\\'")}', '${video.thumbnail}')" title="Add to Playlist">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="action-btn like-btn" onclick="event.stopPropagation(); toggleLike('${video.id}')" title="Like Video">
                            <i class="fas fa-heart"></i>
                        </button>
                    </div>
                    <div class="video-info">
                        <div class="video-title">${video.title}</div>
                        <div class="video-meta">
                            <span class="video-category">${video.category}</span>
                        </div>
                    </div>
                </div>
            `).join('');
            
            videosContainer.innerHTML = `
                <div class="playlist-header">
                    <h3><i class="fas fa-list"></i> ${playlist.name}</h3>
                    <p>${playlist.videos.length} videos</p>
                    <div class="playlist-header-actions">
                        <button class="playlist-header-btn" onclick="startPlaylistPlayback(${playlistIndex}, false)">
                            <i class="fas fa-play"></i> Play
                        </button>
                        <button class="playlist-header-btn" onclick="startPlaylistPlayback(${playlistIndex}, true)">
                            <i class="fas fa-random"></i> Shuffle
                        </button>
                    </div>
                </div>
                ${videosHTML}
            `;
            
            // Update like button states
            setTimeout(() => updateAllLikeButtons(), 100);
            
            closePlaylistOptions();
            closeSidebar();
        }
        
        function viewLikedVideos() {
            if (likedVideos.length === 0) {
                showMessage('No liked videos yet!', 'info');
                return;
            }
            
            const videosContainer = document.getElementById('videosContainer');
            const videosHTML = likedVideos.map(video => `
                <div class="video-card" onclick="playVideo('${video.id}', '${video.title.replace(/'/g, "\\'")}', '${video.description.replace(/'/g, "\\'")}')">
                    <div class="video-thumbnail">
                        <img src="${video.thumbnail}" alt="${video.title}">
                    </div>
                    <div class="video-actions">
                        <button class="action-btn add-to-playlist-btn" onclick="event.stopPropagation(); showPlaylistMenu('${video.id}', '${video.title.replace(/'/g, "\\'")}', '${video.thumbnail}')" title="Add to Playlist">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="action-btn like-btn liked" onclick="event.stopPropagation(); toggleLike('${video.id}')" title="Unlike Video">
                            <i class="fas fa-heart"></i>
                        </button>
                    </div>
                    <div class="video-info">
                        <div class="video-title">${video.title}</div>
                        <div class="video-meta">
                            <span class="video-category">${video.category}</span>
                        </div>
                    </div>
                </div>
            `).join('');
            
            videosContainer.innerHTML = `
                <div class="playlist-header">
                    <h3><i class="fas fa-heart"></i> Liked Videos</h3>
                    <p>${likedVideos.length} videos</p>
                </div>
                ${videosHTML}
            `;
            
            // Update like button states
            setTimeout(() => updateAllLikeButtons(), 100);
            
            closeSidebar();
        }
        
        function showPlaylistMenu(videoId, title, thumbnail) {
            const menu = document.createElement('div');
            menu.className = 'playlist-menu';
            menu.innerHTML = `
                <div class="playlist-menu-content">
                    <h4>Add to Playlist</h4>
                    <p>${title}</p>
                    <div class="playlist-options">
                        <div class="playlist-option create-new-playlist" onclick="createNewPlaylistFromMenu('${videoId}', '${title.replace(/'/g, "\\'")}', '${thumbnail}')">
                            <i class="fas fa-plus-circle"></i>
                            <span>Create New Playlist</span>
                        </div>
                        ${playlists.map((playlist, index) => `
                            <div class="playlist-option" onclick="addToPlaylist(${index}, '${videoId}', '${title.replace(/'/g, "\\'")}', '${thumbnail}')">
                                <i class="fas fa-list"></i>
                                <span>${playlist.name}</span>
                            </div>
                        `).join('')}
                    </div>
                    <button class="playlist-menu-close" onclick="closePlaylistMenu()">Cancel</button>
                </div>
            `;
            
            document.body.appendChild(menu);
        }
        
        function closePlaylistMenu() {
            const menu = document.querySelector('.playlist-menu');
            if (menu) {
                menu.remove();
            }
        }
        
        function createNewPlaylistFromMenu(videoId, title, thumbnail) {
            const playlistName = prompt('Enter playlist name:');
            if (!playlistName || playlistName.trim() === '') {
                showMessage('Playlist name cannot be empty!', 'warning');
                return;
            }
            
            // Create new playlist
            const newPlaylist = {
                name: playlistName.trim(),
                videos: []
            };
            
            playlists.push(newPlaylist);
            savePlaylists();
            
            // Add video to the new playlist
            addToPlaylist(playlists.length - 1, videoId, title, thumbnail);
            
            // Close the menu
            closePlaylistMenu();
            
            showSuccessMessage(`Created "${playlistName}" and added video! 🎵`);
        }
        
        function addToPlaylist(playlistIndex, videoId, title, thumbnail) {
            const playlist = playlists[playlistIndex];
            const video = {
                id: videoId,
                title: title,
                thumbnail: thumbnail,
                added: new Date().toISOString()
            };
            
            // Check if video already exists in playlist
            if (playlist.videos.some(v => v.id === videoId)) {
                showMessage('Video already in playlist!', 'warning');
                closePlaylistMenu();
                return;
            }
            
            playlist.videos.push(video);
            savePlaylists();
            closePlaylistMenu();
            showSuccessMessage(`Added to "${playlist.name}"! 📝`);
        }
        
        function toggleLike(videoId) {
            const existingIndex = likedVideos.findIndex(v => v.id === videoId);
            const button = event.target.closest('.like-btn');
            
            if (existingIndex > -1) {
                // Unlike
                likedVideos.splice(existingIndex, 1);
                button.classList.remove('liked');
                showMessage('Removed from liked videos', 'info');
            } else {
                // Like
                const videoCard = button.closest('.video-card');
                const title = videoCard.querySelector('.video-title').textContent;
                const thumbnail = videoCard.querySelector('img').src;
                
                likedVideos.push({
                    id: videoId,
                    title: title,
                    thumbnail: thumbnail,
                    liked: new Date().toISOString()
                });
                
                button.classList.add('liked');
                showSuccessMessage('Added to liked videos! ❤️');
                
                // Trigger recommendation update
                updateRecommendations();
            }
            
            saveLikedVideos();
        }
        
        function updateRecommendations() {
            // Simple recommendation based on liked videos
            if (likedVideos.length > 0) {
                const likedCategories = likedVideos.map(v => v.category || 'general');
                const categoryCounts = likedCategories.reduce((acc, cat) => {
                    acc[cat] = (acc[cat] || 0) + 1;
                    return acc;
                }, {});
                
                const topCategory = Object.keys(categoryCounts).reduce((a, b) => 
                    categoryCounts[a] > categoryCounts[b] ? a : b
                );
                
                showMessage(`Based on your likes, we recommend ${topCategory} videos!`, 'info');
            }
        }
        
        function savePlaylists() {
            localStorage.setItem('kidsTubePlaylists', JSON.stringify(playlists));
        }
        
        function saveLikedVideos() {
            localStorage.setItem('kidsTubeLikedVideos', JSON.stringify(likedVideos));
        }
        
        // Playlist Player Functions
        function showPlaylistPlayer() {
            if (!currentPlaylist) return;
            
            // Create playlist player controls
            let playerControls = document.getElementById('playlistPlayerControls');
            if (!playerControls) {
                playerControls = document.createElement('div');
                playerControls.id = 'playlistPlayerControls';
                playerControls.className = 'playlist-player-controls';
                document.body.appendChild(playerControls);
            }
            
            const playlist = playlists[currentPlaylist.playlistIndex];
            const currentVideo = currentPlaylist.videos[currentPlaylist.currentIndex];
            
            playerControls.innerHTML = `
                <div class="playlist-player-content">
                    <div class="playlist-player-info">
                        <div class="playlist-player-title">
                            <i class="fas fa-list"></i>
                            <span>${playlist.name}</span>
                            ${currentPlaylist.shuffle ? '<i class="fas fa-random shuffle-indicator"></i>' : ''}
                        </div>
                        <div class="playlist-player-current">
                            ${currentPlaylist.currentIndex + 1} of ${currentPlaylist.videos.length} • ${currentVideo.title}
                        </div>
                    </div>
                    
                    <div class="playlist-player-actions">
                        <button class="playlist-nav-btn" onclick="playPreviousVideo()" ${currentPlaylist.currentIndex === 0 ? 'disabled' : ''}>
                            <i class="fas fa-step-backward"></i>
                        </button>
                        <button class="playlist-nav-btn" onclick="playNextVideo()" ${currentPlaylist.currentIndex === currentPlaylist.videos.length - 1 ? 'disabled' : ''}>
                            <i class="fas fa-step-forward"></i>
                        </button>
                        <button class="playlist-nav-btn" onclick="toggleShuffle()">
                            <i class="fas fa-random ${currentPlaylist.shuffle ? 'active' : ''}"></i>
                        </button>
                        <button class="playlist-nav-btn" onclick="closePlaylistPlayer()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            `;
        }
        
        function playNextVideo() {
            if (!currentPlaylist) return;
            
            if (currentPlaylist.currentIndex < currentPlaylist.videos.length - 1) {
                currentPlaylist.currentIndex++;
                const nextVideo = currentPlaylist.videos[currentPlaylist.currentIndex];
                playVideo(nextVideo.id, nextVideo.title, nextVideo.description || '');
                showPlaylistPlayer(); // Update controls
            }
        }
        
        function playPreviousVideo() {
            if (!currentPlaylist) return;
            
            if (currentPlaylist.currentIndex > 0) {
                currentPlaylist.currentIndex--;
                const prevVideo = currentPlaylist.videos[currentPlaylist.currentIndex];
                playVideo(prevVideo.id, prevVideo.title, prevVideo.description || '');
                showPlaylistPlayer(); // Update controls
            }
        }
        
        function toggleShuffle() {
            if (!currentPlaylist) return;
            
            currentPlaylist.shuffle = !currentPlaylist.shuffle;
            if (currentPlaylist.shuffle) {
                // Reshuffle remaining videos
                const remainingVideos = currentPlaylist.videos.slice(currentPlaylist.currentIndex + 1);
                const shuffled = shuffleArray(remainingVideos);
                currentPlaylist.videos = [
                    ...currentPlaylist.videos.slice(0, currentPlaylist.currentIndex + 1),
                    ...shuffled
                ];
            }
            showPlaylistPlayer(); // Update controls
            showMessage(`Shuffle ${currentPlaylist.shuffle ? 'enabled' : 'disabled'}`, 'info');
        }
        
        function closePlaylistPlayer() {
            const playerControls = document.getElementById('playlistPlayerControls');
            if (playerControls) {
                playerControls.remove();
            }
            currentPlaylist = null;
        }
        
        // Age-based content filtering
        function getAgeAppropriateKeywords(ageGroup) {
            const ageKeywords = {
                '0-2': [
                    'baby', 'toddler', 'nursery rhymes', 'lullaby', 'colors', 'shapes', 'animals', 
                    'peekaboo', 'first words', 'counting', 'abc', 'simple songs', 'cartoon babies',
                    'educational baby', 'learning colors', 'animal sounds', 'bedtime stories'
                ],
                '3-8': [
                    'preschool', 'kindergarten', 'educational', 'learning', 'cartoons', 'puppets',
                    'story time', 'songs', 'dance', 'art', 'crafts', 'science kids', 'math kids',
                    'reading', 'phonics', 'numbers', 'letters', 'shapes', 'colors', 'animals',
                    'nature', 'space', 'dinosaurs', 'fairy tales', 'nursery rhymes', 'kids songs'
                ],
                '8-12': [
                    'elementary', 'science', 'history', 'geography', 'math', 'reading', 'writing',
                    'art', 'music', 'sports', 'adventure', 'mystery', 'fantasy', 'animals',
                    'nature', 'space', 'technology', 'robots', 'coding', 'experiments', 'projects',
                    'educational games', 'documentaries', 'biography', 'culture', 'languages'
                ]
            };
            return ageKeywords[ageGroup] || ageKeywords['3-8'];
        }
        
        function isAgeAppropriate(video, ageGroup) {
            const ageKeywords = getAgeAppropriateKeywords(ageGroup);
            const inappropriateKeywords = [
                'scary', 'frightening', 'violent', 'aggressive', 'fighting', 'weapons',
                'inappropriate', 'adult', 'teen', 'mature', 'horror', 'thriller'
            ];
            
            const title = video.title.toLowerCase();
            const description = (video.description || '').toLowerCase();
            const channel = (video.channelTitle || '').toLowerCase();
            
            // Check for inappropriate content
            for (const keyword of inappropriateKeywords) {
                if (title.includes(keyword) || description.includes(keyword) || channel.includes(keyword)) {
                    return false;
                }
            }
            
            // Check for age-appropriate content
            for (const keyword of ageKeywords) {
                if (title.includes(keyword) || description.includes(keyword) || channel.includes(keyword)) {
                    return true;
                }
            }
            
            // If no specific keywords match, consider it appropriate for 3-8+ age groups
            return ageGroup !== '0-2';
        }
        
        function getAgeBasedSearchQuery(originalQuery, ageGroup) {
            const ageKeywords = getAgeAppropriateKeywords(ageGroup);
            const randomKeyword = ageKeywords[Math.floor(Math.random() * ageKeywords.length)];
            return `${originalQuery} ${randomKeyword} kids`;
        }
        
        // Check if video is liked and update button state
        function updateLikeButtonState(videoId, button) {
            if (!button) return;
            
            const isLiked = likedVideos.some(v => v.id === videoId);
            if (isLiked) {
                button.classList.add('liked');
            } else {
                button.classList.remove('liked');
            }
        }
        
        // Update all like buttons on page load
        function updateAllLikeButtons() {
            document.querySelectorAll('.like-btn').forEach(button => {
                const videoCard = button.closest('.video-card');
                if (videoCard) {
                    const videoId = videoCard.getAttribute('onclick');
                    if (videoId) {
                        const match = videoId.match(/playVideo\('([^']+)'/);
                        if (match) {
                            updateLikeButtonState(match[1], button);
                        }
                    }
                }
            });
        }
        
        function openParentalControls() {
            closeSidebar();
            showParentalModal();
        }
        
        function showParentalModal() {
            const modal = document.getElementById('parentalModal');
            modal.style.display = 'flex';
            setTimeout(() => {
                modal.classList.add('show');
            }, 10);
            loadParentalSettings();
        }
        
        function closeParentalModal() {
            const modal = document.getElementById('parentalModal');
            modal.classList.remove('show');
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }
        
        function loadParentalSettings() {
            // Load settings from localStorage or use defaults
            const settings = JSON.parse(localStorage.getItem('parentalSettings') || '{}');
            
            document.getElementById('dailyLimitEnabled').checked = settings.dailyLimitEnabled || false;
            document.getElementById('dailyLimitHours').value = settings.dailyLimitHours || 2;
            document.getElementById('dailyLimitHours').disabled = !settings.dailyLimitEnabled;
            
            document.getElementById('bedtimeMode').checked = settings.bedtimeMode || false;
            document.getElementById('weekendMode').checked = settings.weekendMode || false;
            document.getElementById('breakReminderEnabled').checked = settings.breakReminderEnabled || false;
            document.getElementById('breakInterval').value = settings.breakInterval || 30;
            document.getElementById('breakInterval').disabled = !settings.breakReminderEnabled;
            
            // Set age group radio button
            const ageGroup = settings.ageGroup || '3-8';
            const ageGroupRadio = document.getElementById(`ageGroup-${ageGroup}`);
            if (ageGroupRadio) {
                ageGroupRadio.checked = true;
            }
            
            // Set default filter mode radio button
            const filterMode = settings.defaultFilterMode || 'none';
            const filterRadio = document.getElementById(`filter-${filterMode}`);
            if (filterRadio) {
                filterRadio.checked = true;
            }
            
            // Add event listeners for checkboxes
            document.getElementById('dailyLimitEnabled').addEventListener('change', function() {
                document.getElementById('dailyLimitHours').disabled = !this.checked;
            });
            
            document.getElementById('breakReminderEnabled').addEventListener('change', function() {
                document.getElementById('breakInterval').disabled = !this.checked;
            });
            
            // Add event listeners for radio buttons
            const ageGroupRadios = document.querySelectorAll('input[name="ageGroup"]');
            ageGroupRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    // Remove selected class from all age group options
                    document.querySelectorAll('input[name="ageGroup"]').forEach(r => {
                        r.closest('.radio-option').classList.remove('selected');
                    });
                    // Add selected class to current option
                    this.closest('.radio-option').classList.add('selected');
                });
            });
            
            const filterRadios = document.querySelectorAll('input[name="defaultFilterMode"]');
            filterRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    // Remove selected class from all filter options
                    document.querySelectorAll('input[name="defaultFilterMode"]').forEach(r => {
                        r.closest('.radio-option').classList.remove('selected');
                    });
                    // Add selected class to current option
                    this.closest('.radio-option').classList.add('selected');
                });
            });
            
            // Set initial selected states
            const selectedAgeGroup = document.querySelector('input[name="ageGroup"]:checked');
            if (selectedAgeGroup) {
                selectedAgeGroup.closest('.radio-option').classList.add('selected');
            }
            
            const selectedFilter = document.querySelector('input[name="defaultFilterMode"]:checked');
            if (selectedFilter) {
                selectedFilter.closest('.radio-option').classList.add('selected');
            }
        }
        
        function saveParentalSettings() {
            const settings = {
                dailyLimitEnabled: document.getElementById('dailyLimitEnabled').checked,
                dailyLimitHours: parseFloat(document.getElementById('dailyLimitHours').value),
                bedtimeMode: document.getElementById('bedtimeMode').checked,
                weekendMode: document.getElementById('weekendMode').checked,
                breakReminderEnabled: document.getElementById('breakReminderEnabled').checked,
                breakInterval: parseInt(document.getElementById('breakInterval').value),
                ageGroup: document.querySelector('input[name="ageGroup"]:checked')?.value || '3-8',
                defaultFilterMode: document.querySelector('input[name="defaultFilterMode"]:checked')?.value || 'none'
            };
            
            localStorage.setItem('parentalSettings', JSON.stringify(settings));
            
            // Apply the default filter mode
            if (settings.defaultFilterMode !== 'none') {
                parentalSettings.targetMode = settings.defaultFilterMode;
                applyBaseVideoFilter();
                updateActiveFilterOption();
            }
            
            // Show success message
            showMessage('Parental settings saved successfully! 🛡️', 'success');
            
            closeParentalModal();
        }
        
        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('parentalModal');
            if (event.target === modal) {
                closeParentalModal();
            }
        });
        
        // Close modal with Escape key and spacebar for video control
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const modal = document.getElementById('parentalModal');
                if (modal.classList.contains('show')) {
                    closeParentalModal();
                }
            }
            
            // Spacebar to play/pause video
            if (event.key === ' ' || event.key === 'Spacebar') {
                // Only if not typing in an input field
                if (event.target.tagName !== 'INPUT' && event.target.tagName !== 'TEXTAREA') {
                    event.preventDefault();
                    toggleVideoPlayback();
                }
            }
        });
        
        // Professional Message System
        function showMessage(message, type = 'info', duration = 5000) {
            // Remove existing messages
            const existingMessages = document.querySelectorAll('.message-toast');
            existingMessages.forEach(msg => msg.remove());
            
            const messageContainer = document.createElement('div');
            messageContainer.className = `message-toast message-${type}`;
            
            const icon = getMessageIcon(type);
            const messageHTML = `
                <div class="message-content">
                    <i class="${icon}"></i>
                    <span>${message}</span>
                </div>
                <button class="message-close" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            messageContainer.innerHTML = messageHTML;
            
            // Add to page
            document.body.appendChild(messageContainer);
            
            // Animate in
            setTimeout(() => {
                messageContainer.classList.add('show');
            }, 10);
            
            // Auto remove after duration
            if (duration > 0) {
                setTimeout(() => {
                    if (messageContainer.parentElement) {
                        messageContainer.classList.remove('show');
                        setTimeout(() => {
                            if (messageContainer.parentElement) {
                                messageContainer.remove();
                            }
                        }, 300);
                    }
                }, duration);
            }
        }
        
        function getMessageIcon(type) {
            const icons = {
                'success': 'fas fa-check-circle',
                'error': 'fas fa-exclamation-circle',
                'warning': 'fas fa-exclamation-triangle',
                'info': 'fas fa-info-circle',
                'loading': 'fas fa-spinner fa-spin'
            };
            return icons[type] || icons['info'];
        }
        
        // Enhanced Error Handling
        function handleError(error, context = '') {
            console.error(`Error in ${context}:`, error);
            
            let userMessage = 'An unexpected error occurred. Please try again.';
            
            if (error.name === 'TypeError' && error.message.includes('fetch')) {
                userMessage = 'Network connection failed. Please check your internet connection.';
            } else if (error.name === 'AbortError') {
                userMessage = 'Request was cancelled. Please try again.';
            } else if (error.message.includes('quota')) {
                userMessage = 'Daily limit reached. Please try again tomorrow.';
            } else if (error.message.includes('permission')) {
                userMessage = 'Permission denied. Please check your settings.';
            } else if (error.message.includes('timeout')) {
                userMessage = 'Request timed out. Please try again.';
            } else if (error.message) {
                userMessage = error.message;
            }
            
            showMessage(userMessage, 'error');
        }
        
        // Global Error Handler
        window.addEventListener('error', function(event) {
            handleError(event.error, 'Global');
        });
        
        // Unhandled Promise Rejection Handler
        window.addEventListener('unhandledrejection', function(event) {
            handleError(event.reason, 'Promise');
            event.preventDefault();
        });
        
        function toggleFilterDropdown() {
            const dropdown = document.getElementById('filterDropdown');
            const arrow = document.getElementById('dropdownArrow');
            
            dropdown.classList.toggle('open');
            arrow.classList.toggle('rotated');
        }
        
        function toggleScreenTimeDropdown() {
            const dropdown = document.getElementById('screenTimeDropdown');
            const arrow = document.getElementById('screenTimeArrow');
            
            dropdown.classList.toggle('open');
            arrow.classList.toggle('rotated');
        }
        
        function toggleParentalDropdown() {
            const dropdown = document.getElementById('parentalDropdown');
            const arrow = document.getElementById('parentalArrow');
            
            dropdown.classList.toggle('open');
            arrow.classList.toggle('rotated');
        }
        
        function startQuickTimer() {
            // Set a 5-minute timer
            parentalSettings.timerDuration = 5;
            parentalSettings.timerActive = true;
            parentalSettings.timerStartTime = Date.now();
            saveSettings();
            
            // Start the timer
            startTimer();
            
            // Close sidebar
            closeSidebar();
            
            showSuccessMessage('Quick 5-minute timer started! ⏰');
        }
        
        function toggleStatsPanel() {
            // Close sidebar first
            closeSidebar();
            
            // Toggle stats panel (if it exists) or show a message
            if (typeof toggleParentalPanel === 'function') {
                toggleParentalPanel();
            } else {
                showSuccessMessage('Statistics feature coming soon! 📊');
            }
        }
        
        function updateTimerStatus() {
            const timerIcon = document.getElementById('timerIcon');
            const timerText = document.getElementById('timerText');
            const timerStatus = document.getElementById('timerStatus');
            
            if (!timerIcon || !timerText || !timerStatus) return;
            
            if (parentalSettings.timerActive) {
                timerIcon.className = 'fas fa-pause';
                timerText.textContent = 'Pause Timer';
                timerStatus.textContent = 'Timer is running';
            } else {
                timerIcon.className = 'fas fa-play';
                timerText.textContent = 'Start Timer';
                timerStatus.textContent = 'Ready to start';
            }
        }
        
        // Video Overlay Controls
        function setupVideoOverlay() {
            const playBtn = document.getElementById('overlayPlayBtn');
            const progressBar = document.getElementById('overlayProgressBar');
            const volumeBtn = document.getElementById('overlayVolumeBtn');
            const volumeSlider = document.getElementById('overlayVolumeSlider');
            const fullscreenBtn = document.getElementById('overlayFullscreenBtn');
            const toggleBtn = document.getElementById('overlayToggleBtn');
            
            if (playBtn) {
                playBtn.addEventListener('click', toggleVideoPlayback);
            }
            
            if (progressBar) {
                progressBar.addEventListener('click', seekVideo);
            }
            
            if (volumeBtn) {
                volumeBtn.addEventListener('click', toggleVideoMute);
            }
            
            if (volumeSlider) {
                volumeSlider.addEventListener('click', adjustVolume);
            }
            
            if (fullscreenBtn) {
                fullscreenBtn.addEventListener('click', toggleFullscreen);
            }
            
            if (toggleBtn) {
                toggleBtn.addEventListener('click', toggleOverlayVisibility);
            }
        }
        
        function toggleVideoPlayback() {
            if (!youtubePlayer) {
                showSuccessMessage('Video player not ready yet! Please wait... ⏳');
                return;
            }
            
            const playBtn = document.getElementById('overlayPlayBtn');
            const icon = playBtn ? playBtn.querySelector('i') : null;
            
            try {
                if (isVideoPlaying) {
                    // Pause video
                    youtubePlayer.pauseVideo();
                    showSuccessMessage('Video paused! ⏸️');
                } else {
                    // Play video
                    youtubePlayer.playVideo();
                    showSuccessMessage('Video playing! ▶️');
                }
            } catch (error) {
                console.error('Error controlling video:', error);
                showSuccessMessage('Error controlling video. Please try again! ❌');
            }
        }
        
        
        function seekVideo(event) {
            const progressBar = event.currentTarget;
            const rect = progressBar.getBoundingClientRect();
            const clickX = event.clientX - rect.left;
            const percentage = clickX / rect.width;
            
            // Update progress bar visual
            const progressFill = document.getElementById('overlayProgressFill');
            if (progressFill) {
                progressFill.style.width = (percentage * 100) + '%';
            }
            
            // Try to seek in YouTube video
            const videoPlayer = document.getElementById('videoPlayer');
            const iframe = videoPlayer.querySelector('iframe');
            
            if (iframe) {
                try {
                    // Send seek command to YouTube
                    iframe.contentWindow.postMessage(`{"event":"command","func":"seekTo","args":"${Math.floor(percentage * 100)}"}`, '*');
                    showSuccessMessage(`Seeked to ${Math.floor(percentage * 100)}%`);
                } catch (error) {
                    console.log('Seek not available:', error);
                }
            }
        }
        
        function toggleVideoMute() {
            const volumeBtn = document.getElementById('overlayVolumeBtn');
            const icon = volumeBtn.querySelector('i');
            const videoPlayer = document.getElementById('videoPlayer');
            const iframe = videoPlayer.querySelector('iframe');
            
            // Toggle mute state
            if (icon.classList.contains('fa-volume-up')) {
                icon.className = 'fas fa-volume-mute';
                if (iframe) {
                    try {
                        iframe.contentWindow.postMessage('{"event":"command","func":"mute","args":""}', '*');
                        showSuccessMessage('Video muted! 🔇');
                    } catch (error) {
                        console.log('Mute not available:', error);
                    }
                }
            } else {
                icon.className = 'fas fa-volume-up';
                if (iframe) {
                    try {
                        iframe.contentWindow.postMessage('{"event":"command","func":"unMute","args":""}', '*');
                        showSuccessMessage('Video unmuted! 🔊');
                    } catch (error) {
                        console.log('Unmute not available:', error);
                    }
                }
            }
        }
        
        function adjustVolume(event) {
            const volumeSlider = event.currentTarget;
            const rect = volumeSlider.getBoundingClientRect();
            const clickX = event.clientX - rect.left;
            const percentage = clickX / rect.width;
            const volume = Math.floor(percentage * 100);
            
            // Update volume slider visual
            const volumeFill = document.getElementById('overlayVolumeFill');
            if (volumeFill) {
                volumeFill.style.width = (percentage * 100) + '%';
            }
            
            // Try to set volume in YouTube video
            const videoPlayer = document.getElementById('videoPlayer');
            const iframe = videoPlayer.querySelector('iframe');
            
            if (iframe) {
                try {
                    iframe.contentWindow.postMessage(`{"event":"command","func":"setVolume","args":"${volume}"}`, '*');
                    showSuccessMessage(`Volume: ${volume}%`);
                } catch (error) {
                    console.log('Volume control not available:', error);
                }
            }
        }
        
        function toggleFullscreen() {
            const videoPlayer = document.getElementById('videoPlayer');
            const fullscreenBtn = document.getElementById('overlayFullscreenBtn');
            const icon = fullscreenBtn.querySelector('i');
            
            if (!document.fullscreenElement) {
                // Enter fullscreen
                if (videoPlayer.requestFullscreen) {
                    videoPlayer.requestFullscreen();
                } else if (videoPlayer.webkitRequestFullscreen) {
                    videoPlayer.webkitRequestFullscreen();
                } else if (videoPlayer.mozRequestFullScreen) {
                    videoPlayer.mozRequestFullScreen();
                } else if (videoPlayer.msRequestFullscreen) {
                    videoPlayer.msRequestFullscreen();
                }
                icon.className = 'fas fa-compress';
                showSuccessMessage('Fullscreen mode! Use overlay controls. 🖥️');
            } else {
                // Exit fullscreen
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
                icon.className = 'fas fa-expand';
                showSuccessMessage('Exited fullscreen mode! 🖥️');
            }
        }
        
        function toggleOverlayVisibility() {
            const videoPlayer = document.getElementById('videoPlayer');
            const toggleBtn = document.getElementById('overlayToggleBtn');
            const icon = toggleBtn.querySelector('i');
            
            videoPlayer.classList.toggle('overlay-hidden');
            
            if (videoPlayer.classList.contains('overlay-hidden')) {
                icon.className = 'fas fa-eye';
            } else {
                icon.className = 'fas fa-eye-slash';
            }
        }
        
        function handleVideoClick() {
            const videoPlayer = document.getElementById('videoPlayer');
            const iframe = videoPlayer.querySelector('iframe');
            const playBtn = document.getElementById('overlayPlayBtn');
            const icon = playBtn.querySelector('i');
            
            if (!iframe) return;
            
            // Temporarily enable iframe interaction
            iframe.style.pointerEvents = 'auto';
            
            // Toggle play/pause state
            if (icon.classList.contains('fa-play')) {
                icon.className = 'fas fa-pause';
                showSuccessMessage('Video playing! ▶️');
            } else {
                icon.className = 'fas fa-play';
                showSuccessMessage('Video paused! ⏸️');
            }
            
            // Restore pointer-events after a short delay
            setTimeout(() => {
                iframe.style.pointerEvents = 'none';
            }, 1000);
        }
        
        // Prevent YouTube redirects and unwanted interactions
        function preventYouTubeRedirects() {
            // Block any attempts to navigate away from the page
            window.addEventListener('beforeunload', function(e) {
                e.preventDefault();
                e.returnValue = '';
                return '';
            });
            
            // Block YouTube iframe navigation
            document.addEventListener('click', function(e) {
                if (e.target.tagName === 'IFRAME') {
                    e.preventDefault();
                    e.stopPropagation();
                    return false;
                }
            });
            
            // Block right-click context menu on iframe
            document.addEventListener('contextmenu', function(e) {
                if (e.target.tagName === 'IFRAME') {
                    e.preventDefault();
                    return false;
                }
            });
        }
        
        function calculateGradualSaturation(progress) {
            // Very gradual saturation reduction
            if (progress < 0.1) return 1.0; // No change for first 10%
            if (progress < 0.3) return 1.0 - (progress - 0.1) * 0.2; // 0.98 to 0.96
            if (progress < 0.6) return 0.96 - (progress - 0.3) * 0.3; // 0.96 to 0.87
            if (progress < 0.9) return 0.87 - (progress - 0.6) * 0.4; // 0.87 to 0.75
            return 0.75 - (progress - 0.9) * 0.65; // 0.75 to 0.1
        }
        
        function calculateGradualBrightness(progress) {
            // Very gradual brightness reduction
            if (progress < 0.2) return 1.0; // No change for first 20%
            if (progress < 0.5) return 1.0 - (progress - 0.2) * 0.1; // 1.0 to 0.97
            if (progress < 0.8) return 0.97 - (progress - 0.5) * 0.2; // 0.97 to 0.91
            return 0.91 - (progress - 0.8) * 0.45; // 0.91 to 0.82
        }
        
        function calculateGradualContrast(progress) {
            // Very gradual contrast reduction
            if (progress < 0.15) return 1.0; // No change for first 15%
            if (progress < 0.4) return 1.0 - (progress - 0.15) * 0.05; // 1.0 to 0.9875
            if (progress < 0.7) return 0.9875 - (progress - 0.4) * 0.1; // 0.9875 to 0.9575
            return 0.9575 - (progress - 0.7) * 0.3; // 0.9575 to 0.87
        }
        
        function resetVideoTonedown() {
            const videoPlayer = document.getElementById('videoPlayer');
            const videoIframe = videoPlayer.querySelector('iframe');
            
            if (videoPlayer) {
                videoPlayer.style.filter = 'none';
            }
            
            if (videoIframe) {
                videoIframe.style.filter = 'none';
            }
            
            // Handle fullscreen mode - check if video is in fullscreen
            const fullscreenElement = document.fullscreenElement || 
                                    document.webkitFullscreenElement || 
                                    document.mozFullScreenElement || 
                                    document.msFullscreenElement;
            
            if (fullscreenElement === videoPlayer) {
                // Video is in fullscreen, ensure reset applies
                videoPlayer.style.filter = 'none';
                if (videoIframe) {
                    videoIframe.style.filter = 'none';
                }
            }
        }

        function updateTimeDisplay() {
            const timeRemaining = document.getElementById('timeRemaining');
            const timeElapsed = document.getElementById('timeElapsed');
            
            if (!tonedownStartTime) {
                if (timeRemaining) timeRemaining.textContent = formatTime(tonedownDuration) + ' remaining';
                if (timeElapsed) timeElapsed.textContent = '0:00 elapsed';
                return;
            }
            
            const elapsed = Date.now() - tonedownStartTime;
            const remaining = Math.max(0, tonedownDuration - elapsed);
            
            if (timeRemaining) timeRemaining.textContent = formatTime(remaining) + ' remaining';
            if (timeElapsed) timeElapsed.textContent = formatTime(elapsed) + ' elapsed';
        }

        function formatTime(milliseconds) {
            const totalSeconds = Math.floor(milliseconds / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return minutes + ':' + (seconds < 10 ? '0' : '') + seconds;
        }

        function completeTonedown() {
            tonedownActive = false;
            
            const toggleBtn = document.getElementById('tonedownToggle');
            if (toggleBtn) {
                toggleBtn.innerHTML = '<i class="fas fa-play"></i> Start Timer';
                toggleBtn.classList.remove('active');
            }
            
            // Track statistics
            if (tonedownStartTime) {
                const sessionTime = Date.now() - tonedownStartTime;
                dailyUsage += sessionTime;
                weeklyUsage += sessionTime;
                sessionCount++;
                totalSessionTime += sessionTime;
                saveSettings();
            }
            
            // Apply maximum tone-down effect only to video
            const videoPlayer = document.getElementById('videoPlayer');
            const videoIframe = videoPlayer.querySelector('iframe');
            
            if (videoPlayer) {
                videoPlayer.style.filter = 'saturate(0.05) brightness(0.6) contrast(0.7)';
            }
            
            if (videoIframe) {
                videoIframe.style.filter = 'saturate(0.05) brightness(0.6) contrast(0.7)';
            }
            
            // Stop timer
            if (tonedownTimer) {
                clearInterval(tonedownTimer);
                tonedownTimer = null;
            }
            
            // Stop break reminders
            if (breakReminderInterval) {
                clearInterval(breakReminderInterval);
                breakReminderInterval = null;
            }
            
            showSuccessMessage('Screen time complete! Video is now very dim - time for a break! 🌙✨');
        }

        function resetTonedown() {
            tonedownActive = false;
            tonedownStartTime = null;
            
            const toggleBtn = document.getElementById('tonedownToggle');
            const progressFill = document.getElementById('progressFill');
            
            if (toggleBtn) {
                toggleBtn.innerHTML = '<i class="fas fa-play"></i> Start Timer';
                toggleBtn.classList.remove('active');
            }
            
            if (progressFill) {
                progressFill.style.width = '0%';
            }
            
            // Reset video tonedown effects
            resetVideoTonedown();
            
            // Stop timer
            if (tonedownTimer) {
                clearInterval(tonedownTimer);
                tonedownTimer = null;
            }
            
            updateTimeDisplay();
            showSuccessMessage('Timer reset! Video colors restored! 🔄');
        }

        function updateParentalButtonVisibility() {
            const parentalBtn = document.getElementById('parentalBtn');
            if (parentalBtn) {
                if (parentalSettings.hideParentalBtn) {
                    parentalBtn.style.display = 'none';
                } else {
                    parentalBtn.style.display = 'flex';
                }
            }
        }

        // Break System Functions
        function startBreakTimer() {
            // Clear any existing timer
            if (breakInterval) {
                clearInterval(breakInterval);
            }
            
            videoStartTime = Date.now();
            
            // Set up break reminder every 15 minutes
            breakInterval = setInterval(() => {
                showBreakModal();
            }, breakDuration);
        }

        function stopBreakTimer() {
            if (breakInterval) {
                clearInterval(breakInterval);
                breakInterval = null;
            }
            videoStartTime = null;
        }

        function showBreakModal() {
            // Create break modal
            const modal = document.createElement('div');
            modal.id = 'breakModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                font-family: 'Fredoka', sans-serif;
            `;

            // Get random game
            const game = getRandomBreakGame();
            
            modal.innerHTML = `
                <div style="
                    background: var(--bg-white);
                    border-radius: 20px;
                    padding: 2rem;
                    max-width: 500px;
                    width: 90%;
                    text-align: center;
                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                    position: relative;
                ">
                    <div style="
                        position: absolute;
                        top: -10px;
                        right: -10px;
                        width: 30px;
                        height: 20px;
                        background: radial-gradient(ellipse, var(--primary-pink) 12px 8px, transparent 12px 8px);
                    "></div>
                    <div style="
                        position: absolute;
                        bottom: -8px;
                        left: -8px;
                        width: 25px;
                        height: 15px;
                        background: radial-gradient(ellipse, var(--primary-blue) 10px 6px, transparent 10px 6px);
                    "></div>
                    
                    <h2 style="color: var(--text-dark); margin-bottom: 1rem; font-family: 'Fredoka One', cursive;">
                        🎮 Break Time! 🎮
                    </h2>
                    <p style="color: var(--text-light); margin-bottom: 2rem;">
                        You've been watching for 15 minutes! Let's play a fun game! 🦕
                    </p>
                    
                    <div id="breakGameContent" style="margin-bottom: 2rem;">
                        ${game.html}
                    </div>
                    
                    <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                        <button onclick="completeBreakGame()" style="
                            background: var(--primary-green);
                            color: white;
                            border: none;
                            padding: 1rem 2rem;
                            border-radius: 15px;
                            font-family: 'Fredoka', sans-serif;
                            font-weight: 600;
                            font-size: 1rem;
                            cursor: pointer;
                            transition: all 0.3s ease;
                        " onmouseover="this.style.background='#4ECDC4'" onmouseout="this.style.background='var(--primary-green)'">
                            ✅ I'm Done! Continue Watching
                        </button>
                        <button onclick="skipBreak()" style="
                            background: var(--primary-orange);
                            color: white;
                            border: none;
                            padding: 1rem 2rem;
                            border-radius: 15px;
                            font-family: 'Fredoka', sans-serif;
                            font-weight: 600;
                            font-size: 1rem;
                            cursor: pointer;
                            transition: all 0.3s ease;
                        " onmouseover="this.style.background='#FF8C00'" onmouseout="this.style.background='var(--primary-orange)'">
                            ⏭️ Skip Break
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            currentBreakGame = game;
        }

        function getRandomBreakGame() {
            const games = [
                {
                    name: "Dinosaur Memory Game",
                    html: `
                        <div style="margin-bottom: 1rem;">
                            <h3 style="color: var(--text-dark); margin-bottom: 1rem;">🦕 Find the Matching Dinosaurs! 🦕</h3>
                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.5rem; max-width: 300px; margin: 0 auto;">
                                <div onclick="flipCard(this)" style="
                                    width: 60px; height: 60px; background: var(--primary-pink); 
                                    border-radius: 10px; display: flex; align-items: center; 
                                    justify-content: center; cursor: pointer; font-size: 1.5rem;
                                ">🦕</div>
                                <div onclick="flipCard(this)" style="
                                    width: 60px; height: 60px; background: var(--primary-blue); 
                                    border-radius: 10px; display: flex; align-items: center; 
                                    justify-content: center; cursor: pointer; font-size: 1.5rem;
                                ">🦖</div>
                                <div onclick="flipCard(this)" style="
                                    width: 60px; height: 60px; background: var(--primary-yellow); 
                                    border-radius: 10px; display: flex; align-items: center; 
                                    justify-content: center; cursor: pointer; font-size: 1.5rem;
                                ">🦕</div>
                                <div onclick="flipCard(this)" style="
                                    width: 60px; height: 60px; background: var(--primary-green); 
                                    border-radius: 10px; display: flex; align-items: center; 
                                    justify-content: center; cursor: pointer; font-size: 1.5rem;
                                ">🦖</div>
                            </div>
                            <p style="font-size: 0.9rem; color: var(--text-light); margin-top: 1rem;">
                                Click the dinosaurs to find matching pairs!
                            </p>
                        </div>
                    `
                },
                {
                    name: "Color Counting Game",
                    html: `
                        <div style="margin-bottom: 1rem;">
                            <h3 style="color: var(--text-dark); margin-bottom: 1rem;">🌈 Count the Colors! 🌈</h3>
                            <div style="display: flex; gap: 1rem; justify-content: center; margin-bottom: 1rem; flex-wrap: wrap;">
                                <div style="width: 40px; height: 40px; background: var(--primary-pink); border-radius: 50%;"></div>
                                <div style="width: 40px; height: 40px; background: var(--primary-blue); border-radius: 50%;"></div>
                                <div style="width: 40px; height: 40px; background: var(--primary-yellow); border-radius: 50%;"></div>
                                <div style="width: 40px; height: 40px; background: var(--primary-green); border-radius: 50%;"></div>
                                <div style="width: 40px; height: 40px; background: var(--primary-orange); border-radius: 50%;"></div>
                            </div>
                            <p style="font-size: 1.2rem; color: var(--text-dark); font-weight: 600;">
                                How many circles do you see? <span id="colorAnswer" style="color: var(--primary-pink);">5</span>
                            </p>
                        </div>
                    `
                },
                {
                    name: "Shape Puzzle",
                    html: `
                        <div style="margin-bottom: 1rem;">
                            <h3 style="color: var(--text-dark); margin-bottom: 1rem;">🔷 Complete the Pattern! 🔷</h3>
                            <div style="display: flex; gap: 1rem; justify-content: center; margin-bottom: 1rem; flex-wrap: wrap;">
                                <div style="width: 50px; height: 50px; background: var(--primary-pink); border-radius: 10px;"></div>
                                <div style="width: 50px; height: 50px; background: var(--primary-blue); border-radius: 50%;"></div>
                                <div style="width: 50px; height: 50px; background: var(--primary-yellow); border-radius: 10px;"></div>
                                <div style="width: 50px; height: 50px; background: var(--primary-green); border-radius: 50%;"></div>
                                <div style="width: 50px; height: 50px; background: var(--primary-orange); border-radius: 10px; border: 3px dashed var(--text-light);"></div>
                            </div>
                            <p style="font-size: 1rem; color: var(--text-dark);">
                                What shape should go in the empty space? <br>
                                <button onclick="checkShapeAnswer('circle')" style="
                                    background: var(--primary-blue); color: white; border: none; 
                                    padding: 0.5rem 1rem; margin: 0.5rem; border-radius: 10px; cursor: pointer;
                                ">Circle</button>
                                <button onclick="checkShapeAnswer('square')" style="
                                    background: var(--primary-pink); color: white; border: none; 
                                    padding: 0.5rem 1rem; margin: 0.5rem; border-radius: 10px; cursor: pointer;
                                ">Square</button>
                            </p>
                        </div>
                    `
                },
                {
                    name: "Animal Sounds Game",
                    html: `
                        <div style="margin-bottom: 1rem;">
                            <h3 style="color: var(--text-dark); margin-bottom: 1rem;">🐶 What Sound Does This Animal Make? 🐶</h3>
                            <div style="font-size: 4rem; margin: 1rem 0;">🐱</div>
                            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                                <button onclick="checkAnimalSound('meow')" style="
                                    background: var(--primary-green); color: white; border: none; 
                                    padding: 0.8rem 1.5rem; margin: 0.5rem; border-radius: 15px; cursor: pointer; font-size: 1rem;
                                ">Meow</button>
                                <button onclick="checkAnimalSound('woof')" style="
                                    background: var(--primary-orange); color: white; border: none; 
                                    padding: 0.8rem 1.5rem; margin: 0.5rem; border-radius: 15px; cursor: pointer; font-size: 1rem;
                                ">Woof</button>
                                <button onclick="checkAnimalSound('moo')" style="
                                    background: var(--primary-blue); color: white; border: none; 
                                    padding: 0.8rem 1.5rem; margin: 0.5rem; border-radius: 15px; cursor: pointer; font-size: 1rem;
                                ">Moo</button>
                            </div>
                        </div>
                    `
                }
            ];
            
            return games[Math.floor(Math.random() * games.length)];
        }

        function completeBreakGame() {
            const modal = document.getElementById('breakModal');
            if (modal) {
                modal.remove();
            }
            showSuccessMessage('Great job! Time to continue watching! 🎉');
            // Restart the break timer
            startBreakTimer();
        }

        function skipBreak() {
            const modal = document.getElementById('breakModal');
            if (modal) {
                modal.remove();
            }
            showSuccessMessage('Break skipped! Continue watching! ⏭️');
            // Restart the break timer
            startBreakTimer();
        }

        function flipCard(element) {
            element.style.transform = element.style.transform === 'rotateY(180deg)' ? 'rotateY(0deg)' : 'rotateY(180deg)';
            element.style.transition = 'transform 0.3s ease';
        }

        function checkShapeAnswer(answer) {
            if (answer === 'circle') {
                showSuccessMessage('Correct! It should be a circle! 🎉');
            } else {
                showSuccessMessage('Try again! Look at the pattern! 🤔');
            }
        }

        function checkAnimalSound(answer) {
            if (answer === 'meow') {
                showSuccessMessage('Correct! Cats say meow! 🐱🎉');
            } else {
                showSuccessMessage('Not quite! Cats say meow! 🐱');
            }
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            loadSettings();
            setupParentalControls();
            updateTimerStatus();
            preventYouTubeRedirects();
            showSuccessMessage('Welcome to Kids Video App! 🎬');
        });
    </script>

    <!-- Emergency video loader - runs as soon as possible -->
    <script>
        // Emergency fallback to ensure videos load
        (function() {
            console.log('Emergency video loader starting...');
            
            function emergencyLoadVideos() {
                const videosContainer = document.getElementById('videosContainer');
                if (videosContainer && videosContainer.children.length === 0) {
                    console.log('Emergency loader: Loading videos now!');
                    
                    const videoData = [
                        {
                            id: 'XqZsoesa55w',
                            title: 'Baby Shark Dance',
                            description: 'Sing and dance with Baby Shark! 🦈',
                            thumbnail: 'https://img.youtube.com/vi/XqZsoesa55w/mqdefault.jpg',
                            category: 'Music'
                        },
                        {
                            id: 'dQw4w9WgXcQ',
                            title: 'Never Gonna Give You Up',
                            description: 'Classic song for kids! 🎵',
                            thumbnail: 'https://img.youtube.com/vi/dQw4w9WgXcQ/mqdefault.jpg',
                            category: 'Music'
                        },
                        {
                            id: 'jNQXAC9IVRw',
                            title: 'Me at the zoo',
                            description: 'First YouTube video! 🦁',
                            thumbnail: 'https://img.youtube.com/vi/jNQXAC9IVRw/mqdefault.jpg',
                            category: 'Learning'
                        }
                    ];
                    
                    videosContainer.innerHTML = videoData.map(video => `
                        <div class="video-card" onclick="playVideo('${video.id}', '${video.title.replace(/'/g, "\\'")}', '${video.description.replace(/'/g, "\\'")}')">
                            <div class="video-thumbnail">
                                <img src="${video.thumbnail}" alt="${video.title}" onerror="this.style.display='none'">
                                <i class="fas fa-play-circle play-icon"></i>
                            </div>
                            <div class="video-actions">
                                <button class="action-btn add-to-playlist-btn" onclick="event.stopPropagation(); showPlaylistMenu('${video.id}', '${video.title.replace(/'/g, "\\'")}', '${video.thumbnail}')" title="Add to Playlist">
                                    <i class="fas fa-plus"></i>
                                </button>
                                <button class="action-btn like-btn" onclick="event.stopPropagation(); toggleLike('${video.id}')" title="Like Video">
                                    <i class="fas fa-heart"></i>
                                </button>
                            </div>
                            <div class="video-info">
                                <div class="video-category">${video.category}</div>
                                <h4 class="video-title">${video.title}</h4>
                                <p class="video-channel">KidsTube</p>
                            </div>
                        </div>
                    `).join('');
                    
                    console.log('Emergency loader: Videos loaded successfully!');
                }
            }
            
            // Try multiple times
            setTimeout(emergencyLoadVideos, 100);
            setTimeout(emergencyLoadVideos, 500);
            setTimeout(emergencyLoadVideos, 1000);
            setTimeout(emergencyLoadVideos, 2000);
        })();
    </script>
</body>
</html>
